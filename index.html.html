<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Best Ball Exposure Tracker</title>
  
  <!-- Google Fonts: Bebas Neue for headers, Inter for body -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    button, a, input, select {
      transition: all 0.2s ease;
    }
    
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: transparent;
    }
    
    ::-webkit-scrollbar-thumb {
      background: rgba(100, 100, 100, 0.3);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(100, 100, 100, 0.5);
    }
  </style>
  
  <!-- Plausible Analytics - Privacy-friendly, cookieless tracking -->
  <!-- TODO: Replace 'YOUR-DOMAIN.com' with your actual domain when live -->
  <script defer data-domain="YOUR-DOMAIN.com" src="https://plausible.io/js/script.js"></script>
  <script>
    // Custom event tracking helper
    window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }
  </script>
</head>
<body>
  <div id="root">Loading...</div>

  <script type="text/babel">
    const { useState, useMemo, useEffect, useRef } = React;

    // Icon components
    const Upload = ({ size = 24, style = {} }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
        <polyline points="17 8 12 3 7 8"></polyline>
        <line x1="12" y1="3" x2="12" y2="15"></line>
      </svg>
    );

    const Search = ({ size = 24, style = {} }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"></path>
      </svg>
    );

    const Users = ({ size = 24, style = {} }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
        <circle cx="9" cy="7" r="4"></circle>
        <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
      </svg>
    );

    const Layers = ({ size = 24, style = {} }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
        <polygon points="12 2 2 7 12 12 22 7 12 2"></polygon>
        <polyline points="2 17 12 22 22 17"></polyline>
        <polyline points="2 12 12 17 22 12"></polyline>
      </svg>
    );

    const TrendingUp = ({ size = 24, style = {} }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
        <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
        <polyline points="17 6 23 6 23 12"></polyline>
      </svg>
    );

    const Target = ({ size = 24, style = {} }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
        <circle cx="12" cy="12" r="10"></circle>
        <circle cx="12" cy="12" r="6"></circle>
        <circle cx="12" cy="12" r="2"></circle>
      </svg>
    );

    const DollarSign = ({ size = 24, style = {} }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
        <line x1="12" y1="1" x2="12" y2="23"></line>
        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
      </svg>
    );

    // Chart.js wrapper component
    const BarChart = ({ data, dataKey, labelKey, color = '#00a8e1', height = 300 }) => {
      const canvasRef = useRef(null);
      const chartRef = useRef(null);

      useEffect(() => {
        if (!canvasRef.current || !data || data.length === 0) return;

        // Destroy existing chart
        if (chartRef.current) {
          chartRef.current.destroy();
        }

        const ctx = canvasRef.current.getContext('2d');
        
        // Get the max value to set appropriate step size
        const maxValue = Math.max(...data.map(d => parseFloat(d[dataKey])));
        let stepSize = 10;
        if (maxValue > 100) stepSize = 20;
        if (maxValue > 200) stepSize = 50;
        
        chartRef.current = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: data.map(d => d[labelKey]),
            datasets: [{
              label: dataKey,
              data: data.map(d => parseFloat(d[dataKey])),
              backgroundColor: color,
              borderRadius: 4
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  font: {
                    weight: 600
                  },
                  stepSize: stepSize
                }
              },
              x: {
                ticks: {
                  font: {
                    weight: 600
                  },
                  maxRotation: 45,
                  minRotation: 45
                }
              }
            }
          }
        });

        return () => {
          if (chartRef.current) {
            chartRef.current.destroy();
          }
        };
      }, [data, dataKey, labelKey, color]);

      return <canvas ref={canvasRef} height={height} />;
    };

    const PieChart = ({ data, dataKey, labelKey, height = 300 }) => {
      const canvasRef = useRef(null);
      const chartRef = useRef(null);

      useEffect(() => {
        if (!canvasRef.current || !data || data.length === 0) return;

        if (chartRef.current) {
          chartRef.current.destroy();
        }

        const colors = ['#00a8e1', '#00d4ff', '#ff00ff', '#ffaa00', '#ff3366', '#00ffaa', '#aa00ff', '#ffdd00'];
        
        // Calculate total for percentages
        const total = data.reduce((sum, d) => sum + d[dataKey], 0);
        
        const ctx = canvasRef.current.getContext('2d');
        chartRef.current = new Chart(ctx, {
          type: 'pie',
          data: {
            labels: data.map(d => {
              const percentage = ((d[dataKey] / total) * 100).toFixed(1);
              return `${d[labelKey]} (${percentage}%)`;
            }),
            datasets: [{
              data: data.map(d => d[dataKey]),
              backgroundColor: colors.slice(0, data.length)
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'right',
                labels: {
                  font: {
                    size: 12
                  },
                  padding: 10
                }
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const label = data[context.dataIndex][labelKey];
                    const value = context.parsed;
                    const percentage = ((value / total) * 100).toFixed(1);
                    return `${label}: ${value} (${percentage}%)`;
                  }
                }
              }
            }
          }
        });

        return () => {
          if (chartRef.current) {
            chartRef.current.destroy();
          }
        };
      }, [data, dataKey, labelKey]);

      return <canvas ref={canvasRef} height={height} />;
    };

    const FantasyExposureTracker = () => {
      const [drafts, setDrafts] = useState([]);
      const [activeTab, setActiveTab] = useState('overview');
      const [showHowToUse, setShowHowToUse] = useState(false);
      const [showPortfolioReport, setShowPortfolioReport] = useState(false);
      const [activeBadge, setActiveBadge] = useState(null); // For clicking mini badges
      const [sortConfig, setSortConfig] = useState({ key: 'exposure', direction: 'desc' });
      const [overviewSearch, setOverviewSearch] = useState('');
      const [positionFilter, setPositionFilter] = useState('ALL');
      const [currentPage, setCurrentPage] = useState(1);
      const PAGE_SIZE = 20;
      const [chartPositionFilter, setChartPositionFilter] = useState('ALL');
      const [selectedPlayers, setSelectedPlayers] = useState([]);
      const [playerListCollapsed, setPlayerListCollapsed] = useState(false);
      const [correlationSearchInput, setCorrelationSearchInput] = useState('');
      const [showAutocomplete, setShowAutocomplete] = useState(false);
      const [teammateSearch, setTeammateSearch] = useState('');
      const [selectedPlayerDetail, setSelectedPlayerDetail] = useState(null);
      const [entryFeeFilter, setEntryFeeFilter] = useState('ALL');
      const [tournamentFilter, setTournamentFilter] = useState('ALL');
      const [ranksData, setRanksData] = useState(() => {
        // Try to load from localStorage first
        try {
          const saved = localStorage.getItem('ranks_player_data');
          if (saved) {
            const parsed = JSON.parse(saved);
            console.log('âœ… Loaded ranks from localStorage');
            return Array.isArray(parsed) ? parsed : (parsed.players || []);
          }
        } catch (e) {
          console.log('No saved ranks data');
        }
        return [];
      });
      const [ranksLastSync, setRanksLastSync] = useState(null);
      const [expandedDraft, setExpandedDraft] = useState(null);
      const [teamsSortDir, setTeamsSortDir] = useState('asc'); // asc = best value first (most negative)
      const [teamsPage, setTeamsPage] = useState(1);
      const TEAMS_PAGE_SIZE = 10;

      // ============================================================================
      // SAMPLE DATA FOR FIRST-TIME USERS
      // ============================================================================
      
            const SAMPLE_DRAFTS = [
        // Draft 1: (2-6-7-3)
        {
          name: 'Sample Draft 1',
          contest: 'BBM5 $1',
          entryFee: 1,
          myTeam: [
            { id: 's1_1', name: 'CeeDee Lamb', position: 'WR', team: 'DAL', rank: 8, pick: 8, adp: 8.3 },
            { id: 's1_2', name: 'Drake London', position: 'WR', team: 'ATL', rank: 17, pick: 17, adp: 17.6 },
            { id: 's1_3', name: 'Tee Higgins', position: 'WR', team: 'CIN', rank: 32, pick: 32, adp: 33.4 },
            { id: 's1_4', name: 'Ladd McConkey', position: 'WR', team: 'LAC', rank: 41, pick: 41, adp: 37.2 },
            { id: 's1_5', name: 'Joe Burrow', position: 'QB', team: 'CIN', rank: 56, pick: 56, adp: 64.3 },
            { id: 's1_6', name: 'Rhamondre Stevenson', position: 'RB', team: 'NE', rank: 65, pick: 65, adp: 70.7 },
            { id: 's1_7', name: 'Justin Herbert', position: 'QB', team: 'LAC', rank: 80, pick: 80, adp: 78.9 },
            { id: 's1_8', name: 'Chuba Hubbard', position: 'RB', team: 'CAR', rank: 89, pick: 89, adp: 91.4 },
            { id: 's1_9', name: 'David Montgomery', position: 'RB', team: 'DET', rank: 104, pick: 104, adp: 108.7 },
            { id: 's1_10', name: 'Wan\'Dale Robinson', position: 'WR', team: 'NYG', rank: 113, pick: 113, adp: 110.3 },
            { id: 's1_11', name: 'Kenneth Gainwell', position: 'RB', team: 'PIT', rank: 128, pick: 128, adp: 128.0 },
            { id: 's1_12', name: 'Romeo Doubs', position: 'WR', team: 'GB', rank: 137, pick: 137, adp: 140.5 },
            { id: 's1_13', name: 'Juwan Johnson', position: 'TE', team: 'NO', rank: 152, pick: 152, adp: 147.9 },
            { id: 's1_14', name: 'Zach Charbonnet', position: 'RB', team: 'SEA', rank: 161, pick: 161, adp: 156.9 },
            { id: 's1_15', name: 'Theo Johnson', position: 'TE', team: 'NYG', rank: 176, pick: 176, adp: 170.4 },
            { id: 's1_16', name: 'Dylan Sampson', position: 'RB', team: 'CLE', rank: 185, pick: 185, adp: 184.7 },
            { id: 's1_17', name: 'Mason Taylor', position: 'TE', team: 'NYJ', rank: 200, pick: 200, adp: 203.6 },
            { id: 's1_18', name: 'Keenan Allen', position: 'WR', team: 'LAC', rank: 209, pick: 209, adp: 228.1 }
          ],
          opponentTeams: {}
        },
        
        // Draft 2: (2-6-7-3)
        {
          name: 'Sample Draft 2',
          contest: 'BBM5 $1',
          entryFee: 1,
          myTeam: [
            { id: 's2_1', name: 'Puka Nacua', position: 'WR', team: 'LAR', rank: 1, pick: 1, adp: 2.6 },
            { id: 's2_2', name: 'Chase Brown', position: 'RB', team: 'CIN', rank: 24, pick: 24, adp: 23.3 },
            { id: 's2_3', name: 'Rashee Rice', position: 'WR', team: 'KC', rank: 25, pick: 25, adp: 26.3 },
            { id: 's2_4', name: 'Lamar Jackson', position: 'QB', team: 'BAL', rank: 48, pick: 48, adp: 46.1 },
            { id: 's2_5', name: 'Quinshon Judkins', position: 'RB', team: 'CLE', rank: 49, pick: 49, adp: 53.8 },
            { id: 's2_6', name: 'Michael Wilson', position: 'WR', team: 'ARI', rank: 72, pick: 72, adp: 74.7 },
            { id: 's2_7', name: 'Parker Washington', position: 'WR', team: 'JAX', rank: 73, pick: 73, adp: 73.2 },
            { id: 's2_8', name: 'Matthew Stafford', position: 'QB', team: 'LAR', rank: 96, pick: 96, adp: 97.6 },
            { id: 's2_9', name: 'Rico Dowdle', position: 'RB', team: 'CAR', rank: 97, pick: 97, adp: 101.4 },
            { id: 's2_10', name: 'George Kittle', position: 'TE', team: 'SF', rank: 120, pick: 120, adp: 123.0 },
            { id: 's2_11', name: 'Woody Marks', position: 'RB', team: 'HOU', rank: 121, pick: 121, adp: 119.4 },
            { id: 's2_12', name: 'Romeo Doubs', position: 'WR', team: 'GB', rank: 144, pick: 144, adp: 140.5 },
            { id: 's2_13', name: 'Kenyon Sadiq', position: 'TE', team: 'F/A', rank: 145, pick: 145, adp: 143.6 },
            { id: 's2_14', name: 'Aaron Jones', position: 'RB', team: 'MIN', rank: 168, pick: 168, adp: 163.6 },
            { id: 's2_15', name: 'Calvin Ridley', position: 'WR', team: 'TEN', rank: 169, pick: 169, adp: 173.2 },
            { id: 's2_16', name: 'Tank Bigsby', position: 'RB', team: 'PHI', rank: 192, pick: 192, adp: 192.6 },
            { id: 's2_17', name: 'Rashod Bateman', position: 'WR', team: 'BAL', rank: 193, pick: 193, adp: 230.1 },
            { id: 's2_18', name: 'Eli Stowers', position: 'TE', team: 'F/A', rank: 216, pick: 216, adp: 223.7 }
          ],
          opponentTeams: {}
        },
        
        // Draft 3: (2-6-7-3)
        {
          name: 'Sample Draft 3',
          contest: 'BBM5 $1',
          entryFee: 1,
          myTeam: [
            { id: 's3_1', name: 'CeeDee Lamb', position: 'WR', team: 'DAL', rank: 9, pick: 9, adp: 8.3 },
            { id: 's3_2', name: 'Drake London', position: 'WR', team: 'ATL', rank: 16, pick: 16, adp: 17.6 },
            { id: 's3_3', name: 'Tee Higgins', position: 'WR', team: 'CIN', rank: 33, pick: 33, adp: 33.4 },
            { id: 's3_4', name: 'Ladd McConkey', position: 'WR', team: 'LAC', rank: 40, pick: 40, adp: 37.2 },
            { id: 's3_5', name: 'Joe Burrow', position: 'QB', team: 'CIN', rank: 57, pick: 57, adp: 64.3 },
            { id: 's3_6', name: 'Rhamondre Stevenson', position: 'RB', team: 'NE', rank: 64, pick: 64, adp: 70.7 },
            { id: 's3_7', name: 'Bhayshul Tuten', position: 'RB', team: 'JAX', rank: 81, pick: 81, adp: 77.6 },
            { id: 's3_8', name: 'Kyle Pitts', position: 'TE', team: 'ATL', rank: 88, pick: 88, adp: 89.7 },
            { id: 's3_9', name: 'Rico Dowdle', position: 'RB', team: 'CAR', rank: 105, pick: 105, adp: 101.4 },
            { id: 's3_10', name: 'Jayden Reed', position: 'WR', team: 'GB', rank: 112, pick: 112, adp: 114.5 },
            { id: 's3_11', name: 'Kenneth Gainwell', position: 'RB', team: 'PIT', rank: 129, pick: 129, adp: 128.0 },
            { id: 's3_12', name: 'Rashid Shaheed', position: 'WR', team: 'SEA', rank: 136, pick: 136, adp: 140.1 },
            { id: 's3_13', name: 'Alvin Kamara', position: 'RB', team: 'NO', rank: 153, pick: 153, adp: 149.3 },
            { id: 's3_14', name: 'Michael Penix', position: 'QB', team: 'ATL', rank: 160, pick: 160, adp: 171.2 },
            { id: 's3_15', name: 'David Njoku', position: 'TE', team: 'CLE', rank: 177, pick: 177, adp: 179.5 },
            { id: 's3_16', name: 'Elijah Sarratt', position: 'WR', team: 'F/A', rank: 184, pick: 184, adp: 172.8 },
            { id: 's3_17', name: 'Cade Otton', position: 'TE', team: 'TB', rank: 201, pick: 201, adp: 210.4 },
            { id: 's3_18', name: 'Brashard Smith', position: 'RB', team: 'KC', rank: 208, pick: 208, adp: 215.1 }
          ],
          opponentTeams: {}
        },
        
        // Draft 4: (2-6-7-3)
        {
          name: 'Sample Draft 4',
          contest: 'BBM5 $1',
          entryFee: 1,
          myTeam: [
            { id: 's4_1', name: 'Puka Nacua', position: 'WR', team: 'LAR', rank: 2, pick: 2, adp: 2.6 },
            { id: 's4_2', name: 'Nico Collins', position: 'WR', team: 'HOU', rank: 23, pick: 23, adp: 23.2 },
            { id: 's4_3', name: 'Chris Olave', position: 'WR', team: 'NO', rank: 26, pick: 26, adp: 27.0 },
            { id: 's4_4', name: 'RJ Harvey', position: 'RB', team: 'DEN', rank: 47, pick: 47, adp: 49.4 },
            { id: 's4_5', name: 'Quinshon Judkins', position: 'RB', team: 'CLE', rank: 50, pick: 50, adp: 53.8 },
            { id: 's4_6', name: 'Michael Wilson', position: 'WR', team: 'ARI', rank: 71, pick: 71, adp: 74.7 },
            { id: 's4_7', name: 'Parker Washington', position: 'WR', team: 'JAX', rank: 74, pick: 74, adp: 73.2 },
            { id: 's4_8', name: 'Rico Dowdle', position: 'RB', team: 'CAR', rank: 95, pick: 95, adp: 101.4 },
            { id: 's4_9', name: 'Matthew Stafford', position: 'QB', team: 'LAR', rank: 98, pick: 98, adp: 97.6 },
            { id: 's4_10', name: 'George Kittle', position: 'TE', team: 'SF', rank: 119, pick: 119, adp: 123.0 },
            { id: 's4_11', name: 'Jayden Higgins', position: 'WR', team: 'HOU', rank: 122, pick: 122, adp: 124.5 },
            { id: 's4_12', name: 'Kyler Murray', position: 'QB', team: 'ARI', rank: 143, pick: 143, adp: 144.5 },
            { id: 's4_13', name: 'Juwan Johnson', position: 'TE', team: 'NO', rank: 146, pick: 146, adp: 147.9 },
            { id: 's4_14', name: 'Sean Tucker', position: 'RB', team: 'TB', rank: 167, pick: 167, adp: 168.6 },
            { id: 's4_15', name: 'Theo Johnson', position: 'TE', team: 'NYG', rank: 170, pick: 170, adp: 170.4 },
            { id: 's4_16', name: 'Tory Horton', position: 'WR', team: 'SEA', rank: 191, pick: 191, adp: 192.3 },
            { id: 's4_17', name: 'Keaton Mitchell', position: 'RB', team: 'BAL', rank: 194, pick: 194, adp: 199.2 },
            { id: 's4_18', name: 'Jaydon Blue', position: 'RB', team: 'DAL', rank: 215, pick: 215, adp: 220.3 }
          ],
          opponentTeams: {}
        },
        
        // Draft 5: (2-7-6-3)
        {
          name: 'Sample Draft 5',
          contest: 'BBM5 $1',
          entryFee: 1,
          myTeam: [
            { id: 's5_1', name: 'Puka Nacua', position: 'WR', team: 'LAR', rank: 1, pick: 1, adp: 2.6 },
            { id: 's5_2', name: 'Chase Brown', position: 'RB', team: 'CIN', rank: 24, pick: 24, adp: 23.3 },
            { id: 's5_3', name: 'Rashee Rice', position: 'WR', team: 'KC', rank: 25, pick: 25, adp: 26.3 },
            { id: 's5_4', name: 'Colston Loveland', position: 'TE', team: 'CHI', rank: 48, pick: 48, adp: 42.4 },
            { id: 's5_5', name: 'Quinshon Judkins', position: 'RB', team: 'CLE', rank: 49, pick: 49, adp: 53.8 },
            { id: 's5_6', name: 'Michael Wilson', position: 'WR', team: 'ARI', rank: 72, pick: 72, adp: 74.7 },
            { id: 's5_7', name: 'Parker Washington', position: 'WR', team: 'JAX', rank: 73, pick: 73, adp: 73.2 },
            { id: 's5_8', name: 'Matthew Stafford', position: 'QB', team: 'LAR', rank: 96, pick: 96, adp: 97.6 },
            { id: 's5_9', name: 'Rico Dowdle', position: 'RB', team: 'CAR', rank: 97, pick: 97, adp: 101.4 },
            { id: 's5_10', name: 'Wan\'Dale Robinson', position: 'WR', team: 'NYG', rank: 120, pick: 120, adp: 110.3 },
            { id: 's5_11', name: 'Matthew Golden', position: 'WR', team: 'GB', rank: 121, pick: 121, adp: 123.2 },
            { id: 's5_12', name: 'Kyler Murray', position: 'QB', team: 'ARI', rank: 144, pick: 144, adp: 144.5 },
            { id: 's5_13', name: 'Kenyon Sadiq', position: 'TE', team: 'F/A', rank: 145, pick: 145, adp: 143.6 },
            { id: 's5_14', name: 'Aaron Jones', position: 'RB', team: 'MIN', rank: 168, pick: 168, adp: 163.6 },
            { id: 's5_15', name: 'Sean Tucker', position: 'RB', team: 'TB', rank: 169, pick: 169, adp: 168.6 },
            { id: 's5_16', name: 'Joe Mixon', position: 'RB', team: 'HOU', rank: 192, pick: 192, adp: 179.7 },
            { id: 's5_17', name: 'Colby Parkinson', position: 'TE', team: 'LAR', rank: 193, pick: 193, adp: 199.4 },
            { id: 's5_18', name: 'Jaydon Blue', position: 'RB', team: 'DAL', rank: 216, pick: 216, adp: 220.3 }
          ],
          opponentTeams: {}
        },
        
        // Draft 6: (2-6-7-3)
        {
          name: 'Sample Draft 6',
          contest: 'BBM5 $1',
          entryFee: 1,
          myTeam: [
            { id: 's6_1', name: 'Amon-Ra St. Brown', position: 'WR', team: 'DET', rank: 9, pick: 9, adp: 9.2 },
            { id: 's6_2', name: 'Drake London', position: 'WR', team: 'ATL', rank: 16, pick: 16, adp: 17.6 },
            { id: 's6_3', name: 'Tee Higgins', position: 'WR', team: 'CIN', rank: 33, pick: 33, adp: 33.4 },
            { id: 's6_4', name: 'Ladd McConkey', position: 'WR', team: 'LAC', rank: 40, pick: 40, adp: 37.2 },
            { id: 's6_5', name: 'Joe Burrow', position: 'QB', team: 'CIN', rank: 57, pick: 57, adp: 64.3 },
            { id: 's6_6', name: 'Rhamondre Stevenson', position: 'RB', team: 'NE', rank: 64, pick: 64, adp: 70.7 },
            { id: 's6_7', name: 'Tony Pollard', position: 'RB', team: 'TEN', rank: 81, pick: 81, adp: 89.5 },
            { id: 's6_8', name: 'Ricky Pearsall', position: 'WR', team: 'SF', rank: 88, pick: 88, adp: 77.0 },
            { id: 's6_9', name: 'Brock Purdy', position: 'QB', team: 'SF', rank: 105, pick: 105, adp: 97.5 },
            { id: 's6_10', name: 'Woody Marks', position: 'RB', team: 'HOU', rank: 112, pick: 112, adp: 119.4 },
            { id: 's6_11', name: 'Emmett Johnson', position: 'RB', team: 'F/A', rank: 129, pick: 129, adp: 131.0 },
            { id: 's6_12', name: 'Rashid Shaheed', position: 'WR', team: 'SEA', rank: 136, pick: 136, adp: 140.1 },
            { id: 's6_13', name: 'Mark Andrews', position: 'TE', team: 'BAL', rank: 153, pick: 153, adp: 152.7 },
            { id: 's6_14', name: 'Aaron Jones', position: 'RB', team: 'MIN', rank: 160, pick: 160, adp: 163.6 },
            { id: 's6_15', name: 'Isaac TeSlaa', position: 'WR', team: 'DET', rank: 177, pick: 177, adp: 181.2 },
            { id: 's6_16', name: 'Terrance Ferguson', position: 'TE', team: 'LAR', rank: 184, pick: 184, adp: 188.8 },
            { id: 's6_17', name: 'Colby Parkinson', position: 'TE', team: 'LAR', rank: 201, pick: 201, adp: 199.4 },
            { id: 's6_18', name: 'Jaydon Blue', position: 'RB', team: 'DAL', rank: 208, pick: 208, adp: 220.3 }
          ],
          opponentTeams: {}
        },
        
        // Draft 7: (2-6-8-2)
        {
          name: 'Sample Draft 7',
          contest: 'BBM5 $1',
          entryFee: 1,
          myTeam: [
            { id: 's7_1', name: 'Puka Nacua', position: 'WR', team: 'LAR', rank: 2, pick: 2, adp: 2.6 },
            { id: 's7_2', name: 'George Pickens', position: 'WR', team: 'DAL', rank: 23, pick: 23, adp: 22.6 },
            { id: 's7_3', name: 'Chris Olave', position: 'WR', team: 'NO', rank: 26, pick: 26, adp: 27.0 },
            { id: 's7_4', name: 'Colston Loveland', position: 'TE', team: 'CHI', rank: 47, pick: 47, adp: 42.4 },
            { id: 's7_5', name: 'Quinshon Judkins', position: 'RB', team: 'CLE', rank: 50, pick: 50, adp: 53.8 },
            { id: 's7_6', name: 'Rhamondre Stevenson', position: 'RB', team: 'NE', rank: 71, pick: 71, adp: 70.7 },
            { id: 's7_7', name: 'Michael Wilson', position: 'WR', team: 'ARI', rank: 74, pick: 74, adp: 74.7 },
            { id: 's7_8', name: 'Matthew Stafford', position: 'QB', team: 'LAR', rank: 95, pick: 95, adp: 97.6 },
            { id: 's7_9', name: 'Rico Dowdle', position: 'RB', team: 'CAR', rank: 98, pick: 98, adp: 101.4 },
            { id: 's7_10', name: 'George Kittle', position: 'TE', team: 'SF', rank: 119, pick: 119, adp: 123.0 },
            { id: 's7_11', name: 'Jauan Jennings', position: 'WR', team: 'SF', rank: 122, pick: 122, adp: 112.0 },
            { id: 's7_12', name: 'Kyler Murray', position: 'QB', team: 'ARI', rank: 143, pick: 143, adp: 144.5 },
            { id: 's7_13', name: 'Brandon Aiyuk', position: 'WR', team: 'SF', rank: 146, pick: 146, adp: 142.3 },
            { id: 's7_14', name: 'Sean Tucker', position: 'RB', team: 'TB', rank: 167, pick: 167, adp: 168.6 },
            { id: 's7_15', name: 'Tank Dell', position: 'WR', team: 'HOU', rank: 170, pick: 170, adp: 174.3 },
            { id: 's7_16', name: 'Tank Bigsby', position: 'RB', team: 'PHI', rank: 191, pick: 191, adp: 192.6 },
            { id: 's7_17', name: 'Tre Tucker', position: 'WR', team: 'LV', rank: 194, pick: 194, adp: 182.7 },
            { id: 's7_18', name: 'Adam Randall', position: 'RB', team: 'F/A', rank: 215, pick: 215, adp: 234.1 }
          ],
          opponentTeams: {}
        },
        
        // Draft 8: (2-6-7-3)
        {
          name: 'Sample Draft 8',
          contest: 'BBM5 $1',
          entryFee: 1,
          myTeam: [
            { id: 's8_1', name: 'Jonathan Taylor', position: 'RB', team: 'IND', rank: 7, pick: 7, adp: 6.7 },
            { id: 's8_2', name: 'Drake London', position: 'WR', team: 'ATL', rank: 18, pick: 18, adp: 17.6 },
            { id: 's8_3', name: 'Kenneth Walker III', position: 'RB', team: 'SEA', rank: 31, pick: 31, adp: 29.7 },
            { id: 's8_4', name: 'Zay Flowers', position: 'WR', team: 'BAL', rank: 42, pick: 42, adp: 42.3 },
            { id: 's8_5', name: 'Quinshon Judkins', position: 'RB', team: 'CLE', rank: 55, pick: 55, adp: 53.8 },
            { id: 's8_6', name: 'DK Metcalf', position: 'WR', team: 'PIT', rank: 66, pick: 66, adp: 67.2 },
            { id: 's8_7', name: 'Bhayshul Tuten', position: 'RB', team: 'JAX', rank: 79, pick: 79, adp: 77.6 },
            { id: 's8_8', name: 'Kyle Pitts', position: 'TE', team: 'ATL', rank: 90, pick: 90, adp: 89.7 },
            { id: 's8_9', name: 'Jordan Addison', position: 'WR', team: 'MIN', rank: 103, pick: 103, adp: 100.2 },
            { id: 's8_10', name: 'Wan\'Dale Robinson', position: 'WR', team: 'NYG', rank: 114, pick: 114, adp: 110.3 },
            { id: 's8_11', name: 'Emmett Johnson', position: 'RB', team: 'F/A', rank: 127, pick: 127, adp: 131.0 },
            { id: 's8_12', name: 'Romeo Doubs', position: 'WR', team: 'GB', rank: 138, pick: 138, adp: 140.5 },
            { id: 's8_13', name: 'Mark Andrews', position: 'TE', team: 'BAL', rank: 151, pick: 151, adp: 152.7 },
            { id: 's8_14', name: 'Michael Penix', position: 'QB', team: 'ATL', rank: 162, pick: 162, adp: 171.2 },
            { id: 's8_15', name: 'Chimere Dike', position: 'WR', team: 'TEN', rank: 175, pick: 175, adp: 175.2 },
            { id: 's8_16', name: 'Isaiah Likely', position: 'TE', team: 'BAL', rank: 186, pick: 186, adp: 176.8 },
            { id: 's8_17', name: 'Aaron Rodgers', position: 'QB', team: 'PIT', rank: 199, pick: 199, adp: 211.9 },
            { id: 's8_18', name: 'Jaydon Blue', position: 'RB', team: 'DAL', rank: 210, pick: 210, adp: 220.3 }
          ],
          opponentTeams: {}
        }
      ];

      // ============================================================================
      // SYNC ADP FROM WEB
      // ============================================================================
      
      const syncFromADP = async () => {
        try {
          // Add timestamp to bust browser cache
          const adpUrl = `https://mikegourley-dotcom.github.io/adpupdater/adp.json?t=${Date.now()}`;
          
          // Show loading state
          alert('â³ Loading ADP data...');
          
          const response = await fetch(adpUrl, {
            method: 'GET',
            mode: 'cors',  // Explicitly request CORS
            cache: 'no-store',  // Force fresh fetch, ignore cache
            headers: {
              'Accept': 'application/json',
              'Cache-Control': 'no-cache'
            }
          });
          
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
          
          const adpData = await response.json();
          
          if (!adpData.players || !Array.isArray(adpData.players)) {
            throw new Error('Invalid ADP data format');
          }
          
          if (adpData.players.length === 0) {
            throw new Error('No players found in ADP data');
          }
          
          // Save to state
          setRanksData(adpData.players);
          
          // SAVE TO LOCALSTORAGE for next time
          try {
            localStorage.setItem('ranks_player_data', JSON.stringify(adpData.players));
            localStorage.setItem('ranks_last_updated', adpData.lastUpdated);
            console.log('âœ… Saved ranks to localStorage');
          } catch (e) {
            console.log('Could not save to localStorage:', e);
          }
          
          setRanksLastSync(new Date().toLocaleString());
          alert(`âœ… Synced ${adpData.players.length} players!\n\nSource: ${adpData.source}\nLast Updated: ${new Date(adpData.lastUpdated).toLocaleDateString()}`);
          
        } catch (error) {
          console.error('Error syncing ADP:', error);
          alert(`âŒ Error loading ADP data:\n\n${error.message}\n\nPlease check your internet connection.`);
        }
      };

      // ============================================================================
      // LOCALSTORAGE PERSISTENCE
      // ============================================================================
      
      const PORTFOLIO_STORAGE_KEY = 'portfolio_saved_drafts';
      
      // Save drafts to localStorage
      const saveDraftsToStorage = (draftsToSave) => {
        try {
          const dataToSave = {
            drafts: draftsToSave,
            lastSaved: new Date().toISOString()
          };
          localStorage.setItem(PORTFOLIO_STORAGE_KEY, JSON.stringify(dataToSave));
          console.log(`âœ… Saved ${draftsToSave.length} drafts to storage`);
        } catch (error) {
          console.error('Failed to save drafts:', error);
        }
      };
      
      // Load drafts from localStorage on mount
      React.useEffect(() => {
        try {
          const saved = localStorage.getItem(PORTFOLIO_STORAGE_KEY);
          if (saved) {
            const data = JSON.parse(saved);
            if (data.drafts && Array.isArray(data.drafts)) {
              setDrafts(data.drafts);
              console.log(`âœ… Loaded ${data.drafts.length} drafts from previous session`);
            }
          } else {
            // First-time visitor - load sample data
            setDrafts(SAMPLE_DRAFTS);
            console.log('ðŸ‘‹ Welcome! Loaded sample data');
          }
        } catch (error) {
          console.error('Failed to load saved drafts:', error);
        }
      }, []);
      
      // DEBUG: Expose data to window for testing
      React.useEffect(() => {
        window.debugData = {
          ranksData,
          exposureData,
          checkPlayer: (name) => {
            const inRanks = ranksData.find(p => p.name === name);
            const inExposure = exposureData.find(p => p.name === name);
            console.log(`=== ${name} ===`);
            console.log('In ranksData:', inRanks);
            console.log('In exposureData:', inExposure);
            return { inRanks, inExposure };
          }
        };
      }, [ranksData, exposureData]);
      
      // Auto-sync ADP data on mount (silently, no alerts)
      React.useEffect(() => {
        const autoSyncADP = async () => {
          try {
            const adpUrl = 'https://mikegourley-dotcom.github.io/adpupdater/adp.json';
            const response = await fetch(adpUrl);
            
            if (!response.ok) {
              console.warn('Failed to auto-sync ADP data');
              return;
            }
            
            const adpData = await response.json();
            
            if (adpData.players && Array.isArray(adpData.players) && adpData.players.length > 0) {
              setRanksData(adpData.players);
              setRanksLastSync(new Date().toLocaleString());
              console.log(`âœ… Auto-synced ${adpData.players.length} players from ADP`);
            }
          } catch (error) {
            console.warn('Auto-sync ADP failed (non-critical):', error);
          }
        };
        
        autoSyncADP();
      }, []);
      
      
      // Auto-save whenever drafts change
      React.useEffect(() => {
        if (drafts.length > 0) {
          saveDraftsToStorage(drafts);
        }
      }, [drafts]);
      
      // Clear all saved drafts
      const clearAllDrafts = () => {
        if (confirm(`Delete all ${drafts.length} saved drafts? This cannot be undone.`)) {
          setDrafts([]);
          localStorage.removeItem(PORTFOLIO_STORAGE_KEY);
          alert('âœ… All drafts deleted!');
        }
      };
      
      // Delete individual draft
      const deleteDraft = (indexToDelete) => {
        if (confirm('Delete this draft?')) {
          const updatedDrafts = drafts.filter((_, index) => index !== indexToDelete);
          setDrafts(updatedDrafts);
          if (updatedDrafts.length === 0) {
            localStorage.removeItem(PORTFOLIO_STORAGE_KEY);
          }
        }
      };

      const handleFileUpload = (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (event) => {
          try {
            if (file.name.endsWith('.json')) {
              const data = JSON.parse(event.target.result);
              
              if (data.completedDrafts && Array.isArray(data.completedDrafts)) {
                const enhancedDrafts = data.completedDrafts.map(draft => {
                  const pickMap = new Map();
                  if (draft.allPicks && Array.isArray(draft.allPicks)) {
                    draft.allPicks.forEach(pickData => {
                      if (pickData.player && pickData.pick) {
                        pickMap.set(pickData.player.id, pickData.pick);
                      }
                    });
                  }
                  
                  const enhancedMyTeam = draft.myTeam.map(player => ({
                    ...player,
                    pick: pickMap.get(player.id) || null
                  }));
                  
                  const enhancedOpponentTeams = {};
                  if (draft.opponentTeams) {
                    Object.entries(draft.opponentTeams).forEach(([teamName, roster]) => {
                      enhancedOpponentTeams[teamName] = roster.map(player => ({
                        ...player,
                        pick: pickMap.get(player.id) || null
                      }));
                    });
                  }
                  
                  return {
                    myTeam: enhancedMyTeam,
                    opponentTeams: enhancedOpponentTeams,
                    entryFee: draft.entryFee || null,
                    contest: draft.contest || null,
                    name: draft.name || null
                  };
                });
                
                // COMBINE with existing drafts instead of overwriting
                setDrafts(prevDrafts => [...prevDrafts, ...enhancedDrafts]);
                alert(`âœ… Added ${enhancedDrafts.length} new draft${enhancedDrafts.length !== 1 ? 's' : ''}! Total: ${drafts.length + enhancedDrafts.length}`);
              } else if (data.completedDrafts) {
                // COMBINE with existing drafts instead of overwriting
                setDrafts(prevDrafts => [...prevDrafts, ...data.completedDrafts]);
                alert(`âœ… Added ${data.completedDrafts.length} new draft${data.completedDrafts.length !== 1 ? 's' : ''}! Total: ${drafts.length + data.completedDrafts.length}`);
              } else {
                alert('Invalid JSON format. Expected completedDrafts array.');
              }
            } else if (file.name.endsWith('.csv')) {
              try {
                // Parse CSV - detect format
                const lines = event.target.result.trim().split('\n');
                if (lines.length < 2) {
                  alert('CSV file is empty or invalid');
                  return;
                }
                
                // Parse header
                const headers = lines[0].split(',');
                
                // Detect format: Underdog live drafts have "Picked At,Pick Number,Appearance,First Name,Last Name..."
                const isUnderdogLiveDraft = headers[0] === 'Picked At' && headers[1] === 'Pick Number';
                
                let csvDrafts = [];
                
                if (isUnderdogLiveDraft) {
                  // Parse Underdog live draft format
                  console.log('Detected Underdog live draft format');
                  
                  // Try to load ranks data for ADP matching
                  let ranksData = null;
                  try {
                    const ranksDataStr = localStorage.getItem('ranks_player_data');
                    if (ranksDataStr) {
                      const parsedData = JSON.parse(ranksDataStr);
                      ranksData = Array.isArray(parsedData) ? parsedData : (parsedData.players || null);
                    }
                  } catch (e) {
                    console.log('Could not load ranks data for ADP matching');
                  }
                  
                  // Group picks by Draft ID (column 7)
                  const draftMap = new Map();
                  
                  for (let i = 1; i < lines.length; i++) {
                    const line = lines[i];
                    if (!line.trim()) continue;
                    
                    const fields = line.split(',');
                    if (fields.length < 15) continue; // Skip malformed lines
                    
                    const pickNumber = parseInt(fields[1]);
                    const firstName = fields[3]?.trim() || '';
                    const lastName = fields[4]?.trim() || '';
                    const team = fields[5]?.trim() || 'F/A';
                    const position = fields[6]?.trim() || '';
                    const draftId = fields[7]?.trim() || '';
                    const tournamentTitle = fields[12]?.trim() || ''; // Tournament Title column
                    const tournamentEntryFee = parseFloat(fields[14]) || 0;
                    
                    if (!draftId || !firstName || !position) continue; // Skip invalid entries
                    
                    if (!draftMap.has(draftId)) {
                      draftMap.set(draftId, {
                        picks: [],
                        entryFee: tournamentEntryFee,
                        tournamentTitle: tournamentTitle,
                        draftId: draftId,
                        draftDate: fields[0]?.trim() || ''
                      });
                    }
                    
                    draftMap.get(draftId).picks.push({
                      pickNumber: pickNumber,
                      name: `${firstName} ${lastName}`.trim(),
                      position: position,
                      team: team === '' ? 'F/A' : team
                    });
                  }
                  
                  // Convert to draft format
                  let draftIndex = 1;
                  draftMap.forEach((draftData, draftId) => {
                    // Sort picks by pick number
                    const sortedPicks = draftData.picks.sort((a, b) => a.pickNumber - b.pickNumber);
                    
                    // Convert to myTeam format and match with ranks for ADP
                    const myTeam = sortedPicks.map((pick, idx) => {
                      let adp = null;
                      
                      // Try to match with ranks data
                      if (ranksData) {
                        const rankedPlayer = ranksData.find(p => 
                          p.name === pick.name && p.position === pick.position
                        );
                        if (rankedPlayer && rankedPlayer.adp) {
                          adp = rankedPlayer.adp;
                        }
                      }
                      
                      return {
                        id: `live_${draftId}_${idx}`,
                        name: pick.name,
                        position: pick.position,
                        team: pick.team,
                        rank: pick.pickNumber,
                        pick: pick.pickNumber,
                        adp: adp
                      };
                    });
                    
                    csvDrafts.push({
                      myTeam: myTeam,
                      opponentTeams: {},
                      entryFee: draftData.entryFee,
                      contest: draftData.tournamentTitle || 'Live Draft',
                      draftDate: draftData.draftDate,
                      name: `${draftData.tournamentTitle || 'Live Draft'} ${draftIndex}`
                    });
                    
                    draftIndex++;
                  });
                  
                  console.log(`Parsed ${csvDrafts.length} live drafts`);
                  
                } else {
                  // Parse simulation format (existing logic)
                  console.log('Detected simulation CSV format');
                  
                  for (let i = 1; i < lines.length; i++) {
                    const line = lines[i];
                    
                    // Handle quoted fields (picks column has pipe-separated players)
                    const fields = [];
                    let currentField = '';
                    let insideQuotes = false;
                    
                    for (let j = 0; j < line.length; j++) {
                      const char = line[j];
                      if (char === '"') {
                        insideQuotes = !insideQuotes;
                      } else if (char === ',' && !insideQuotes) {
                        fields.push(currentField);
                        currentField = '';
                      } else {
                        currentField += char;
                      }
                    }
                    fields.push(currentField); // Add last field
                    
                    // Skip if no fields
                    if (fields.length === 0) continue;
                    
                    // Parse player names from picks column
                    const lastField = fields[fields.length - 1] || '';
                    const picksStr = typeof lastField === 'string' ? lastField.replace(/"/g, '') : '';
                    if (!picksStr) continue; // Skip if no picks data
                    
                    const playerEntries = picksStr.split('|');
                    
                    // Create myTeam array - parse "Player Name (POS-TEAM-PICK-ADP)" format
                    const myTeam = playerEntries.map((entry, idx) => {
                      const trimmed = (entry || '').trim();
                      
                      // Extract name, position, team, pick, and ADP from "Player Name (POS-TEAM-PICK-ADP)"
                      // Team can include slashes for free agents (F/A)
                      // ADP can be a number or N/A
                      const match = trimmed.match(/^(.+?)\s*\(([A-Z/]+)-([A-Z/]+)-(\d+)-([0-9.]+|N\/A)\)$/);
                      
                      if (match) {
                        return {
                          id: `sim_${i}_${idx}`,
                          name: match[1].trim(),
                          position: match[2],
                          team: match[3],
                          rank: parseInt(match[4]),
                          pick: parseInt(match[4]),
                          adp: match[5] === 'N/A' ? null : parseFloat(match[5])
                        };
                      } else {
                        // Fallback if format doesn't match
                        return {
                          id: `sim_${i}_${idx}`,
                          name: trimmed,
                          position: 'UNKNOWN',
                          team: 'UNK',
                          rank: idx + 1,
                          pick: idx + 1,
                          adp: null
                        };
                      }
                    });
                    
                    csvDrafts.push({
                      myTeam: myTeam,
                      opponentTeams: {},
                      entryFee: null,
                      contest: `Simulation ${fields[0]}`,
                      name: `Draft ${fields[0]} (Sim)`
                    });
                  }
                }
                
                // Add to existing drafts
                setDrafts(prevDrafts => [...prevDrafts, ...csvDrafts]);
                
                // Track CSV import
                if (window.plausible) window.plausible('CSV Imported', { props: { draftsCount: csvDrafts.length } });
                
                alert(`âœ… Imported ${csvDrafts.length} drafts! Total: ${drafts.length + csvDrafts.length}`);
                
              } catch (error) {
                console.error('CSV Import Error:', error);
                alert('âŒ Invalid data, please upload proper CSV format.\n\nRefer to the "Getting Started" button for help with the correct format.');
              }
            } else {
              alert('âŒ Invalid file type. Please upload a .json or .csv file.');
            }
          } catch (error) {
            alert('âŒ Invalid data, please upload proper CSV format.\n\nRefer to the "Getting Started" button for help.');
            console.error(error);
          }
        };
        reader.readAsText(file);
      };

      const uniqueEntryFees = useMemo(() => {
        const fees = new Set();
        drafts.forEach(draft => {
          if (draft.entryFee) {
            fees.add(draft.entryFee);
          }
        });
        return Array.from(fees).sort((a, b) => {
          // Handle both string and number entry fees
          const numA = typeof a === 'number' ? a : parseFloat(String(a).replace(/[^0-9.]/g, ''));
          const numB = typeof b === 'number' ? b : parseFloat(String(b).replace(/[^0-9.]/g, ''));
          if (!isNaN(numA) && !isNaN(numB)) {
            return numA - numB;
          }
          return String(a).localeCompare(String(b));
        });
      }, [drafts]);
      
      const uniqueTournaments = useMemo(() => {
        const tournaments = new Set();
        drafts.forEach(draft => {
          if (draft.contest) {
            tournaments.add(draft.contest);
          }
        });
        return Array.from(tournaments).sort();
      }, [drafts]);

      const filteredDrafts = useMemo(() => {
        let filtered = drafts;
        
        // Apply entry fee filter
        if (entryFeeFilter !== 'ALL') {
          const filterNum = parseFloat(String(entryFeeFilter).replace(/[^0-9.]/g, ''));
          filtered = filtered.filter(draft => {
            const feeNum = typeof draft.entryFee === 'number' ? draft.entryFee : parseFloat(String(draft.entryFee).replace(/[^0-9.]/g, ''));
            return feeNum === filterNum;
          });
        }
        
        // Apply tournament filter
        if (tournamentFilter !== 'ALL') {
          filtered = filtered.filter(draft => draft.contest === tournamentFilter);
        }
        
        return filtered;
      }, [drafts, entryFeeFilter, tournamentFilter]);

      const exposureData = useMemo(() => {
        if (!filteredDrafts.length) return [];
        
        const playerMap = new Map();
        
        filteredDrafts.forEach((draft) => {
          const team = draft.myTeam;
          
          if (!team) return;
          team.forEach((player, index) => {
            const key = `${player.name}-${player.position}-${player.team}`;
            if (!playerMap.has(key)) {
              playerMap.set(key, {
                name: player.name,
                position: player.position,
                team: player.team,
                count: 0,
                rounds: [],
                overallPicks: [],
                adp: player.adp || null,
                entryFees: []
              });
            }
            const p = playerMap.get(key);
            p.count += 1;
            p.rounds.push(index + 1);
            
            if (draft.entryFee) {
              p.entryFees.push(draft.entryFee);
            }
            
            const overallPick = player.pick || (index + 1);
            p.overallPicks.push(overallPick);
          });
        });

        const totalTeams = filteredDrafts.length;

        return Array.from(playerMap.values()).map(p => {
          let totalEntryFee = 0;
          p.entryFees.forEach(fee => {
            // Handle both number and string entry fees
            const numericFee = typeof fee === 'number' ? fee : parseFloat(String(fee).replace(/[^0-9.]/g, ''));
            if (!isNaN(numericFee)) {
              totalEntryFee += numericFee;
            }
          });
          
          // MERGE ADP from ranksData if available
          let adpValue = p.adp;
          if (ranksData && ranksData.length > 0) {
            const match = ranksData.find(r => 
              r.name === p.name && 
              r.position === p.position && 
              r.team === p.team
            );
            if (match && match.adp) {
              adpValue = match.adp;
            }
          }
          
          return {
            ...p,
            adp: adpValue,  // Use merged ADP value
            exposure: ((p.count / totalTeams) * 100).toFixed(1),
            avgRound: (p.rounds.reduce((a, b) => a + b, 0) / p.rounds.length).toFixed(1),
            avgPick: (p.overallPicks.reduce((a, b) => a + b, 0) / p.overallPicks.length).toFixed(1),
            earliestPick: Math.min(...p.overallPicks),
            latestPick: Math.max(...p.overallPicks),
            pickRange: Math.max(...p.overallPicks) - Math.min(...p.overallPicks),
            picks: p.overallPicks,
            totalEntryFee: totalEntryFee
          };
        });
      }, [filteredDrafts, ranksData]);

      const sortedExposure = useMemo(() => {
        let filtered = [...exposureData];
        
        if (overviewSearch) {
          const searchLower = overviewSearch.toLowerCase();
          filtered = filtered.filter(p => 
            p.name.toLowerCase().includes(searchLower) ||
            p.team.toLowerCase().includes(searchLower)
          );
        }
        
        if (positionFilter !== 'ALL') {
          filtered = filtered.filter(p => p.position === positionFilter);
        }
        
        filtered.sort((a, b) => {
          let aVal = a[sortConfig.key];
          let bVal = b[sortConfig.key];
          
          // Handle difference column (calculated field)
          if (sortConfig.key === 'difference') {
            const aDiff = a.adp && a.adp !== '-' ? a.avgPick - parseFloat(a.adp) : 0;
            const bDiff = b.adp && b.adp !== '-' ? b.avgPick - parseFloat(b.adp) : 0;
            aVal = aDiff;
            bVal = bDiff;
          }
          
          // Convert to numbers for numeric fields
          if (sortConfig.key === 'exposure' || sortConfig.key === 'avgRound' || sortConfig.key === 'avgPick' || sortConfig.key === 'totalEntryFee' || sortConfig.key === 'adp' || sortConfig.key === 'difference') {
            aVal = parseFloat(aVal) || 0;
            bVal = parseFloat(bVal) || 0;
          }
          
          if (aVal < bVal) return sortConfig.direction === 'asc' ? -1 : 1;
          if (aVal > bVal) return sortConfig.direction === 'asc' ? 1 : -1;
          return 0;
        });
        return filtered;
      }, [exposureData, sortConfig, overviewSearch, positionFilter]);

      const autocompleteSuggestions = useMemo(() => {
        if (!correlationSearchInput || correlationSearchInput.length < 1) return [];
        
        const searchLower = correlationSearchInput.toLowerCase().trim();
        
        return exposureData
          .filter(player => {
            const alreadySelected = selectedPlayers.some(p => 
              p.name === player.name && p.position === player.position && p.team === player.team
            );
            if (alreadySelected) return false;
            
            const nameLower = player.name.toLowerCase();
            const nameParts = nameLower.split(' ');
            const teamLower = player.team.toLowerCase();
            const posLower = player.position.toLowerCase();
            
            return nameLower.includes(searchLower) ||
                   nameParts.some(part => part.startsWith(searchLower)) ||
                   teamLower === searchLower ||
                   posLower === searchLower;
          })
          .slice(0, 10);
      }, [correlationSearchInput, exposureData, selectedPlayers]);

      const correlationData = useMemo(() => {
        if (selectedPlayers.length === 0 || !filteredDrafts.length) return null;

        const teammates = new Map();
        
        filteredDrafts.forEach((draft) => {
          const team = draft.myTeam;
          
          if (!team) return;
          
          const hasAllTargets = selectedPlayers.every(targetPlayer =>
            team.some(p => 
              p.name === targetPlayer.name && 
              p.position === targetPlayer.position && 
              p.team === targetPlayer.team
            )
          );
          
          if (hasAllTargets) {
            team.forEach((player) => {
              const isSelectedPlayer = selectedPlayers.some(tp =>
                tp.name === player.name && 
                tp.position === player.position && 
                tp.team === player.team
              );
              
              if (!isSelectedPlayer) {
                const key = `${player.name}-${player.position}-${player.team}`;
                teammates.set(key, (teammates.get(key) || 0) + 1);
              }
            });
          }
        });

        let teamsWithAllPlayers = 0;
        filteredDrafts.forEach((draft) => {
          const team = draft.myTeam;
          
          if (!team) return;
          const hasAll = selectedPlayers.every(tp =>
            team.some(p => p.name === tp.name && p.position === tp.position && p.team === tp.team)
          );
          if (hasAll) teamsWithAllPlayers++;
        });

        const totalTeams = filteredDrafts.length;

        return {
          players: selectedPlayers,
          teammates: Array.from(teammates.entries())
            .map(([key, count]) => {
              // Split on last two hyphens only to handle hyphenated names
              // e.g., "Jaxson Smith-Njigba-WR-SEA" -> ["Jaxson Smith-Njigba", "WR", "SEA"]
              const parts = key.split('-');
              const team = parts.pop(); // Last part is team
              const position = parts.pop(); // Second-to-last is position
              const name = parts.join('-'); // Rest is name (may contain hyphens)
              
              return {
                name,
                position,
                team,
                count,
                correlation: teamsWithAllPlayers > 0 ? ((count / teamsWithAllPlayers) * 100).toFixed(1) : '0.0'
              };
            })
            .sort((a, b) => b.count - a.count),
          teamsWithAllPlayers,
          combinedExposure: ((teamsWithAllPlayers / totalTeams) * 100).toFixed(1)
        };
      }, [selectedPlayers, filteredDrafts]);

      const constructionData = useMemo(() => {
        if (!filteredDrafts.length) return null;

        const teams = filteredDrafts.map(d => d.myTeam);

        const validCombos = ['RB-RB', 'RB-WR', 'WR-WR', 'RB-TE', 'WR-TE', 'QB-RB', 'QB-WR', 'QB-TE'];
        const first2PicksMap = new Map(validCombos.map(combo => [combo, 0]));
        
        // Helper function to normalize combo (combine order, e.g., RB-WR = WR-RB)
        const normalizeCombo = (pos1, pos2) => {
          const positions = [pos1, pos2].sort();
          return `${positions[0]}-${positions[1]}`;
        };
        
        teams.forEach((team) => {
          if (!team || team.length < 2) return;
          const pos1 = team[0].position;
          const pos2 = team[1].position;
          const key = normalizeCombo(pos1, pos2);
          if (first2PicksMap.has(key)) {
            first2PicksMap.set(key, first2PicksMap.get(key) + 1);
          }
        });

        const first2Picks = Array.from(first2PicksMap.entries())
          .map(([key, count]) => ({ combo: key, count }))
          .filter(item => item.count > 0)
          .sort((a, b) => b.count - a.count);

        let heroRB = 0;
        let zeroRB = 0;

        teams.forEach((team) => {
          if (!team || team.length < 5) return;
          const first4 = team.slice(0, 4);
          const rbCount = first4.filter(p => p.position === 'RB').length;
          
          if (rbCount === 1) heroRB++;
          if (rbCount === 0) zeroRB++;
        });

        // Team Build Breakdown (QB/RB/WR/TE distribution)
        const buildMap = new Map();
        
        teams.forEach((team) => {
          if (!team || team.length === 0) return;
          
          const qbCount = team.filter(p => p.position === 'QB').length;
          const rbCount = team.filter(p => p.position === 'RB').length;
          const wrCount = team.filter(p => p.position === 'WR').length;
          const teCount = team.filter(p => p.position === 'TE').length;
          
          const buildKey = `${qbCount}/${rbCount}/${wrCount}/${teCount}`;
          buildMap.set(buildKey, (buildMap.get(buildKey) || 0) + 1);
        });
        
        const teamBuilds = Array.from(buildMap.entries())
          .map(([build, count]) => ({ build, count }))
          .sort((a, b) => b.count - a.count);

        // Position Count Distribution (e.g., 2QB, 3QB, 4RB, 5RB, etc.)
        const positionCounts = {
          QB: new Map(),
          RB: new Map(),
          WR: new Map(),
          TE: new Map()
        };
        
        teams.forEach((team) => {
          if (!team || team.length === 0) return;
          
          ['QB', 'RB', 'WR', 'TE'].forEach(pos => {
            const count = team.filter(p => p.position === pos).length;
            positionCounts[pos].set(count, (positionCounts[pos].get(count) || 0) + 1);
          });
        });
        
        // Convert to arrays for charting
        const positionDistributions = {
          QB: Array.from(positionCounts.QB.entries())
            .map(([count, teams]) => ({ label: `${count}QB`, count: count, teams: teams }))
            .sort((a, b) => a.count - b.count),
          RB: Array.from(positionCounts.RB.entries())
            .map(([count, teams]) => ({ label: `${count}RB`, count: count, teams: teams }))
            .sort((a, b) => a.count - b.count),
          WR: Array.from(positionCounts.WR.entries())
            .map(([count, teams]) => ({ label: `${count}WR`, count: count, teams: teams }))
            .sort((a, b) => a.count - b.count),
          TE: Array.from(positionCounts.TE.entries())
            .map(([count, teams]) => ({ label: `${count}TE`, count: count, teams: teams }))
            .sort((a, b) => a.count - b.count)
        };

        // Picks by Round
        const picksByRound = [];
        for (let round = 1; round <= 18; round++) {
          const roundPos = { QB: 0, RB: 0, WR: 0, TE: 0, total: 0 };
          
          teams.forEach((team) => {
            if (!team || team.length < round) return;
            const player = team[round - 1];
            if (player && player.position && roundPos.hasOwnProperty(player.position)) {
              roundPos[player.position]++;
              roundPos.total++;
            }
          });
          
          picksByRound.push({
            round: round,
            QB: roundPos.total > 0 ? ((roundPos.QB / roundPos.total) * 100).toFixed(1) : '0.0',
            RB: roundPos.total > 0 ? ((roundPos.RB / roundPos.total) * 100).toFixed(1) : '0.0',
            WR: roundPos.total > 0 ? ((roundPos.WR / roundPos.total) * 100).toFixed(1) : '0.0',
            TE: roundPos.total > 0 ? ((roundPos.TE / roundPos.total) * 100).toFixed(1) : '0.0',
            counts: roundPos
          });
        }

        return {
          first2Picks,
          heroRB,
          zeroRB,
          teamBuilds,
          positionDistributions,
          picksByRound,
          totalTeams: teams.length
        };
      }, [filteredDrafts]);

      // Stack analysis - QB+WR/RB/TE combos
      const stackData = useMemo(() => {
        if (!filteredDrafts.length) return null;

        const stackMap = new Map();
        
        filteredDrafts.forEach((draft) => {
          const team = draft.myTeam;
          if (!team) return;

          // Find all QBs on the team
          const qbs = team.filter(p => p.position === 'QB');
          
          qbs.forEach(qb => {
            // Find all potential stack partners (WR/RB/TE from same team)
            const stackPartners = team.filter(p => 
              (p.position === 'WR' || p.position === 'RB' || p.position === 'TE') && 
              p.team === qb.team
            );

            stackPartners.forEach(partner => {
              const stackKey = `${qb.team}|${qb.name}|${partner.name}|${partner.position}`;
              if (!stackMap.has(stackKey)) {
                stackMap.set(stackKey, {
                  team: qb.team,
                  qb: qb.name,
                  partner: partner.name,
                  partnerPosition: partner.position,
                  count: 0
                });
              }
              stackMap.get(stackKey).count++;
            });
          });
        });

        const stacks = Array.from(stackMap.values())
          .sort((a, b) => b.count - a.count);

        // Group by NFL team for heatmap
        const teamGroups = new Map();
        stacks.forEach(stack => {
          if (!teamGroups.has(stack.team)) {
            teamGroups.set(stack.team, []);
          }
          teamGroups.get(stack.team).push(stack);
        });

        return {
          allStacks: stacks,
          byTeam: teamGroups,
          totalTeams: filteredDrafts.length
        };
      }, [filteredDrafts]);

      // Timeline data - exposure changes over time
      const timelineData = useMemo(() => {
        if (!drafts.length) return null;

        // Sort drafts chronologically (assuming they're in order, or we can use index as proxy)
        const sortedDrafts = [...drafts].map((draft, idx) => ({ ...draft, draftNumber: idx + 1 }));

        // Track cumulative exposure for each player over time
        const playerTimelines = new Map();
        
        sortedDrafts.forEach((draft, draftIndex) => {
          const team = draft.myTeam;
          if (!team) return;

          const totalDraftsSoFar = draftIndex + 1;

          // Get all unique players seen so far
          const allPlayersSoFar = new Set();
          sortedDrafts.slice(0, draftIndex + 1).forEach(d => {
            if (d.myTeam) {
              d.myTeam.forEach(p => {
                const key = `${p.name}-${p.position}-${p.team}`;
                allPlayersSoFar.add(key);
              });
            }
          });

          // Calculate exposure for each player at this point in time
          allPlayersSoFar.forEach(playerKey => {
            const [name, position, nflTeam] = playerKey.split('-');
            
            let countSoFar = 0;
            sortedDrafts.slice(0, draftIndex + 1).forEach(d => {
              if (d.myTeam) {
                const hasPlayer = d.myTeam.some(p => 
                  p.name === name && p.position === position && p.team === nflTeam
                );
                if (hasPlayer) countSoFar++;
              }
            });

            const exposureAtThisPoint = ((countSoFar / totalDraftsSoFar) * 100).toFixed(1);

            if (!playerTimelines.has(playerKey)) {
              playerTimelines.set(playerKey, {
                name,
                position,
                team: nflTeam,
                timeline: []
              });
            }

            playerTimelines.get(playerKey).timeline.push({
              draftNumber: draftIndex + 1,
              exposure: parseFloat(exposureAtThisPoint),
              count: countSoFar
            });
          });
        });

        // Convert to array and sort by final exposure
        const timelines = Array.from(playerTimelines.values())
          .map(player => ({
            ...player,
            finalExposure: player.timeline[player.timeline.length - 1].exposure,
            finalCount: player.timeline[player.timeline.length - 1].count
          }))
          .sort((a, b) => b.finalExposure - a.finalExposure);

        return {
          players: timelines,
          totalDrafts: drafts.length
        };
      }, [drafts]);

      const handleSort = (key) => {
        setSortConfig(prev => ({
          key,
          direction: prev.key === key && prev.direction === 'desc' ? 'asc' : 'desc'
        }));
      };

      const quickStats = useMemo(() => {
        if (!exposureData.length) return null;
        
        const totalTeams = filteredDrafts.length;
        
        // Calculate highest dollar player and total entry amount
        let topPlayerDollars = 0;
        let topPlayerName = '';
        let totalEntryAmount = 0;
        
        // Find the player with the highest total entry fee investment
        exposureData.forEach(player => {
          if (player.totalEntryFee > topPlayerDollars) {
            topPlayerDollars = player.totalEntryFee;
            topPlayerName = player.name;
          }
        });
        
        // Calculate total entry amount across all drafts
        filteredDrafts.forEach(draft => {
          if (draft.entryFee) {
            // Handle both number and string entry fees
            const feeValue = typeof draft.entryFee === 'number' ? draft.entryFee : parseFloat(String(draft.entryFee).replace(/[^0-9.]/g, ''));
            if (!isNaN(feeValue)) {
              totalEntryAmount += feeValue;
            }
          }
        });

        return {
          totalPlayers: exposureData.length,
          totalTeams,
          topPlayerDollars: topPlayerDollars > 0 ? `$${topPlayerDollars.toFixed(0)}` : '$0',
          topPlayerName: topPlayerName,
          totalEntryAmount: totalEntryAmount > 0 ? `$${totalEntryAmount.toFixed(0)}` : '$0',
          topExposure: exposureData.reduce((max, p) => Math.max(max, parseFloat(p.exposure)), 0).toFixed(1)
        };
      }, [exposureData, filteredDrafts]);
      
      // Portfolio Report Data
      const portfolioReportData = useMemo(() => {
        if (!drafts.length) return null;
        
        // 1. Total Stats
        const totalTeams = drafts.length;
        let totalInvested = 0;
        drafts.forEach(draft => {
          if (draft.entryFee) {
            const feeValue = typeof draft.entryFee === 'number' ? draft.entryFee : parseFloat(String(draft.entryFee).replace(/[^0-9.]/g, ''));
            if (!isNaN(feeValue)) totalInvested += feeValue;
          }
        });
        
        // 2. Top Tournaments (handle ties)
        const tournamentCounts = {};
        drafts.forEach(draft => {
          const tournament = draft.contest || 'Unknown';
          tournamentCounts[tournament] = (tournamentCounts[tournament] || 0) + 1;
        });
        const maxCount = Math.max(...Object.values(tournamentCounts));
        const topTournaments = Object.entries(tournamentCounts)
          .filter(([_, count]) => count === maxCount)
          .map(([name, count]) => `${name} (${count})`);
        const totalTournaments = Object.keys(tournamentCounts).length;
        
        // 3. Top Stacks (QB to WR/TE, excluding F/A)
        const stackCounts = {};
        drafts.forEach(draft => {
          if (!draft.myTeam) return;
          const qbs = draft.myTeam.filter(p => 
            p.position === 'QB' && 
            p.team && 
            p.team.trim() !== '' && 
            p.team !== 'F/A' && 
            p.team !== 'FA'
          );
          const receivers = draft.myTeam.filter(p => 
            (p.position === 'WR' || p.position === 'TE') && 
            p.team && 
            p.team.trim() !== '' && 
            p.team !== 'F/A' && 
            p.team !== 'FA'
          );
          
          qbs.forEach(qb => {
            receivers.forEach(rec => {
              if (qb.team === rec.team) {
                const stackKey = `${qb.name}|${qb.team}|${qb.position}|||${rec.name}|${rec.team}|${rec.position}`;
                if (!stackCounts[stackKey]) {
                  stackCounts[stackKey] = {
                    count: 0,
                    qbName: qb.name,
                    qbTeam: qb.team,
                    qbPos: qb.position,
                    recName: rec.name,
                    recTeam: rec.team,
                    recPos: rec.position
                  };
                }
                stackCounts[stackKey].count++;
              }
            });
          });
        });
        const topStacks = Object.values(stackCounts)
          .sort((a, b) => b.count - a.count)
          .slice(0, 3);
        
        // 4. Core Players (top 3 at each position)
        const positionExposures = { QB: [], RB: [], WR: [], TE: [] };
        exposureData.forEach(player => {
          if (positionExposures[player.position]) {
            positionExposures[player.position].push({
              name: player.name,
              exposure: parseFloat(player.exposure)
            });
          }
        });
        
        const corePlayers = {};
        ['QB', 'RB', 'WR', 'TE'].forEach(pos => {
          corePlayers[pos] = positionExposures[pos]
            .sort((a, b) => b.exposure - a.exposure)
            .slice(0, 3)
            .map(p => `${p.name} (${p.exposure.toFixed(0)}%)`);
        });
        
        // 5. Biggest Fades (top 50 ADP, <=3% exposure - prioritize 0% first)
        // Merge ranksData with exposureData to include 0% players
        let fades = [];
        if (ranksData && ranksData.length > 0) {
          const top50Players = ranksData
            .filter(p => parseFloat(p.adp) <= 50)
            .map(p => {
              // Check if player exists in exposureData
              const exposurePlayer = exposureData.find(e => 
                e.name === p.name && e.position === p.position
              );
              
              return {
                name: p.name,
                position: p.position,
                team: p.team,
                adp: p.adp,
                exposure: exposurePlayer ? exposurePlayer.exposure : "0.0"
              };
            });
          
          fades = top50Players
            .filter(p => parseFloat(p.exposure) <= 3)
            .sort((a, b) => {
              const aExp = parseFloat(a.exposure);
              const bExp = parseFloat(b.exposure);
              const aAdp = parseFloat(a.adp);
              const bAdp = parseFloat(b.adp);
              
              // Check if exactly 0
              const aIsZero = aExp === 0;
              const bIsZero = bExp === 0;
              
              // If one is 0% and the other isn't, 0% comes first
              if (aIsZero && !bIsZero) return -1;
              if (!aIsZero && bIsZero) return 1;
              
              // If both are 0% OR both are non-zero, sort by ADP (lowest first)
              return aAdp - bAdp;
            })
            .slice(0, 3);
        } else {
          // Fallback: use exposureData only (won't show 0% players)
          fades = exposureData
            .filter(p => p.adp && parseFloat(p.adp) <= 50 && parseFloat(p.exposure) <= 3)
            .sort((a, b) => parseFloat(a.adp) - parseFloat(b.adp))
            .slice(0, 3);
        }
        
        // 6. Most Common Roster Build
        const buildCounts = {};
        drafts.forEach(draft => {
          if (!draft.myTeam) return;
          const qb = draft.myTeam.filter(p => p.position === 'QB').length;
          const rb = draft.myTeam.filter(p => p.position === 'RB').length;
          const wr = draft.myTeam.filter(p => p.position === 'WR').length;
          const te = draft.myTeam.filter(p => p.position === 'TE').length;
          const buildKey = `${qb}-${rb}-${wr}-${te}`;
          buildCounts[buildKey] = (buildCounts[buildKey] || 0) + 1;
        });
        const mostCommonBuild = Object.entries(buildCounts)
          .sort((a, b) => b[1] - a[1])[0];
        const buildText = mostCommonBuild 
          ? `${mostCommonBuild[0]} (${((mostCommonBuild[1] / totalTeams) * 100).toFixed(0)}% of teams)`
          : 'N/A';
        
        // 7. BADGE CALCULATIONS
        const badges = [];
        
        // Calculate all badge metrics
        const badgeMetrics = {
          // Stack metrics
          totalQBs: 0,
          stackedQBs: 0,
          
          // Rookie metrics (F/A players)
          totalPicks: 0,
          rookiePicks: 0,
          
          // Build metrics
          buildDistribution: {},
          mostCommonBuildCount: 0,
          mostCommonBuildName: '',
          
          // Player exposure
          maxPlayerExposure: 0,
          maxPlayerName: '',
          
          // Tournament count
          tournamentCount: totalTournaments,
          
          // Team count
          teamCount: totalTeams,
          
          // Team stacks
          teamStackCounts: {},
          
          // QB/TE round metrics
          qbAfterRound9: 0,
          teAfterRound13: 0,
          
          // ADP metrics
          valuePlayers: 0,  // Drafted 10+ later than ADP
          reachPlayers: 0,  // Drafted 15+ earlier than ADP
          
          // Handcuff metrics
          totalRBs: 0,
          handcuffedRBs: 0,
          
          // Fade metrics
          top50Fades: 0
        };
        
        // Process each draft for badge metrics
        drafts.forEach(draft => {
          if (!draft.myTeam) return;
          
          // Stack calculation (QB paired with WR/TE same team)
          const qbs = draft.myTeam.filter(p => 
            p.position === 'QB' && p.team && p.team.trim() !== '' && p.team !== 'F/A' && p.team !== 'FA'
          );
          const passCatchers = draft.myTeam.filter(p => 
            (p.position === 'WR' || p.position === 'TE') && p.team && p.team.trim() !== '' && p.team !== 'F/A' && p.team !== 'FA'
          );
          
          qbs.forEach(qb => {
            badgeMetrics.totalQBs++;
            const hasStack = passCatchers.some(pc => pc.team === qb.team);
            if (hasStack) badgeMetrics.stackedQBs++;
          });
          
          // Rookie exposure (F/A players)
          draft.myTeam.forEach(p => {
            badgeMetrics.totalPicks++;
            if (!p.team || p.team === '' || p.team === 'F/A' || p.team === 'FA') {
              badgeMetrics.rookiePicks++;
            }
          });
          
          // Build tracking - roster construction (QB-RB-WR-TE format like 3-6-8-3)
          const qbCount = draft.myTeam.filter(p => p.position === 'QB').length;
          const rbCount = draft.myTeam.filter(p => p.position === 'RB').length;
          const wrCount = draft.myTeam.filter(p => p.position === 'WR').length;
          const teCount = draft.myTeam.filter(p => p.position === 'TE').length;
          const buildKey = `${qbCount}-${rbCount}-${wrCount}-${teCount}`;
          badgeMetrics.buildDistribution[buildKey] = (badgeMetrics.buildDistribution[buildKey] || 0) + 1;
          
          // Team stacks (4+ from same team)
          const teamCounts = {};
          draft.myTeam.forEach(p => {
            if (p.team && p.team !== 'F/A' && p.team !== 'FA') {
              teamCounts[p.team] = (teamCounts[p.team] || 0) + 1;
            }
          });
          Object.entries(teamCounts).forEach(([team, count]) => {
            if (count >= 4) {
              badgeMetrics.teamStackCounts[team] = (badgeMetrics.teamStackCounts[team] || 0) + 1;
            }
          });
          
          // QB round drafted
          const firstQB = draft.myTeam.find(p => p.position === 'QB');
          if (firstQB && firstQB.pick) {
            const round = Math.ceil(firstQB.pick / 12);
            if (round >= 10) badgeMetrics.qbAfterRound9++;
          }
          
          // TE round drafted
          const firstTE = draft.myTeam.find(p => p.position === 'TE');
          if (firstTE && firstTE.pick) {
            const round = Math.ceil(firstTE.pick / 12);
            if (round >= 14) badgeMetrics.teAfterRound13++;
          }
          
          // RB metrics for handcuff calculation
          const rbs = draft.myTeam.filter(p => p.position === 'RB');
          badgeMetrics.totalRBs += rbs.length;
          
          // Get top 15 RBs by ADP from this team
          const top15RBs = rbs
            .filter(rb => rb.adp && parseFloat(rb.adp) <= 60)
            .sort((a, b) => parseFloat(a.adp) - parseFloat(b.adp))
            .slice(0, 3);  // Check top 3 RBs on this team
          
          // Check if any are handcuffed
          top15RBs.forEach(topRB => {
            const hasHandcuff = rbs.some(rb => 
              rb.team === topRB.team && 
              rb.name !== topRB.name &&
              parseFloat(rb.adp || 999) > parseFloat(topRB.adp || 0)
            );
            if (hasHandcuff) badgeMetrics.handcuffedRBs++;
          });
          
          // ADP variance - track by unique player
          draft.myTeam.forEach(p => {
            if (p.adp && p.pick) {
              const adpNum = parseFloat(p.adp);
              const pickNum = parseFloat(p.pick);
              const diff = pickNum - adpNum;
              const playerKey = `${p.name}-${p.position}`;
              
              // Value Vulture (drafted later than ADP)
              if (diff >= 15) {
                if (!badgeMetrics.valuePlayerCounts) badgeMetrics.valuePlayerCounts = {};
                badgeMetrics.valuePlayerCounts[playerKey] = (badgeMetrics.valuePlayerCounts[playerKey] || 0) + 1;
              }
              
              // ADP Rebel (drafted earlier than ADP)
              if (diff <= -15) {
                if (!badgeMetrics.reachPlayerCounts) badgeMetrics.reachPlayerCounts = {};
                badgeMetrics.reachPlayerCounts[playerKey] = (badgeMetrics.reachPlayerCounts[playerKey] || 0) + 1;
              }
            }
          });
        });
        
        // Count unique players with minimum exposure (5% = ~3 teams for 55 team portfolio)
        const minDrafts = Math.max(2, Math.floor(totalTeams * 0.03));
        badgeMetrics.valuePlayers = badgeMetrics.valuePlayerCounts 
          ? Object.values(badgeMetrics.valuePlayerCounts).filter(count => count >= minDrafts).length 
          : 0;
        badgeMetrics.reachPlayers = badgeMetrics.reachPlayerCounts 
          ? Object.values(badgeMetrics.reachPlayerCounts).filter(count => count >= minDrafts).length 
          : 0;
        
        // Player exposure for Comfort Drafter
        if (exposureData.length > 0) {
          const maxExp = exposureData.reduce((max, p) => {
            const exp = parseFloat(p.exposure);
            return exp > max.exp ? { exp, name: p.name } : max;
          }, { exp: 0, name: '' });
          badgeMetrics.maxPlayerExposure = maxExp.exp;
          badgeMetrics.maxPlayerName = maxExp.name;
        }
        
        // Fade Master - count top 50 ADP players at 0%
        if (ranksData) {
          const top50 = ranksData.filter(p => parseFloat(p.adp) <= 50);
          badgeMetrics.top50Fades = top50.filter(p => {
            const playerInPortfolio = exposureData.find(e => 
              e.name === p.name && e.position === p.position
            );
            return !playerInPortfolio || parseFloat(playerInPortfolio.exposure) === 0;
          }).length;
        }
        
        // Calculate percentages
        const stackPct = badgeMetrics.totalQBs > 0 ? (badgeMetrics.stackedQBs / badgeMetrics.totalQBs) * 100 : 0;
        const rookiePct = badgeMetrics.totalPicks > 0 ? (badgeMetrics.rookiePicks / badgeMetrics.totalPicks) * 100 : 0;
        const qbDartPct = (badgeMetrics.qbAfterRound9 / totalTeams) * 100;
        const tePuntPct = (badgeMetrics.teAfterRound13 / totalTeams) * 100;
        const handcuffPct = badgeMetrics.totalRBs > 0 ? (badgeMetrics.handcuffedRBs / badgeMetrics.totalRBs) * 100 : 0;
        
        // Find most common build
        const mostCommonBuildEntry = Object.entries(badgeMetrics.buildDistribution)
          .sort((a, b) => b[1] - a[1])[0];
        badgeMetrics.mostCommonBuildName = mostCommonBuildEntry ? mostCommonBuildEntry[0] : '';
        badgeMetrics.mostCommonBuildCount = mostCommonBuildEntry ? mostCommonBuildEntry[1] : 0;
        const oneBuildPct = badgeMetrics.mostCommonBuildCount > 0 ? (badgeMetrics.mostCommonBuildCount / totalTeams) * 100 : 0;
        
        // Max team stack percentage
        const maxTeamStack = Object.values(badgeMetrics.teamStackCounts).reduce((max, count) => Math.max(max, count), 0);
        const maxTeamStackPct = totalTeams > 0 ? (maxTeamStack / totalTeams) * 100 : 0;
        const maxTeamStackName = Object.entries(badgeMetrics.teamStackCounts)
          .find(([_, count]) => count === maxTeamStack)?.[0] || '';
        
        // Check each badge condition
        if (badgeMetrics.top50Fades >= 10) {
          badges.push({ id: 'fade-master', title: 'Fade Master', tagline: 'The consensus is just noise to you', stat: `0% of ${badgeMetrics.top50Fades} top-50 players` });
        }
        
        const zeroRBPct = (drafts.filter(d => d.myTeam && d.myTeam.slice(0, 4).filter(p => p.position === 'RB').length === 0).length / totalTeams * 100);
        if (drafts.some(d => d.myTeam && d.myTeam.slice(0, 4).filter(p => p.position === 'RB').length === 0)) {
          if (zeroRBPct >= 50) {
            badges.push({ id: 'zero-rb-zealot', title: 'Zero-RB Zealot', tagline: 'Running backs are a myth you refuse to believe in', stat: `No RBs in first 4 rounds ${zeroRBPct.toFixed(0)}% of the time` });
          } else if (zeroRBPct >= 25) {
            badges.push({ id: 'zero-rb-purist', title: 'Zero-RB Purist', tagline: 'Wide receivers win leagues, period', stat: `No RBs in first 4 rounds ${zeroRBPct.toFixed(0)}% of the time` });
          }
        }
        
        if (stackPct > 85) {
          badges.push({ id: 'stack-addict', title: 'Stack Addict', tagline: 'You live and die by the correlation', stat: `${stackPct.toFixed(0)}% QB stack rate` });
        }
        
        if (stackPct < 50) {
          badges.push({ id: 'lone-wolf', title: 'Lone Wolf', tagline: 'Correlation is for cowards', stat: `${stackPct.toFixed(0)}% QB stack rate` });
        }
        
        if (rookiePct > 15) {
          badges.push({ id: 'rookie-truther', title: 'Rookie Truther', tagline: 'Why draft a 30-year-old when rookies exist', stat: `${rookiePct.toFixed(0)}% of all players drafted are rookies` });
        }
        
        if (rookiePct < 3) {
          badges.push({ id: 'rookie-fader', title: 'Rookie Fader', tagline: 'Rookies are for rebuilds, not championships', stat: `${rookiePct.toFixed(0)}% of all players drafted are rookies` });
        }
        
        if (badgeMetrics.valuePlayers >= 20) {
          badges.push({ id: 'value-vulture', title: 'Value Vulture', tagline: 'Draft rooms panic. You collect discounts.', stat: `${badgeMetrics.valuePlayers} players averaging 15+ picks of ADP value` });
        }
        
        if (totalTournaments >= 25) {
          badges.push({ id: 'exposure-overlord', title: 'Exposure Overlord', tagline: 'Diversification is your religion. Volume is your god.', stat: `${totalTournaments} tournaments` });
        } else if (totalTournaments >= 15) {
          badges.push({ id: 'portfolio-deity', title: 'Portfolio Deity', tagline: 'You don\'t build portfolios. You build empires.', stat: `${totalTournaments} tournaments` });
        } else if (totalTournaments >= 5) {
          badges.push({ id: 'portfolio-god', title: 'Portfolio God', tagline: 'Risk management through overwhelming volume.', stat: `${totalTournaments} tournaments` });
        }
        
        if (badgeMetrics.reachPlayers >= 20) {
          badges.push({ id: 'adp-rebel', title: 'ADP Rebel', tagline: 'If you like a player, you don\'t risk losing them.', stat: `${badgeMetrics.reachPlayers} players averaging 15+ picks of negative ADP value` });
        }
        
        if (totalTeams > 1000) {
          badges.push({ id: 'volume-shooter', title: 'Volume Shooter', tagline: 'Quantity has a quality of its own', stat: `${totalTeams} teams`, rare: true });
        }
        
        if (badgeMetrics.maxPlayerExposure > 50) {
          badges.push({ id: 'comfort-drafter', title: 'Comfort Drafter', tagline: 'If it worked once, it will work forever', stat: `${badgeMetrics.maxPlayerName} (${badgeMetrics.maxPlayerExposure.toFixed(1)}%)` });
        }
        
        const heroRBPct = (drafts.filter(d => d.myTeam && d.myTeam.slice(0, 4).filter(p => p.position === 'RB').length === 1).length / totalTeams * 100);
        if (drafts.some(d => d.myTeam && d.myTeam.slice(0, 4).filter(p => p.position === 'RB').length === 1) && heroRBPct > 40) {
          badges.push({ id: 'hero-rb', title: 'HERO-RB Enjoyer', tagline: 'One elite back, that\'s all you need', stat: `1 RB in first 4 rounds ${heroRBPct.toFixed(0)}% of the time` });
        }
        
        if (qbDartPct > 35) {
          badges.push({ id: 'qb-dart', title: 'QB Dart Thrower', tagline: 'Your QB room runs on vibes and spike weeks.', stat: `QB1 drafted after round 9 ${qbDartPct.toFixed(0)}% of the time` });
        }
        
        const first4RoundsQBPct = drafts.filter(d => {
          if (!d.myTeam) return false;
          const firstQB = d.myTeam.find(p => p.position === 'QB');
          if (!firstQB || !firstQB.pick) return false;
          return Math.ceil(firstQB.pick / 12) <= 4;
        }).length / totalTeams * 100;
        
        if (first4RoundsQBPct > 40) {
          badges.push({ id: 'elite-qb', title: 'ELITE QB TRUTHER', tagline: 'Elite QB play isn\'t a luxury, it\'s a necessity', stat: `QB drafted by round 4 ${first4RoundsQBPct.toFixed(0)}% of the time` });
        }
        
        if (Object.keys(badgeMetrics.buildDistribution).length >= 10) {
          badges.push({ id: 'build-experimenter', title: 'BUILD EXPERIMENTER', tagline: 'Meta is a suggestion, not a lifestyle.', stat: `${Object.keys(badgeMetrics.buildDistribution).length} unique roster constructions` });
        }
        
        if (handcuffPct > 15) {
          badges.push({ id: 'handcuff-hoarder', title: 'HANDCUFF HOARDER', tagline: 'Injury chaos is part of your business model', stat: `${handcuffPct.toFixed(0)}% handcuff draft rate` });
        }
        
        const first4RoundsTEPct = drafts.filter(d => {
          if (!d.myTeam) return false;
          const firstTE = d.myTeam.find(p => p.position === 'TE');
          if (!firstTE || !firstTE.pick) return false;
          return Math.ceil(firstTE.pick / 12) <= 4;
        }).length / totalTeams * 100;
        
        if (first4RoundsTEPct > 40) {
          badges.push({ id: 'elite-te', title: 'Elite TE Truther', tagline: 'The TE advantage is worth the early pick', stat: `TE drafted by round 4 ${first4RoundsTEPct.toFixed(0)}% of the time` });
        }
        
        if (tePuntPct > 40) {
          badges.push({ id: 'te-punt', title: 'TE Punt King', tagline: 'Tight end is a problem for future you.', stat: `TE1 drafted after round 13 ${tePuntPct.toFixed(0)}% of the time` });
        }
        
        if (oneBuildPct > 80) {
          badges.push({ id: 'one-build', title: 'ONE-BUILD WONDER', tagline: 'You found your formula and you\'re riding it', stat: `${badgeMetrics.mostCommonBuildName} roster construction ${oneBuildPct.toFixed(0)}% of the time` });
        }
        
        if (maxTeamStackPct > 25 && maxTeamStackName) {
          badges.push({ id: 'team-fan', title: `${maxTeamStackName}\'s Biggest Fan`, tagline: 'Hope the GM sends a Christmas card', stat: `Drafted 4+ players from this team ${maxTeamStackPct.toFixed(0)}% of the time` });
        }
        
        // ============ NEW BADGES ============
        
        // Balanced Portfolio Architect
        if (totalTeams >= 150 && badgeMetrics.maxPlayerExposure <= 30) {
          badges.push({ id: 'balanced-architect', title: 'Balanced Portfolio Architect', tagline: 'Risk is carefully engineered.', stat: `No player above 30% exposure, ${totalTeams} teams drafted` });
        }
        
        // WR Avalanche - â‰¥5 WRs before RB2 in >40% drafts
        const wrAvalancheCount = drafts.filter(d => {
          if (!d.myTeam) return false;
          const firstRB2 = d.myTeam.filter(p => p.position === 'RB')[1];
          if (!firstRB2 || !firstRB2.pick) return false;
          const rb2Pick = firstRB2.pick;
          const wrsBeforeRB2 = d.myTeam.filter(p => p.position === 'WR' && p.pick && p.pick < rb2Pick).length;
          return wrsBeforeRB2 >= 5;
        }).length;
        const wrAvalanchePct = (wrAvalancheCount / totalTeams) * 100;
        if (wrAvalanchePct > 40) {
          badges.push({ id: 'wr-avalanche', title: 'WR Avalanche', tagline: 'Running backs can wait. Receivers win now.', stat: `5+ WRs before RB2 ${wrAvalanchePct.toFixed(0)}% of the time` });
        }
        
        // Correlation Savant - Double stack â‰¥25% (of all QBs, not teams)
        let totalQBsForDoubleStack = 0;
        let doubleStackedQBs = 0;
        
        drafts.forEach(d => {
          if (!d.myTeam) return;
          const qbs = d.myTeam.filter(p => p.position === 'QB' && p.team && p.team !== 'F/A' && p.team !== 'FA');
          const passCatchers = d.myTeam.filter(p => (p.position === 'WR' || p.position === 'TE') && p.team && p.team !== 'F/A' && p.team !== 'FA');
          
          qbs.forEach(qb => {
            totalQBsForDoubleStack++;
            const sameTeamPassCatchers = passCatchers.filter(pc => pc.team === qb.team);
            if (sameTeamPassCatchers.length >= 2) {
              doubleStackedQBs++;
            }
          });
        });
        
        const doubleStackPct = totalQBsForDoubleStack > 0 ? (doubleStackedQBs / totalQBsForDoubleStack) * 100 : 0;
        if (doubleStackPct >= 25) {
          badges.push({ id: 'correlation-savant', title: 'Correlation Savant', tagline: 'One stack wasn\'t enough. You needed insurance.', stat: `QB double stacked ${doubleStackPct.toFixed(0)}% of the time` });
        }
        
        // ============ RARE BADGES ============
        
        // The Unstackable - <15% stack AND â‰¥75 teams
        if (stackPct < 15 && totalTeams >= 75) {
          badges.push({ id: 'unstackable', title: 'The Unstackable', tagline: 'Correlation never stood a chance.', stat: `QB stacked ${stackPct.toFixed(0)}% of the time across ${totalTeams} teams`, rare: true });
        }
        
        // Exposure Monolith - One player â‰¥70% AND 150+ teams
        if (badgeMetrics.maxPlayerExposure >= 70 && totalTeams >= 150) {
          badges.push({ id: 'exposure-monolith', title: 'Exposure Monolith', tagline: 'This season rides on one man.', stat: `${badgeMetrics.maxPlayerName} drafted ${badgeMetrics.maxPlayerExposure.toFixed(1)}%`, rare: true });
        }
        
        // The Spreadsheet - â‰¥30 tournaments AND 250+ teams AND 7+ personalities
        const personalityCount = badges.length;
        if (totalTournaments >= 30 && totalTeams >= 250 && personalityCount >= 7) {
          badges.push({ id: 'spreadsheet', title: 'The Spreadsheet', tagline: 'This stopped being a hobby months ago.', stat: `${totalTournaments} tournaments, ${totalTeams} teams, ${personalityCount} personalities unlocked`, rare: true });
        }
        
        // Pure Chaos - â‰¥15 unique builds AND stack 40-60%
        const uniqueBuilds = Object.keys(badgeMetrics.buildDistribution).length;
        if (uniqueBuilds >= 15 && stackPct >= 40 && stackPct <= 60) {
          badges.push({ id: 'pure-chaos', title: 'Pure Chaos', tagline: 'No two drafts look alike. Including yours.', stat: `${uniqueBuilds} unique builds, ${stackPct.toFixed(0)}% QB stack rate`, rare: true });
        }
        
        // SchrÃ¶dinger's Drafter - 35%+ early QB AND 35%+ late QB
        const earlyQBPct = (drafts.filter(d => {
          if (!d.myTeam) return false;
          const firstQB = d.myTeam.find(p => p.position === 'QB');
          if (!firstQB || !firstQB.pick) return false;
          return Math.ceil(firstQB.pick / 12) <= 4;
        }).length / totalTeams) * 100;
        const lateQBPct = (drafts.filter(d => {
          if (!d.myTeam) return false;
          const firstQB = d.myTeam.find(p => p.position === 'QB');
          if (!firstQB || !firstQB.pick) return false;
          return Math.ceil(firstQB.pick / 12) >= 10;
        }).length / totalTeams) * 100;
        if (earlyQBPct >= 35 && lateQBPct >= 35) {
          badges.push({ id: 'schrodingers-drafter', title: 'SchrÃ¶dinger\'s Drafter', tagline: 'You exist in all draft states simultaneously.', stat: `${earlyQBPct.toFixed(0)}% first QB by round 4, ${lateQBPct.toFixed(0)}% first QB after round 9`, rare: true });
        }
        
        // Exposure Flatliner - Top 10 within 3% range
        if (exposureData.length >= 10) {
          const top10 = exposureData.slice(0, 10).map(p => parseFloat(p.exposure));
          const maxExp = Math.max(...top10);
          const minExp = Math.min(...top10);
          if (maxExp - minExp <= 3) {
            badges.push({ id: 'exposure-flatliner', title: 'Exposure Flatliner', tagline: 'You diversified so hard it became art.', stat: `Top 10 most drafted players within 3% exposure range`, rare: true });
          }
        }
        
        // ADP Ghost - Avg deviation Â±2 picks
        let totalDeviation = 0;
        let deviationCount = 0;
        drafts.forEach(d => {
          if (!d.myTeam) return;
          d.myTeam.forEach(p => {
            if (p.adp && p.pick) {
              totalDeviation += Math.abs(parseFloat(p.pick) - parseFloat(p.adp));
              deviationCount++;
            }
          });
        });
        const avgDeviation = deviationCount > 0 ? totalDeviation / deviationCount : 999;
        if (avgDeviation <= 2) {
          badges.push({ id: 'adp-ghost', title: 'ADP Ghost', tagline: 'You drafted consensus with frightening precision.', stat: `Average deviation Â±${avgDeviation.toFixed(1)} picks across portfolio`, rare: true });
        }
        
        // All Gas No Brakes - 25+ picks early on â‰¥30 unique players
        if (!badgeMetrics.allGasPlayerCounts) badgeMetrics.allGasPlayerCounts = {};
        drafts.forEach(d => {
          if (!d.myTeam) return;
          d.myTeam.forEach(p => {
            if (p.adp && p.pick) {
              const diff = parseFloat(p.adp) - parseFloat(p.pick);
              if (diff >= 25) {
                const playerKey = `${p.name}-${p.position}`;
                badgeMetrics.allGasPlayerCounts[playerKey] = (badgeMetrics.allGasPlayerCounts[playerKey] || 0) + 1;
              }
            }
          });
        });
        const allGasPlayers = Object.keys(badgeMetrics.allGasPlayerCounts).length;
        if (allGasPlayers >= 30) {
          badges.push({ id: 'all-gas', title: 'All Gas No Brakes', tagline: 'Waiting is for cowards.', stat: `Reached on ${allGasPlayers} players by 25+ picks`, rare: true });
        }
        
        // The Collector - â‰¥400 unique players
        const allPlayers = new Set();
        drafts.forEach(d => {
          if (!d.myTeam) return;
          d.myTeam.forEach(p => allPlayers.add(`${p.name}-${p.position}`));
        });
        if (allPlayers.size >= 400) {
          badges.push({ id: 'collector', title: 'The Collector', tagline: 'You tried literally everyone.', stat: `${allPlayers.size} unique players drafted`, rare: true });
        }
        
        // The Archivist - â‰¥25 tournaments AND 300+ teams AND 15+ personalities
        if (totalTournaments >= 25 && totalTeams >= 300 && personalityCount >= 15) {
          badges.push({ id: 'archivist', title: 'The Archivist', tagline: 'You didn\'t just draft. You documented history.', stat: `${totalTournaments} tournaments, ${totalTeams} teams, ${personalityCount} personalities unlocked`, rare: true });
        }
        
        // The Sicko Portfolio - 5+ rare personalities
        const rareCount = badges.filter(b => b.rare).length;
        if (rareCount >= 5) {
          badges.push({ id: 'sicko-portfolio', title: 'The Sicko Portfolio', tagline: 'Please go outside.', stat: `${rareCount} rare personalities unlocked`, rare: true });
        }
        
        // ============ BADGE SELECTION WITH RARE PRIORITY ============
        
        // Separate rare and normal badges
        const rareBadges = badges.filter(b => b.rare);
        const normalBadges = badges.filter(b => !b.rare);
        
        // Prioritize rare badges (75% chance if any rare badges exist)
        let mainBadge = null;
        if (rareBadges.length > 0 && Math.random() < 0.75) {
          mainBadge = rareBadges[Math.floor(Math.random() * rareBadges.length)];
        } else if (badges.length > 0) {
          mainBadge = badges[Math.floor(Math.random() * badges.length)];
        }
        
        const miniBadges = badges; // All badges appear as mini badges
        
        return {
          totalTeams,
          totalInvested: totalInvested > 0 ? `$${totalInvested.toFixed(0)}` : '$0',
          totalTournaments,
          topTournaments,
          topStacks,
          corePlayers,
          fades,
          build: buildText,
          date: new Date().toLocaleDateString(),
          mainBadge,
          miniBadges
        };
      }, [drafts, exposureData, ranksData]);

      // Compute which badge to display (for html2canvas reliability)
      const displayedBadge = useMemo(() => {
        if (!portfolioReportData) return null;
        return activeBadge || portfolioReportData.mainBadge;
      }, [activeBadge, portfolioReportData]);

      // Colors - responsive to theme
      const isDarkTheme = localStorage.getItem('portfolio_theme') === 'dark';
      const ACCENT = isDarkTheme ? '#93c5fd' : '#3b82f6';         // Even lighter blue for dark mode
      const ACCENT_DIM = isDarkTheme ? 'rgba(96,165,250,0.15)' : 'rgba(59,130,246,0.1)';
      const BG_PRIMARY = isDarkTheme ? '#0a0e16' : '#f8fafc';
      const BG_SECONDARY = isDarkTheme ? '#111827' : '#ffffff';
      const BG_TERTIARY = isDarkTheme ? '#1f2937' : '#f1f5f9';
      const TEXT_PRIMARY = isDarkTheme ? '#f9fafb' : '#0f172a';
      const TEXT_SECONDARY = isDarkTheme ? '#9ca3af' : '#64748b';
      const BORDER_COLOR = isDarkTheme ? '#374151' : '#e2e8f0';
      
      // Shadow system for depth
      const SHADOW_SM = isDarkTheme 
        ? '0 1px 2px 0 rgba(0, 0, 0, 0.3)' 
        : '0 1px 2px 0 rgba(0, 0, 0, 0.05)';
      const SHADOW_MD = isDarkTheme 
        ? '0 4px 6px -1px rgba(0, 0, 0, 0.4), 0 2px 4px -1px rgba(0, 0, 0, 0.3)' 
        : '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)';
      const SHADOW_LG = isDarkTheme 
        ? '0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.4)' 
        : '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)';

      const POSITION_COLORS = {
        QB: '#ec4899',    // Pink (hot pink)
        RB: '#10b981',    // Green (keeping same)
        WR: '#eab308',    // Yellow (keeping same)
        TE: '#3b82f6',    // Blue (keeping same)
        K: '#ef4444',
        DST: '#6366f1'
      };

      return (
        <div style={{ 
          minHeight: '100vh', 
          background: BG_PRIMARY, 
          color: TEXT_PRIMARY,
          padding: '20px',
          fontFamily: '"Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif'
        }}>
          <div style={{ maxWidth: '1400px', margin: '0 auto' }}>
            {/* Header */}
            <div style={{ 
              display: 'flex', 
              justifyContent: 'space-between', 
              alignItems: 'center',
              marginBottom: '28px',
              flexWrap: 'wrap',
              gap: '16px',
              paddingBottom: '18px',
              borderBottom: `1px solid ${BORDER_COLOR}`
            }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                {/* Optimal Fantasy Logo - switches based on theme */}
                {isDarkTheme ? (
                  <svg width="170" height="48" viewBox="0 0 280 80" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="15" y="32" width="4" height="16" rx="2" fill="url(#gradDark)" />
                    <defs>
                      <linearGradient id="gradDark" x1="17" y1="32" x2="17" y2="48" gradientUnits="userSpaceOnUse">
                        <stop offset="0%" stopColor="#93c5fd" />
                        <stop offset="100%" stopColor="#3b82f6" />
                      </linearGradient>
                    </defs>
                    <text x="28" y="38" fontFamily="Inter, -apple-system, BlinkMacSystemFont, sans-serif" fontSize="22" fontWeight="800" fill="#f9fafb" letterSpacing="-0.5">OPTIMAL</text>
                    <text x="28" y="56" fontFamily="Inter, -apple-system, BlinkMacSystemFont, sans-serif" fontSize="18" fontWeight="600" fill="#93c5fd" letterSpacing="0.5">FANTASY</text>
                  </svg>
                ) : (
                  <svg width="170" height="48" viewBox="0 0 280 80" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="15" y="32" width="4" height="16" rx="2" fill="url(#gradLight)" />
                    <defs>
                      <linearGradient id="gradLight" x1="17" y1="32" x2="17" y2="48" gradientUnits="userSpaceOnUse">
                        <stop offset="0%" stopColor="#3b82f6" />
                        <stop offset="100%" stopColor="#2563eb" />
                      </linearGradient>
                    </defs>
                    <text x="28" y="38" fontFamily="Inter, -apple-system, BlinkMacSystemFont, sans-serif" fontSize="22" fontWeight="800" fill="#0f172a" letterSpacing="-0.5">OPTIMAL</text>
                    <text x="28" y="56" fontFamily="Inter, -apple-system, BlinkMacSystemFont, sans-serif" fontSize="18" fontWeight="600" fill="#3b82f6" letterSpacing="0.5">FANTASY</text>
                  </svg>
                )}
                
                {/* Product Title */}
                <h1 style={{ 
                  fontSize: '20px', 
                  fontWeight: '700',
                  margin: 0,
                  color: TEXT_PRIMARY,
                  letterSpacing: '-0.3px',
                  lineHeight: '1.2'
                }}>
                  Best Ball Portfolio Tracker
                </h1>
              </div>
              
              <div style={{ display: 'flex', gap: '12px', alignItems: 'center', flexWrap: 'wrap' }}>
                {/* 1. Getting Started (formerly How to Use) */}
                <button
                  onClick={() => setShowHowToUse(true)}
                  onMouseEnter={(e) => {
                    e.currentTarget.style.transform = 'translateY(-2px)';
                    e.currentTarget.style.boxShadow = '0 4px 12px rgba(234, 179, 8, 0.3)';
                  }}
                  onMouseLeave={(e) => {
                    e.currentTarget.style.transform = 'translateY(0)';
                    e.currentTarget.style.boxShadow = SHADOW_SM;
                  }}
                  style={{
                    padding: '11px 20px',
                    background: '#eab308',
                    border: '1px solid #ca8a04',
                    borderRadius: '8px',
                    cursor: 'pointer',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '8px',
                    fontWeight: '700',
                    fontSize: '14px',
                    color: '#000',
                    transition: 'all 0.2s ease',
                    boxShadow: SHADOW_SM,
                    transform: 'translateY(0)'
                  }}
                  title="Learn how to use this tool"
                >
                  Getting Started
                </button>

                {/* 2. Import Data */}
                <label 
                  onMouseEnter={(e) => {
                    e.currentTarget.style.transform = 'translateY(-2px)';
                    e.currentTarget.style.boxShadow = SHADOW_MD;
                  }}
                  onMouseLeave={(e) => {
                    e.currentTarget.style.transform = 'translateY(0)';
                    e.currentTarget.style.boxShadow = SHADOW_SM;
                  }}
                  style={{
                  padding: '11px 20px',
                  background: ACCENT,
                  borderRadius: '8px',
                  cursor: 'pointer',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '8px',
                  fontWeight: '700',
                  fontSize: '14px',
                  border: 'none',
                  color: '#ffffff',
                  boxShadow: SHADOW_SM,
                  transform: 'translateY(0)',
                  transition: 'all 0.2s ease'
                }}>
                  <Upload size={18} />
                  Import Data
                  <input
                    type="file"
                    accept=".json,.csv"
                    onChange={handleFileUpload}
                    style={{ display: 'none' }}
                  />
                </label>
                
                {/* 3. Sync from ADP */}
                <button
                  onClick={syncFromADP}
                  onMouseEnter={(e) => {
                    e.currentTarget.style.transform = 'translateY(-2px)';
                    e.currentTarget.style.boxShadow = SHADOW_MD;
                  }}
                  onMouseLeave={(e) => {
                    e.currentTarget.style.transform = 'translateY(0)';
                    e.currentTarget.style.boxShadow = SHADOW_SM;
                  }}
                  style={{
                    padding: '11px 20px',
                    background: ranksData.length > 0 ? 'rgba(34, 197, 94, 0.12)' : BG_SECONDARY,
                    border: `1px solid ${ranksData.length > 0 ? 'rgba(34, 197, 94, 0.4)' : BORDER_COLOR}`,
                    borderRadius: '8px',
                    cursor: 'pointer',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '8px',
                    fontWeight: '700',
                    fontSize: '14px',
                    color: ranksData.length > 0 ? '#22c55e' : TEXT_PRIMARY,
                    transition: 'all 0.2s ease',
                    boxShadow: SHADOW_SM,
                    transform: 'translateY(0)'
                  }}
                  title={ranksLastSync ? `Last synced: ${ranksLastSync}` : 'Sync ADP data from web'}
                >
                  <span style={{ fontSize: '18px' }}>{ranksData.length > 0 ? 'âœ“' : 'â†»'}</span>
                  Sync from ADP
                </button>

                {/* 4. All Entry Fees */}
                {uniqueEntryFees.length > 0 && (
                  <select
                    value={entryFeeFilter}
                    onChange={(e) => setEntryFeeFilter(e.target.value)}
                    style={{
                      padding: '11px 16px',
                      background: BG_SECONDARY,
                      border: `2px solid ${BORDER_COLOR}`,
                      borderRadius: '6px',
                      color: TEXT_PRIMARY,
                      fontWeight: '600',
                      fontSize: '14px',
                      cursor: 'pointer',
                      outline: 'none'
                    }}
                  >
                    <option value="ALL">All Entry Fees</option>
                    {uniqueEntryFees.map(fee => (
                      <option key={fee} value={fee}>${fee}</option>
                    ))}
                  </select>
                )}

                {/* 5. All Tournaments (NEW) */}
                {uniqueTournaments.length > 0 && (
                  <select
                    value={tournamentFilter}
                    onChange={(e) => setTournamentFilter(e.target.value)}
                    style={{
                      padding: '11px 16px',
                      background: BG_SECONDARY,
                      border: `2px solid ${BORDER_COLOR}`,
                      borderRadius: '6px',
                      color: TEXT_PRIMARY,
                      fontWeight: '600',
                      fontSize: '14px',
                      cursor: 'pointer',
                      outline: 'none'
                    }}
                  >
                    <option value="ALL">All Tournaments</option>
                    {uniqueTournaments.map(tournament => (
                      <option key={tournament} value={tournament}>{tournament}</option>
                    ))}
                  </select>
                )}
                
                {/* 6. X Drafts Saved */}
                {drafts.length > 0 && (
                  <>
                    <div style={{
                      padding: '11px 20px',
                      background: 'rgba(34, 197, 94, 0.1)',
                      border: '2px solid rgba(34, 197, 94, 0.3)',
                      borderRadius: '6px',
                      fontWeight: '600',
                      fontSize: '14px',
                      color: 'rgb(34, 197, 94)',
                      display: 'flex',
                      alignItems: 'center',
                      gap: '8px'
                    }}>
                      <span style={{ fontSize: '16px' }}>â—</span>
                      <span>{drafts.length} draft{drafts.length !== 1 ? 's' : ''} saved</span>
                    </div>
                    
                    {/* 7. Clear All */}
                    <button
                      onClick={clearAllDrafts}
                      onMouseEnter={(e) => {
                        e.currentTarget.style.transform = 'translateY(-2px)';
                        e.currentTarget.style.background = 'rgba(239, 68, 68, 0.15)';
                        e.currentTarget.style.boxShadow = SHADOW_MD;
                      }}
                      onMouseLeave={(e) => {
                        e.currentTarget.style.transform = 'translateY(0)';
                        e.currentTarget.style.background = 'rgba(239, 68, 68, 0.1)';
                        e.currentTarget.style.boxShadow = SHADOW_SM;
                      }}
                      style={{
                        padding: '11px 20px',
                        background: 'rgba(239, 68, 68, 0.1)',
                        border: '1px solid rgba(239, 68, 68, 0.3)',
                        borderRadius: '8px',
                        cursor: 'pointer',
                        fontWeight: '700',
                        fontSize: '14px',
                        color: 'rgb(239, 68, 68)',
                        display: 'flex',
                        alignItems: 'center',
                        gap: '8px',
                        transition: 'all 0.2s ease',
                        boxShadow: SHADOW_SM,
                        transform: 'translateY(0)'
                      }}
                    >
                      Clear All
                    </button>
                  </>
                )}
              </div>
            </div>

            {/* Sample Data Banner */}
            {drafts.length === 8 && drafts[0].name === 'Sample Draft 1' && (
              <div style={{
                background: 'linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(147, 51, 234, 0.1) 100%)',
                border: `2px solid ${ACCENT}`,
                borderRadius: '12px',
                padding: '20px 24px',
                marginBottom: '24px',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'space-between',
                gap: '16px',
                flexWrap: 'wrap'
              }}>
                <div style={{ flex: 1 }}>
                  <div style={{ fontSize: '18px', fontWeight: '700', color: TEXT_PRIMARY, marginBottom: '6px' }}>
                    Sample Data Loaded
                  </div>
                  <div style={{ fontSize: '14px', color: TEXT_SECONDARY, lineHeight: '1.5' }}>
                    Exploring the tool? This is sample data to show you how it works. Clear it and upload your own Underdog drafts to get started!
                  </div>
                </div>
                <button
                  onClick={() => {
                    if (confirm('Clear sample data? This will remove all 3 sample drafts.')) {
                      setDrafts([]);
                    }
                  }}
                  onMouseEnter={(e) => {
                    e.currentTarget.style.transform = 'translateY(-2px)';
                    e.currentTarget.style.boxShadow = SHADOW_MD;
                  }}
                  onMouseLeave={(e) => {
                    e.currentTarget.style.transform = 'translateY(0)';
                    e.currentTarget.style.boxShadow = SHADOW_SM;
                  }}
                  style={{
                    padding: '12px 24px',
                    background: ACCENT,
                    color: '#fff',
                    border: 'none',
                    borderRadius: '8px',
                    fontSize: '14px',
                    fontWeight: '700',
                    cursor: 'pointer',
                    transition: 'all 0.2s ease',
                    boxShadow: SHADOW_SM,
                    whiteSpace: 'nowrap'
                  }}
                >
                  Clear Sample Data
                </button>
              </div>
            )}

            {/* Tabs */}
            {drafts.length > 0 && (
              <div style={{
                display: 'flex',
                gap: '16px',
                marginBottom: '28px',
                alignItems: 'center',
                flexWrap: 'wrap'
              }}>
                <div style={{ 
                  display: 'flex', 
                  gap: '4px', 
                  background: BG_TERTIARY,
                  borderRadius: '8px',
                  padding: '4px',
                  border: `1px solid ${BORDER_COLOR}`
                }}>
                  {['overview', 'correlations', 'construction', 'fades', 'teams', 'about'].map((tab) => (
                    <button
                      key={tab}
                      onClick={() => {
                        setActiveTab(tab);
                        // Track tab switch
                        if (window.plausible) window.plausible('Tab Switched', { props: { tab: tab } });
                      }}
                      onMouseEnter={(e) => {
                        if (activeTab !== tab) {
                          e.currentTarget.style.background = isDarkTheme ? 'rgba(255,255,255,0.05)' : 'rgba(0,0,0,0.03)';
                        }
                      }}
                      onMouseLeave={(e) => {
                        if (activeTab !== tab) {
                          e.currentTarget.style.background = 'transparent';
                        }
                      }}
                      style={{
                        padding: '9px 22px',
                        border: 'none',
                        background: activeTab === tab ? BG_SECONDARY : 'transparent',
                        color: activeTab === tab ? TEXT_PRIMARY : TEXT_SECONDARY,
                        fontWeight: activeTab === tab ? '700' : '600',
                        cursor: 'pointer',
                        borderRadius: '6px',
                        textTransform: 'capitalize',
                        transition: 'all 0.2s ease',
                        fontSize: '14px',
                        boxShadow: activeTab === tab ? SHADOW_SM : 'none'
                      }}
                    >
                      {tab}
                    </button>
                  ))}
                </div>

                {/* THE PORTFOLIO REPORT Button */}
                {portfolioReportData && (
                  <button
                    onClick={() => {
                      setShowPortfolioReport(true);
                      // Track Recapped button click
                      if (window.plausible) window.plausible('Recapped Opened');
                    }}
                    onMouseEnter={(e) => {
                      e.currentTarget.style.transform = 'translateY(-2px) scale(1.03)';
                      e.currentTarget.style.boxShadow = '0 10px 25px rgba(249, 115, 22, 0.5)';
                    }}
                    onMouseLeave={(e) => {
                      e.currentTarget.style.transform = 'translateY(0) scale(1)';
                      e.currentTarget.style.boxShadow = '0 6px 16px rgba(249, 115, 22, 0.35)';
                    }}
                    style={{
                      padding: '11px 28px',
                      background: 'linear-gradient(135deg, #f97316 0%, #ef4444 100%)',
                      border: 'none',
                      borderRadius: '12px',
                      cursor: 'pointer',
                      display: 'flex',
                      alignItems: 'center',
                      gap: '8px',
                      fontWeight: '900',
                      fontSize: '15px',
                      color: '#ffffff',
                      transition: 'all 0.2s ease',
                      boxShadow: '0 6px 16px rgba(249, 115, 22, 0.35)',
                      transform: 'translateY(0) scale(1)',
                      letterSpacing: '0.5px',
                      textTransform: 'uppercase'
                    }}
                    title="See your Optimal Report"
                  >
                    ðŸ“Š Optimal Report
                    <span style={{
                      background: 'rgba(255, 255, 255, 0.3)',
                      padding: '2px 8px',
                      borderRadius: '6px',
                      fontSize: '10px',
                      fontWeight: '800',
                      letterSpacing: '0.5px'
                    }}>NEW!</span>
                  </button>
                )}
              </div>
            )}

            {/* Content */}
            {drafts.length === 0 ? (
              <div style={{
                background: BG_SECONDARY,
                borderRadius: '8px',
                padding: '60px',
                textAlign: 'center',
                border: `2px dashed ${BORDER_COLOR}`,
                boxShadow: '0 1px 3px rgba(0, 0, 0, 0.05)'
              }}>
                <Upload size={48} style={{ color: TEXT_SECONDARY, margin: '0 auto 20px' }} />
                <h3 style={{ fontSize: '20px', marginBottom: '10px', color: TEXT_PRIMARY, fontWeight: '600' }}>No Drafts Loaded</h3>
                <p style={{ color: TEXT_SECONDARY, marginBottom: '24px', fontSize: '15px' }}>
                  Import your Underdog draft data to analyze your portfolio
                </p>
                <div style={{ color: TEXT_SECONDARY, fontSize: '14px', maxWidth: '500px', margin: '0 auto', lineHeight: '1.8', textAlign: 'left' }}>
                  <p style={{ marginBottom: '16px', fontWeight: '600', color: TEXT_PRIMARY, textAlign: 'center' }}>
                    How to Import Your Drafts:
                  </p>
                  <ol style={{ margin: '0', paddingLeft: '24px' }}>
                    <li style={{ marginBottom: '12px' }}>
                      In <strong>Underdog Fantasy</strong>, go to <strong>Completed</strong>
                    </li>
                    <li style={{ marginBottom: '12px' }}>
                      Find your <strong>NFL Best Ball</strong> drafts
                    </li>
                    <li style={{ marginBottom: '12px' }}>
                      Click <strong>"Email Exposure CSV"</strong>
                    </li>
                    <li style={{ marginBottom: '12px' }}>
                      Check your email and download the CSV
                    </li>
                    <li>
                      Click <strong>"Import Data"</strong> above and select the file
                    </li>
                  </ol>
                </div>
              </div>
            ) : (
              <>
                {/* OVERVIEW TAB */}
                {activeTab === 'overview' && (
                  <div>
                    {/* Quick Stats Cards */}
                    {quickStats && (
                      <div style={{ 
                        display: 'grid', 
                        gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
                        gap: '16px',
                        marginBottom: '32px'
                      }}>
                        <div style={{ 
                          background: BG_SECONDARY, 
                          padding: '20px', 
                          borderRadius: '8px',
                          border: `1px solid ${BORDER_COLOR}`,
                          borderTop: `3px solid ${ACCENT}`
                        }}>
                          <div style={{ marginBottom: '10px' }}>
                            <span style={{ color: TEXT_SECONDARY, fontSize: '13px', fontWeight: '600', textTransform: 'uppercase', letterSpacing: '0.5px' }}>
                              {entryFeeFilter === 'ALL' ? 'Total Teams' : `Teams (${entryFeeFilter})`}
                            </span>
                          </div>
                          <div style={{ fontSize: '32px', fontWeight: '700', color: TEXT_PRIMARY }}>
                            {quickStats.totalTeams}
                          </div>
                          {entryFeeFilter !== 'ALL' && (
                            <div style={{ fontSize: '12px', color: TEXT_SECONDARY, marginTop: '6px', fontWeight: '600' }}>
                              of {drafts.length} total
                            </div>
                          )}
                        </div>

                        <div style={{ 
                          background: BG_SECONDARY, 
                          padding: '20px', 
                          borderRadius: '8px',
                          border: `1px solid ${BORDER_COLOR}`,
                          borderTop: `3px solid ${ACCENT}`
                        }}>
                          <div style={{ marginBottom: '10px' }}>
                            <span style={{ color: TEXT_SECONDARY, fontSize: '13px', fontWeight: '600', textTransform: 'uppercase', letterSpacing: '0.5px' }}>Unique Players</span>
                          </div>
                          <div style={{ fontSize: '32px', fontWeight: '700', color: TEXT_PRIMARY }}>
                            {quickStats.totalPlayers}
                          </div>
                        </div>

                        <div style={{ 
                          background: BG_SECONDARY, 
                          padding: '20px', 
                          borderRadius: '8px',
                          border: `1px solid ${BORDER_COLOR}`,
                          borderTop: `3px solid ${ACCENT}`
                        }}>
                          <div style={{ marginBottom: '10px' }}>
                            <span style={{ color: TEXT_SECONDARY, fontSize: '13px', fontWeight: '600', textTransform: 'uppercase', letterSpacing: '0.5px' }}>Entry Fees</span>
                          </div>
                          <div style={{ fontSize: '32px', fontWeight: '700', color: TEXT_PRIMARY }}>
                            {quickStats.totalEntryAmount}
                          </div>
                        </div>

                        <div style={{ 
                          background: BG_SECONDARY, 
                          padding: '20px', 
                          borderRadius: '8px',
                          border: `1px solid ${BORDER_COLOR}`,
                          borderTop: `3px solid ${ACCENT}`
                        }}>
                          <div style={{ marginBottom: '10px' }}>
                            <span style={{ color: TEXT_SECONDARY, fontSize: '13px', fontWeight: '600', textTransform: 'uppercase', letterSpacing: '0.5px' }}>Top Exposure</span>
                          </div>
                          <div style={{ fontSize: '32px', fontWeight: '700', color: TEXT_PRIMARY }}>
                            {quickStats.topExposure}%
                          </div>
                        </div>

                        <div style={{ 
                          background: BG_SECONDARY, 
                          padding: '20px', 
                          borderRadius: '8px',
                          border: `1px solid ${BORDER_COLOR}`,
                          borderTop: `3px solid ${ACCENT}`
                        }}>
                          <div style={{ marginBottom: '10px' }}>
                            <span style={{ color: TEXT_SECONDARY, fontSize: '13px', fontWeight: '600', textTransform: 'uppercase', letterSpacing: '0.5px' }}>Biggest Investment</span>
                          </div>
                          <div style={{ fontSize: '32px', fontWeight: '700', color: TEXT_PRIMARY }}>
                            {quickStats.topPlayerDollars}
                          </div>
                          {quickStats.topPlayerName && (
                            <div style={{ fontSize: '13px', color: TEXT_SECONDARY, marginTop: '6px', fontWeight: '600' }}>
                              {quickStats.topPlayerName}
                            </div>
                          )}
                        </div>
                      </div>
                    )}

                    {/* Search and Filter Controls */}
                    <div style={{ 
                      display: 'flex', 
                      gap: '12px', 
                      marginBottom: '24px',
                      flexWrap: 'wrap',
                      alignItems: 'center'
                    }}>
                      <div style={{ position: 'relative', flex: '1 1 300px', minWidth: '250px' }}>
                        <Search 
                          size={18} 
                          style={{ 
                            position: 'absolute', 
                            left: '14px', 
                            top: '50%', 
                            transform: 'translateY(-50%)',
                            color: TEXT_SECONDARY 
                          }} 
                        />
                        <input
                          type="text"
                          placeholder="Search players..."
                          value={overviewSearch}
                          onChange={(e) => { setOverviewSearch(e.target.value); setCurrentPage(1); }}
                          style={{
                            width: '100%',
                            padding: '11px 14px 11px 42px',
                            background: BG_SECONDARY,
                            border: `1px solid ${BORDER_COLOR}`,
                            borderRadius: '6px',
                            color: TEXT_PRIMARY,
                            fontSize: '14px',
                            outline: 'none'
                          }}
                        />
                      </div>

                      <div style={{ display: 'flex', gap: '6px', flexWrap: 'wrap' }}>
                        {['ALL', 'QB', 'RB', 'WR', 'TE'].map((pos) => (
                          <button
                            key={pos}
                            onClick={() => { setPositionFilter(pos); setCurrentPage(1); }}
                            style={{
                              padding: '9px 18px',
                              border: `1px solid ${positionFilter === pos ? (pos === 'ALL' ? ACCENT : POSITION_COLORS[pos]) : BORDER_COLOR}`,
                              borderRadius: '6px',
                              background: positionFilter === pos ? (pos === 'ALL' ? ACCENT : POSITION_COLORS[pos]) : BG_SECONDARY,
                              color: positionFilter === pos ? '#fff' : TEXT_PRIMARY,
                              fontWeight: '600',
                              fontSize: '14px',
                              cursor: 'pointer',
                              transition: 'all 0.2s'
                            }}
                          >
                            {pos}
                          </button>
                        ))}
                      </div>
                    </div>

                    {/* Table */}
                    <div style={{ 
                      background: BG_SECONDARY, 
                      borderRadius: '8px', 
                      overflow: 'hidden',
                      marginBottom: '24px',
                      border: `1px solid ${BORDER_COLOR}`
                    }}>
                      <div style={{ padding: '14px 20px', borderBottom: `1px solid ${BORDER_COLOR}`, display: 'flex', justifyContent: 'space-between', alignItems: 'center', background: BG_TERTIARY }}>
                        <h3 style={{ fontSize: '13px', fontWeight: '700', color: TEXT_SECONDARY, margin: 0, textTransform: 'uppercase', letterSpacing: '0.8px' }}>
                          Player Exposures
                        </h3>
                        <span style={{ color: TEXT_SECONDARY, fontSize: '13px', fontWeight: '600' }}>
                          Showing {Math.min((currentPage - 1) * PAGE_SIZE + 1, sortedExposure.length)}â€“{Math.min(currentPage * PAGE_SIZE, sortedExposure.length)} of {sortedExposure.length} players
                        </span>
                      </div>
                      <div style={{ overflowX: 'auto' }}>
                        <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                          <thead>
                            <tr style={{ background: BG_TERTIARY }}>
                              {[
                                { key: 'name', label: 'Player' },
                                { key: 'position', label: 'Position' },
                                { key: 'team', label: 'Team' },
                                { key: 'count', label: 'Count' },
                                { key: 'exposure', label: 'Exposure %' },
                                { key: 'totalEntryFee', label: 'Total Entry Fees' },
                                { key: 'adp', label: 'ADP' },
                                { key: 'avgPick', label: 'Avg Pick' },
                                { key: 'difference', label: 'Diff' }
                              ].map(({ key, label }) => (
                                <th
                                  key={key}
                                  onClick={() => handleSort(key)}
                                  style={{
                                  padding: '12px 16px',
                                    textAlign: 'left',
                                    fontWeight: '600',
                                    cursor: 'pointer',
                                    userSelect: 'none',
                                    color: TEXT_SECONDARY,
                                    fontSize: '12px',
                                    textTransform: 'uppercase',
                                    letterSpacing: '0.6px'
                                  }}
                                >
                                  {label} {sortConfig.key === key && (sortConfig.direction === 'asc' ? 'â†‘' : 'â†“')}
                                </th>
                              ))}
                            </tr>
                          </thead>
                          <tbody>
                            {sortedExposure.slice((currentPage - 1) * PAGE_SIZE, currentPage * PAGE_SIZE).map((player, idx) => (
                              <tr
                                key={`${player.name}-${idx}`}
                                onClick={() => setSelectedPlayerDetail(player)}
                                style={{
                                  borderBottom: `1px solid ${BORDER_COLOR}`,
                                  cursor: 'pointer'
                                }}
                              >
                                <td style={{ padding: '18px 20px', color: TEXT_PRIMARY, fontWeight: '600' }}>
                                  <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                    {player.name}
                                    <span style={{ color: ACCENT, fontSize: '18px', opacity: 0.6 }}>
                                      â“˜
                                    </span>
                                  </div>
                                </td>
                                <td style={{ padding: '18px 20px' }}>
                                  <span style={{
                                    background: POSITION_COLORS[player.position] || '#6b7280',
                                    color: '#fff',
                                    padding: '5px 12px',
                                    borderRadius: '6px',
                                    fontSize: '12px',
                                    fontWeight: '700'
                                  }}>
                                    {player.position}
                                  </span>
                                </td>
                                <td style={{ padding: '18px 20px', color: TEXT_SECONDARY, fontWeight: '600', fontSize: '13px' }}>{player.team}</td>
                                <td style={{ padding: '18px 20px', color: TEXT_PRIMARY, fontWeight: '600' }}>{player.count}</td>
                                <td style={{ padding: '18px 20px', color: ACCENT, fontWeight: '700' }}>{player.exposure}%</td>
                                <td style={{ padding: '18px 20px', color: player.totalEntryFee > 0 ? ACCENT : TEXT_SECONDARY, fontWeight: '700' }}>
                                  {player.totalEntryFee > 0 ? `$${player.totalEntryFee.toFixed(0)}` : '-'}
                                </td>
                                <td style={{ padding: '18px 20px', color: TEXT_SECONDARY, fontWeight: '600', fontSize: '13px' }}>
                                  {player.adp ? player.adp : '-'}
                                </td>
                                <td style={{ padding: '18px 20px', color: TEXT_PRIMARY, fontWeight: '600' }}>{player.avgPick}</td>
                                <td style={{ padding: '18px 20px', fontWeight: '700', fontSize: '14px' }}>
                                  {(() => {
                                    if (!player.adp || player.adp === '-') return '-';
                                    const diff = player.avgPick - parseFloat(player.adp);
                                    const color = diff > 0 ? '#22c55e' : diff < 0 ? '#ef4444' : TEXT_SECONDARY;
                                    const sign = diff > 0 ? '+' : '';
                                    return (
                                      <span style={{ color }}>
                                        {sign}{diff.toFixed(1)}
                                      </span>
                                    );
                                  })()}
                                </td>
                              </tr>
                            ))}
                          </tbody>
                        </table>
                      </div>

                      {/* Pagination Controls */}
                      {sortedExposure.length > PAGE_SIZE && (() => {
                        const totalPages = Math.ceil(sortedExposure.length / PAGE_SIZE);
                        // Build page numbers: always show first, last, and window around current
                        const pages = [];
                        for (let i = 1; i <= totalPages; i++) {
                          if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
                            pages.push(i);
                          } else if (pages[pages.length - 1] !== '...') {
                            pages.push('...');
                          }
                        }
                        return (
                          <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '6px', padding: '16px 24px', borderTop: `1px solid ${BORDER_COLOR}` }}>
                            {/* Prev */}
                            <button
                              onClick={() => setCurrentPage(p => Math.max(1, p - 1))}
                              disabled={currentPage === 1}
                              onMouseEnter={(e) => {
                                if (currentPage !== 1) {
                                  e.currentTarget.style.transform = 'translateY(-2px)';
                                  e.currentTarget.style.boxShadow = SHADOW_MD;
                                }
                              }}
                              onMouseLeave={(e) => {
                                if (currentPage !== 1) {
                                  e.currentTarget.style.transform = 'translateY(0)';
                                  e.currentTarget.style.boxShadow = SHADOW_SM;
                                }
                              }}
                              style={{
                                padding: '10px 16px',
                                border: `1px solid ${BORDER_COLOR}`,
                                borderRadius: '8px',
                                background: currentPage === 1 ? BG_TERTIARY : BG_SECONDARY,
                                color: currentPage === 1 ? TEXT_SECONDARY : TEXT_PRIMARY,
                                fontWeight: '700',
                                fontSize: '14px',
                                cursor: currentPage === 1 ? 'default' : 'pointer',
                                opacity: currentPage === 1 ? 0.5 : 1,
                                transition: 'all 0.2s ease',
                                boxShadow: currentPage === 1 ? 'none' : SHADOW_SM,
                                transform: 'translateY(0)'
                              }}
                            >â† Prev</button>

                            {/* Page numbers */}
                            {pages.map((p, i) => p === '...' ? (
                              <span key={`dots-${i}`} style={{ color: TEXT_SECONDARY, fontSize: '13px', padding: '0 4px' }}>â€¦</span>
                            ) : (
                              <button
                                key={p}
                                onClick={() => setCurrentPage(p)}
                                style={{
                                  width: '36px',
                                  height: '36px',
                                  border: p === currentPage ? `2px solid ${ACCENT}` : `1px solid ${BORDER_COLOR}`,
                                  borderRadius: '6px',
                                  background: p === currentPage ? ACCENT : BG_SECONDARY,
                                  color: p === currentPage ? '#fff' : TEXT_PRIMARY,
                                  fontWeight: '700',
                                  fontSize: '13px',
                                  cursor: 'pointer'
                                }}
                              >{p}</button>
                            ))}

                            {/* Next */}
                            <button
                              onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))}
                              disabled={currentPage === totalPages}
                              onMouseEnter={(e) => {
                                if (currentPage !== totalPages) {
                                  e.currentTarget.style.transform = 'translateY(-2px)';
                                  e.currentTarget.style.boxShadow = SHADOW_MD;
                                }
                              }}
                              onMouseLeave={(e) => {
                                if (currentPage !== totalPages) {
                                  e.currentTarget.style.transform = 'translateY(0)';
                                  e.currentTarget.style.boxShadow = SHADOW_SM;
                                }
                              }}
                              style={{
                                padding: '10px 16px',
                                border: `1px solid ${BORDER_COLOR}`,
                                borderRadius: '8px',
                                background: currentPage === totalPages ? BG_TERTIARY : BG_SECONDARY,
                                color: currentPage === totalPages ? TEXT_SECONDARY : TEXT_PRIMARY,
                                fontWeight: '700',
                                fontSize: '14px',
                                cursor: currentPage === totalPages ? 'default' : 'pointer',
                                opacity: currentPage === totalPages ? 0.5 : 1,
                                transition: 'all 0.2s ease',
                                boxShadow: currentPage === totalPages ? 'none' : SHADOW_SM,
                                transform: 'translateY(0)'
                              }}
                            >Next â†’</button>
                          </div>
                        );
                      })()}
                    </div>
                  </div>
                )}

                {/* CORRELATIONS TAB */}
                {activeTab === 'correlations' && (
                  <div>
                    <div style={{ marginBottom: '32px' }}>
                      <h3 style={{ fontSize: '16px', fontWeight: '700', marginBottom: '8px', color: TEXT_PRIMARY, textTransform: 'uppercase', letterSpacing: '0.5px' }}>
                        Select Players to Analyze
                      </h3>
                      <p style={{ color: TEXT_SECONDARY, fontSize: '14px', marginBottom: '16px' }}>
                        Search and select one or more players to find common teammates
                      </p>
                      
                      {selectedPlayers.length > 0 && (
                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '8px', marginBottom: '16px' }}>
                          {selectedPlayers.map((player, idx) => (
                            <div
                              key={`selected-${idx}`}
                              style={{
                                background: BG_SECONDARY,
                                padding: '8px 14px',
                                borderRadius: '6px',
                                display: 'flex',
                                alignItems: 'center',
                                gap: '8px',
                                border: `2px solid ${ACCENT}`
                              }}
                            >
                              <span style={{ color: TEXT_PRIMARY, fontWeight: '600' }}>{player.name}</span>
                              <span style={{
                                background: POSITION_COLORS[player.position],
                                color: '#fff',
                                padding: '3px 8px',
                                borderRadius: '4px',
                                fontSize: '11px',
                                fontWeight: '700'
                              }}>
                                {player.position}
                              </span>
                              <button
                                onClick={() => setSelectedPlayers(prev => prev.filter((_, i) => i !== idx))}
                                style={{
                                  background: 'none',
                                  border: 'none',
                                  color: TEXT_SECONDARY,
                                  cursor: 'pointer',
                                  padding: '0 4px',
                                  fontSize: '20px',
                                  fontWeight: '700'
                                }}
                              >
                                Ã—
                              </button>
                            </div>
                          ))}
                          <button
                            onClick={() => {
                              setSelectedPlayers([]);
                              setPlayerListCollapsed(false); // Reopen player list
                            }}
                            style={{
                              background: BG_SECONDARY,
                              border: `2px solid ${BORDER_COLOR}`,
                              color: TEXT_PRIMARY,
                              padding: '8px 14px',
                              borderRadius: '6px',
                              cursor: 'pointer',
                              fontSize: '13px',
                              fontWeight: '600'
                            }}
                          >
                            Clear All
                          </button>
                        </div>
                      )}

                      <div style={{ position: 'relative', maxWidth: '600px' }}>
                        <Search size={18} style={{ position: 'absolute', left: '14px', top: '50%', transform: 'translateY(-50%)', color: TEXT_SECONDARY, zIndex: 1 }} />
                        <input
                          type="text"
                          placeholder="Search players..."
                          value={correlationSearchInput}
                          onChange={(e) => { setCorrelationSearchInput(e.target.value); setShowAutocomplete(true); }}
                          onFocus={() => setShowAutocomplete(true)}
                          onBlur={() => setTimeout(() => setShowAutocomplete(false), 200)}
                          style={{
                            width: '100%',
                            padding: '12px 14px 12px 42px',
                            background: BG_SECONDARY,
                            border: `1px solid ${BORDER_COLOR}`,
                            borderRadius: '6px',
                            color: TEXT_PRIMARY,
                            fontSize: '15px',
                            outline: 'none'
                          }}
                        />
                        
                        {showAutocomplete && autocompleteSuggestions.length > 0 && (
                          <div style={{
                            position: 'absolute',
                            top: '100%',
                            left: 0,
                            right: 0,
                            marginTop: '6px',
                            background: BG_SECONDARY,
                            border: `2px solid ${ACCENT}`,
                            borderRadius: '6px',
                            maxHeight: '320px',
                            overflowY: 'auto',
                            zIndex: 10,
                            boxShadow: '0 8px 24px rgba(0, 0, 0, 0.15)'
                          }}>
                            {autocompleteSuggestions.map((player, idx) => (
                              <div
                                key={`auto-${idx}`}
                                onMouseDown={() => {
                                  setSelectedPlayers(prev => [...prev, player]);
                                  setCorrelationSearchInput('');
                                  setShowAutocomplete(false);
                                }}
                                style={{
                                  padding: '12px 16px',
                                  cursor: 'pointer',
                                  borderBottom: idx < autocompleteSuggestions.length - 1 ? `1px solid ${BORDER_COLOR}` : 'none',
                                  display: 'flex',
                                  justifyContent: 'space-between'
                                }}
                              >
                                <div>
                                  <div style={{ color: TEXT_PRIMARY, fontWeight: '600', marginBottom: '4px' }}>{player.name}</div>
                                  <div style={{ fontSize: '13px', color: TEXT_SECONDARY, fontWeight: '600' }}>{player.team} â€¢ {player.exposure}% exposure</div>
                                </div>
                                <span style={{
                                  background: POSITION_COLORS[player.position],
                                  color: '#fff',
                                  padding: '4px 10px',
                                  borderRadius: '4px',
                                  fontSize: '12px',
                                  fontWeight: '700'
                                }}>{player.position}</span>
                              </div>
                            ))}
                          </div>
                        )}
                      </div>
                    </div>

                    {/* Player List - Collapsible */}
                    <div style={{ 
                      background: BG_SECONDARY, 
                      borderRadius: '8px', 
                      overflow: 'hidden',
                      marginBottom: '32px',
                      border: `1px solid ${BORDER_COLOR}`
                    }}>
                      <div 
                        onClick={() => setPlayerListCollapsed(!playerListCollapsed)}
                        style={{ 
                          padding: '14px 20px', 
                          borderBottom: playerListCollapsed ? 'none' : `1px solid ${BORDER_COLOR}`, 
                          background: BG_TERTIARY,
                          cursor: 'pointer',
                          display: 'flex',
                          justifyContent: 'space-between',
                          alignItems: 'center'
                        }}
                      >
                        <h3 style={{ fontSize: '13px', fontWeight: '700', color: TEXT_SECONDARY, margin: 0, textTransform: 'uppercase', letterSpacing: '0.8px' }}>
                          All Players (SELECT PLAYERS TO SEE CORRELATIONS)
                        </h3>
                        <span style={{ fontSize: '18px', color: TEXT_SECONDARY, fontWeight: '700' }}>
                          {playerListCollapsed ? 'â–¼' : 'â–²'}
                        </span>
                      </div>
                      {!playerListCollapsed && (
                        <div style={{ maxHeight: '400px', overflowY: 'auto' }}>
                          {exposureData
                            .filter(p => p.adp)
                            .sort((a, b) => parseFloat(a.adp) - parseFloat(b.adp))
                            .map((player, idx) => (
                              <div
                                key={idx}
                                onClick={() => {
                                  const alreadySelected = selectedPlayers.some(p => 
                                    p.name === player.name && p.position === player.position
                                  );
                                  if (!alreadySelected) {
                                    setSelectedPlayers(prev => [...prev, {
                                      name: player.name,
                                      position: player.position,
                                      team: player.team
                                    }]);
                                    // Auto-collapse after selection
                                    setPlayerListCollapsed(true);
                                  }
                                }}
                                style={{
                                  padding: '16px 20px',
                                  borderBottom: idx < exposureData.filter(p => p.adp).length - 1 ? `1px solid ${BORDER_COLOR}` : 'none',
                                  cursor: 'pointer',
                                  transition: 'background 0.2s',
                                  display: 'flex',
                                  justifyContent: 'space-between',
                                  alignItems: 'center'
                                }}
                                onMouseEnter={(e) => e.currentTarget.style.background = BG_TERTIARY}
                                onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}
                              >
                                <div>
                                  <div style={{ fontWeight: '600', color: TEXT_PRIMARY, marginBottom: '4px' }}>
                                    {player.name}
                                  </div>
                                  <div style={{ fontSize: '13px', color: TEXT_SECONDARY, fontWeight: '600' }}>
                                    {player.team} â€¢ {player.exposure}% exposure
                                  </div>
                                </div>
                                <span style={{
                                  background: POSITION_COLORS[player.position],
                                  color: '#fff',
                                  padding: '4px 10px',
                                  borderRadius: '4px',
                                  fontSize: '12px',
                                  fontWeight: '700'
                                }}>
                                  {player.position}
                                </span>
                              </div>
                            ))}
                        </div>
                      )}
                    </div>

                    {correlationData ? (
                      <div>
                        <div style={{ background: BG_SECONDARY, borderRadius: '8px', padding: '28px', marginBottom: '32px', border: `2px solid ${ACCENT}` }}>
                          <h2 style={{ fontSize: '20px', fontWeight: '700', marginBottom: '16px', color: TEXT_PRIMARY }}>
                            {selectedPlayers.length === 1 ? 'Selected Player' : `${selectedPlayers.length} Players Combined`}
                          </h2>
                          
                          <div style={{ display: 'flex', gap: '40px', flexWrap: 'wrap' }}>
                            <div>
                              <div style={{ color: TEXT_SECONDARY, fontSize: '12px', marginBottom: '6px', fontWeight: '600' }}>
                                Teams with {selectedPlayers.length > 1 ? 'All Players' : 'Player'}
                              </div>
                              <div style={{ fontSize: '32px', fontWeight: '700', color: ACCENT }}>{correlationData.teamsWithAllPlayers}</div>
                            </div>
                            <div>
                              <div style={{ color: TEXT_SECONDARY, fontSize: '12px', marginBottom: '6px', fontWeight: '600' }}>Combined Exposure</div>
                              <div style={{ fontSize: '32px', fontWeight: '700', color: TEXT_PRIMARY }}>{correlationData.combinedExposure}%</div>
                            </div>
                            <div>
                              <div style={{ color: TEXT_SECONDARY, fontSize: '12px', marginBottom: '6px', fontWeight: '600' }}>Common Teammates</div>
                              <div style={{ fontSize: '32px', fontWeight: '700', color: TEXT_PRIMARY }}>{correlationData.teammates.length}</div>
                            </div>
                          </div>
                        </div>

                        <div style={{ background: BG_SECONDARY, borderRadius: '8px', overflow: 'hidden', border: `1px solid ${BORDER_COLOR}` }}>
                          <div style={{ padding: '20px 24px', background: BG_TERTIARY }}>
                            <h3 style={{ fontSize: '16px', fontWeight: '700', margin: '0 0 16px 0' }}>
                              Common Teammates ({correlationData.teammates.length})
                            </h3>
                            <div style={{ position: 'relative' }}>
                              <Search 
                                size={18} 
                                style={{ 
                                  position: 'absolute', 
                                  left: '14px', 
                                  top: '50%', 
                                  transform: 'translateY(-50%)',
                                  color: TEXT_SECONDARY 
                                }} 
                              />
                              <input
                                type="text"
                                placeholder="Search teammates by name or team..."
                                value={teammateSearch}
                                onChange={(e) => setTeammateSearch(e.target.value)}
                                style={{
                                  width: '100%',
                                  padding: '11px 14px 11px 42px',
                                  background: BG_SECONDARY,
                                  border: `1px solid ${BORDER_COLOR}`,
                                  borderRadius: '6px',
                                  color: TEXT_PRIMARY,
                                  fontSize: '14px',
                                  outline: 'none'
                                }}
                              />
                            </div>
                          </div>
                          <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                            <thead>
                              <tr style={{ background: BG_TERTIARY }}>
                                <th style={{ padding: '18px 20px', textAlign: 'left', fontWeight: '700' }}>Player</th>
                                <th style={{ padding: '18px 20px', textAlign: 'left', fontWeight: '700' }}>Position</th>
                                <th style={{ padding: '18px 20px', textAlign: 'left', fontWeight: '700' }}>Team</th>
                                <th style={{ padding: '18px 20px', textAlign: 'left', fontWeight: '700' }}>Times Together</th>
                                <th style={{ padding: '18px 20px', textAlign: 'left', fontWeight: '700' }}>Correlation %</th>
                              </tr>
                            </thead>
                            <tbody>
                              {correlationData.teammates
                                  .filter(teammate => {
                                    if (!teammateSearch) return true;
                                    const search = teammateSearch.toLowerCase();
                                    return teammate.name.toLowerCase().includes(search) || 
                                           teammate.team.toLowerCase().includes(search);
                                  })
                                  .map((teammate, idx) => {
                                    const isSameTeam = selectedPlayers.some(sp => 
                                      sp.team === teammate.team && 
                                      teammate.team && 
                                      teammate.team.trim() !== '' && 
                                      teammate.team !== 'F/A' && 
                                      teammate.team !== 'FA'
                                    );
                                    return (
                                      <tr
                                        key={`teammate-${idx}`}
                                        style={{
                                          borderBottom: `1px solid ${BORDER_COLOR}`,
                                          background: isSameTeam ? 'rgba(0, 168, 225, 0.15)' : BG_SECONDARY,
                                          borderLeft: isSameTeam ? `4px solid ${ACCENT}` : 'none'
                                        }}
                                      >
                                        <td style={{ padding: '18px 20px', color: TEXT_PRIMARY, fontWeight: '600' }}>
                                          <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                            {teammate.name}
                                            {isSameTeam && (
                                              <span style={{ 
                                                background: ACCENT,
                                                color: '#fff',
                                                padding: '4px 10px',
                                                borderRadius: '4px',
                                                fontSize: '11px', 
                                                fontWeight: '700',
                                                textTransform: 'uppercase',
                                                letterSpacing: '0.5px'
                                              }}>
                                                ðŸ”¥ STACK
                                              </span>
                                            )}
                                          </div>
                                        </td>
                                        <td style={{ padding: '18px 20px' }}>
                                          <span style={{
                                            background: POSITION_COLORS[teammate.position],
                                            color: '#fff',
                                            padding: '4px 10px',
                                            borderRadius: '4px',
                                            fontSize: '12px',
                                            fontWeight: '700'
                                          }}>
                                            {teammate.position}
                                          </span>
                                        </td>
                                        <td style={{ padding: '18px 20px', color: TEXT_SECONDARY, fontWeight: '600' }}>{teammate.team}</td>
                                        <td style={{ padding: '18px 20px', fontWeight: '600' }}>{teammate.count}</td>
                                        <td style={{ padding: '18px 20px', color: ACCENT, fontWeight: '700' }}>{teammate.correlation}%</td>
                                      </tr>
                                    );
                                  })}
                            </tbody>
                          </table>
                        </div>
                      </div>
                    ) : (
                      <div style={{ background: BG_SECONDARY, borderRadius: '8px', padding: '60px', textAlign: 'center', border: `2px dashed ${BORDER_COLOR}` }}>
                        <Search size={48} style={{ color: TEXT_SECONDARY, margin: '0 auto 20px' }} />
                        <h3 style={{ fontSize: '20px', marginBottom: '10px', fontWeight: '600' }}>No Players Selected</h3>
                        <p style={{ color: TEXT_SECONDARY, maxWidth: '500px', margin: '0 auto' }}>Use the search bar above to find and select players</p>
                      </div>
                    )}
                  </div>
                )}


                {/* CONSTRUCTION TAB */}
                {activeTab === 'construction' && constructionData && (
                  <div>
                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(400px, 1fr))', gap: '20px', marginBottom: '20px' }}>
                      <div style={{ background: BG_SECONDARY, borderRadius: '8px', padding: '24px', border: `1px solid ${BORDER_COLOR}` }}>
                        <h3 style={{ fontSize: '16px', fontWeight: '700', marginBottom: '6px' }}>First 2 Picks Distribution</h3>
                        <p style={{ color: TEXT_SECONDARY, fontSize: '13px', marginBottom: '20px', fontWeight: '600' }}>
                          Your first two picks in each draft
                        </p>
                        <div style={{ height: '300px', position: 'relative' }}>
                          <BarChart 
                            data={constructionData.first2Picks.map(item => ({
                              ...item,
                              combo: `Pick 1-2: ${item.combo}`
                            }))} 
                            dataKey="count" 
                            labelKey="combo" 
                            color={ACCENT} 
                            height={300} 
                          />
                        </div>
                      </div>

                      <div style={{ background: BG_SECONDARY, borderRadius: '8px', padding: '24px', border: `1px solid ${BORDER_COLOR}` }}>
                        <h3 style={{ fontSize: '16px', fontWeight: '700', marginBottom: '6px' }}>First 2 Picks Breakdown</h3>
                        <p style={{ color: TEXT_SECONDARY, fontSize: '13px', marginBottom: '20px', fontWeight: '600' }}>
                          Position combinations (Pick 1 - Pick 2)
                        </p>
                        <div style={{ height: '300px', position: 'relative' }}>
                          <PieChart 
                            data={constructionData.first2Picks.map(item => ({
                              ...item,
                              label: item.combo
                            }))} 
                            dataKey="count" 
                            labelKey="label" 
                            height={300} 
                          />
                        </div>
                      </div>
                    </div>

                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(400px, 1fr))', gap: '20px' }}>
                      <div style={{ background: BG_SECONDARY, borderRadius: '8px', padding: '24px', border: `1px solid ${BORDER_COLOR}` }}>
                        <h3 style={{ fontSize: '16px', fontWeight: '700', marginBottom: '6px' }}>Hero RB Strategy</h3>
                        <p style={{ color: TEXT_SECONDARY, fontSize: '13px', marginBottom: '20px', fontWeight: '600' }}>Exactly 1 RB in first 4 picks</p>
                        <div style={{ marginBottom: '20px' }}>
                          <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
                            <span style={{ color: TEXT_SECONDARY, fontWeight: '600' }}>Teams</span>
                            <span style={{ color: POSITION_COLORS.RB, fontWeight: '700' }}>
                              {constructionData.heroRB} ({((constructionData.heroRB / constructionData.totalTeams) * 100).toFixed(1)}%)
                            </span>
                          </div>
                          <div style={{ width: '100%', height: '10px', background: BG_TERTIARY, borderRadius: '5px', overflow: 'hidden', border: `1px solid ${BORDER_COLOR}` }}>
                            <div style={{ width: `${(constructionData.heroRB / constructionData.totalTeams) * 100}%`, height: '100%', background: POSITION_COLORS.RB }} />
                          </div>
                        </div>
                        <div style={{ height: '200px', position: 'relative' }}>
                          <BarChart 
                            data={[{ 
                              name: `${constructionData.heroRB} Teams (${((constructionData.heroRB / constructionData.totalTeams) * 100).toFixed(1)}%)`, 
                              count: constructionData.heroRB 
                            }]} 
                            dataKey="count" 
                            labelKey="name" 
                            color={POSITION_COLORS.RB} 
                            height={200} 
                          />
                        </div>
                      </div>

                      <div style={{ background: BG_SECONDARY, borderRadius: '8px', padding: '24px', border: `1px solid ${BORDER_COLOR}` }}>
                        <h3 style={{ fontSize: '16px', fontWeight: '700', marginBottom: '6px' }}>Zero RB Strategy</h3>
                        <p style={{ color: TEXT_SECONDARY, fontSize: '13px', marginBottom: '20px', fontWeight: '600' }}>0 RBs in first 4 picks</p>
                        <div style={{ marginBottom: '20px' }}>
                          <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
                            <span style={{ color: TEXT_SECONDARY, fontWeight: '600' }}>Teams</span>
                            <span style={{ color: POSITION_COLORS.WR, fontWeight: '700' }}>
                              {constructionData.zeroRB} ({((constructionData.zeroRB / constructionData.totalTeams) * 100).toFixed(1)}%)
                            </span>
                          </div>
                          <div style={{ width: '100%', height: '10px', background: BG_TERTIARY, borderRadius: '5px', overflow: 'hidden', border: `1px solid ${BORDER_COLOR}` }}>
                            <div style={{ width: `${(constructionData.zeroRB / constructionData.totalTeams) * 100}%`, height: '100%', background: POSITION_COLORS.WR }} />
                          </div>
                        </div>
                        <div style={{ height: '200px', position: 'relative' }}>
                          <BarChart 
                            data={[{ 
                              name: `${constructionData.zeroRB} Teams (${((constructionData.zeroRB / constructionData.totalTeams) * 100).toFixed(1)}%)`, 
                              count: constructionData.zeroRB 
                            }]} 
                            dataKey="count" 
                            labelKey="name" 
                            color={POSITION_COLORS.WR} 
                            height={200} 
                          />
                        </div>
                      </div>
                    </div>

                    {/* Team Build Breakdown - side by side */}
                    <div style={{ background: BG_SECONDARY, borderRadius: '8px', padding: '24px', border: `1px solid ${BORDER_COLOR}`, marginTop: '20px' }}>
                      <h3 style={{ fontSize: '16px', fontWeight: '700', marginBottom: '6px' }}>Team Build Breakdown</h3>
                      <p style={{ color: TEXT_SECONDARY, fontSize: '13px', marginBottom: '20px', fontWeight: '600' }}>
                        Distribution of QB/RB/WR/TE across all teams
                      </p>
                      <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '32px', alignItems: 'start' }}>
                        {/* Left: Pie */}
                        <div>
                          <div style={{ height: '340px', position: 'relative' }}>
                            <PieChart
                              data={constructionData.teamBuilds.map(b => ({ ...b, label: b.build }))}
                              dataKey="count"
                              labelKey="label"
                              height={340}
                            />
                          </div>
                        </div>

                        {/* Right: Horizontal bar chart with position pill labels */}
                        <div style={{ paddingTop: '12px' }}>
                          {/* Legend */}
                          <div style={{ display: 'flex', gap: '16px', marginBottom: '18px', flexWrap: 'wrap' }}>
                            {[
                              { pos: 'QB', label: 'QB', color: POSITION_COLORS.QB },
                              { pos: 'RB', label: 'RB', color: POSITION_COLORS.RB },
                              { pos: 'WR', label: 'WR', color: POSITION_COLORS.WR },
                              { pos: 'TE', label: 'TE', color: POSITION_COLORS.TE }
                            ].map(item => (
                              <div key={item.pos} style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>
                                <div style={{ width: '12px', height: '12px', borderRadius: '3px', background: item.color }} />
                                <span style={{ fontSize: '13px', fontWeight: '600', color: TEXT_SECONDARY }}>{item.label}</span>
                              </div>
                            ))}
                          </div>

                          {/* Bars - Split into columns if more than 8 builds */}
                          {(() => {
                            const maxCount = Math.max(...constructionData.teamBuilds.map(b => b.count));
                            const builds = constructionData.teamBuilds;
                            const shouldSplit = builds.length > 8;
                            const columnStyle = shouldSplit ? { 
                              display: 'grid', 
                              gridTemplateColumns: '1fr 1fr', 
                              gap: '20px' 
                            } : {};
                            
                            const renderBuild = (b, i) => {
                              const parts = b.build.split('/').map(Number);
                              const pct = ((b.count / constructionData.totalTeams) * 100).toFixed(1);
                              const barWidth = (b.count / maxCount) * 100;
                              return (
                                <div key={i} style={{ marginBottom: '14px' }}>
                                  <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '6px' }}>
                                    <div style={{ display: 'flex', gap: '5px', alignItems: 'center' }}>
                                      {[
                                        { count: parts[0], color: POSITION_COLORS.QB, pos: 'QB' },
                                        { count: parts[1], color: POSITION_COLORS.RB, pos: 'RB' },
                                        { count: parts[2], color: POSITION_COLORS.WR, pos: 'WR' },
                                        { count: parts[3], color: POSITION_COLORS.TE, pos: 'TE' }
                                      ].map(p => (
                                        <span key={p.pos} style={{
                                          display: 'inline-flex',
                                          alignItems: 'center',
                                          justifyContent: 'center',
                                          minWidth: '32px',
                                          height: '28px',
                                          padding: '0 8px',
                                          borderRadius: '6px',
                                          background: p.color,
                                          color: '#fff',
                                          fontSize: '14px',
                                          fontWeight: '900'
                                        }}>{p.count}{p.pos}</span>
                                      ))}
                                    </div>
                                    <span style={{ fontSize: '13px', fontWeight: '700', color: TEXT_PRIMARY }}>
                                      {b.count} <span style={{ color: TEXT_SECONDARY, fontWeight: '600' }}>({pct}%)</span>
                                    </span>
                                  </div>
                                  <div style={{ width: '100%', height: '22px', background: BG_TERTIARY, borderRadius: '5px', overflow: 'hidden', border: `1px solid ${BORDER_COLOR}` }}>
                                    <div style={{
                                      width: `${barWidth}%`,
                                      height: '100%',
                                      background: ACCENT,
                                      borderRadius: '5px',
                                      transition: 'width 0.4s ease'
                                    }} />
                                  </div>
                                </div>
                              );
                            };
                            
                            if (shouldSplit) {
                              const midpoint = Math.ceil(builds.length / 2);
                              const leftBuilds = builds.slice(0, midpoint);
                              const rightBuilds = builds.slice(midpoint);
                              
                              return (
                                <div style={columnStyle}>
                                  <div>{leftBuilds.map((b, i) => renderBuild(b, i))}</div>
                                  <div>{rightBuilds.map((b, i) => renderBuild(b, midpoint + i))}</div>
                                </div>
                              );
                            } else {
                              return <div>{builds.map((b, i) => renderBuild(b, i))}</div>;
                            }
                          })()}
                        </div>
                      </div>
                    </div>

                    {/* Position Count Tendencies */}
                    <div style={{ background: BG_SECONDARY, borderRadius: '8px', padding: '24px', border: `1px solid ${BORDER_COLOR}`, marginTop: '20px' }}>
                      <h3 style={{ fontSize: '16px', fontWeight: '700', marginBottom: '6px' }}>Position Count Tendencies</h3>
                      <p style={{ color: TEXT_SECONDARY, fontSize: '13px', marginBottom: '20px', fontWeight: '600' }}>
                        How often you draft specific position counts (e.g., 2QB, 3QB, 4RB, 5RB, etc.)
                      </p>
                      
                      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '20px' }}>
                        {/* QB Distribution */}
                        <div>
                          <h4 style={{ fontSize: '14px', fontWeight: '700', color: POSITION_COLORS.QB, marginBottom: '12px' }}>QB Distribution</h4>
                          <div style={{ height: '250px', position: 'relative' }}>
                            <BarChart 
                              data={constructionData.positionDistributions.QB.map(d => ({
                                name: d.label,
                                count: d.teams,
                                percentage: ((d.teams / constructionData.totalTeams) * 100).toFixed(1)
                              }))} 
                              dataKey="count" 
                              labelKey="name" 
                              color={POSITION_COLORS.QB} 
                              height={250} 
                            />
                          </div>
                          <div style={{ marginTop: '12px', display: 'flex', flexDirection: 'column', gap: '4px' }}>
                            {constructionData.positionDistributions.QB.map((d, idx) => (
                              <div key={idx} style={{ display: 'flex', justifyContent: 'space-between', fontSize: '12px', color: TEXT_SECONDARY }}>
                                <span>{d.label}</span>
                                <span style={{ fontWeight: '600' }}>{d.teams} teams ({((d.teams / constructionData.totalTeams) * 100).toFixed(1)}%)</span>
                              </div>
                            ))}
                          </div>
                        </div>

                        {/* RB Distribution */}
                        <div>
                          <h4 style={{ fontSize: '14px', fontWeight: '700', color: POSITION_COLORS.RB, marginBottom: '12px' }}>RB Distribution</h4>
                          <div style={{ height: '250px', position: 'relative' }}>
                            <BarChart 
                              data={constructionData.positionDistributions.RB.map(d => ({
                                name: d.label,
                                count: d.teams,
                                percentage: ((d.teams / constructionData.totalTeams) * 100).toFixed(1)
                              }))} 
                              dataKey="count" 
                              labelKey="name" 
                              color={POSITION_COLORS.RB} 
                              height={250} 
                            />
                          </div>
                          <div style={{ marginTop: '12px', display: 'flex', flexDirection: 'column', gap: '4px' }}>
                            {constructionData.positionDistributions.RB.map((d, idx) => (
                              <div key={idx} style={{ display: 'flex', justifyContent: 'space-between', fontSize: '12px', color: TEXT_SECONDARY }}>
                                <span>{d.label}</span>
                                <span style={{ fontWeight: '600' }}>{d.teams} teams ({((d.teams / constructionData.totalTeams) * 100).toFixed(1)}%)</span>
                              </div>
                            ))}
                          </div>
                        </div>

                        {/* WR Distribution */}
                        <div>
                          <h4 style={{ fontSize: '14px', fontWeight: '700', color: POSITION_COLORS.WR, marginBottom: '12px' }}>WR Distribution</h4>
                          <div style={{ height: '250px', position: 'relative' }}>
                            <BarChart 
                              data={constructionData.positionDistributions.WR.map(d => ({
                                name: d.label,
                                count: d.teams,
                                percentage: ((d.teams / constructionData.totalTeams) * 100).toFixed(1)
                              }))} 
                              dataKey="count" 
                              labelKey="name" 
                              color={POSITION_COLORS.WR} 
                              height={250} 
                            />
                          </div>
                          <div style={{ marginTop: '12px', display: 'flex', flexDirection: 'column', gap: '4px' }}>
                            {constructionData.positionDistributions.WR.map((d, idx) => (
                              <div key={idx} style={{ display: 'flex', justifyContent: 'space-between', fontSize: '12px', color: TEXT_SECONDARY }}>
                                <span>{d.label}</span>
                                <span style={{ fontWeight: '600' }}>{d.teams} teams ({((d.teams / constructionData.totalTeams) * 100).toFixed(1)}%)</span>
                              </div>
                            ))}
                          </div>
                        </div>

                        {/* TE Distribution */}
                        <div>
                          <h4 style={{ fontSize: '14px', fontWeight: '700', color: POSITION_COLORS.TE, marginBottom: '12px' }}>TE Distribution</h4>
                          <div style={{ height: '250px', position: 'relative' }}>
                            <BarChart 
                              data={constructionData.positionDistributions.TE.map(d => ({
                                name: d.label,
                                count: d.teams,
                                percentage: ((d.teams / constructionData.totalTeams) * 100).toFixed(1)
                              }))} 
                              dataKey="count" 
                              labelKey="name" 
                              color={POSITION_COLORS.TE} 
                              height={250} 
                            />
                          </div>
                          <div style={{ marginTop: '12px', display: 'flex', flexDirection: 'column', gap: '4px' }}>
                            {constructionData.positionDistributions.TE.map((d, idx) => (
                              <div key={idx} style={{ display: 'flex', justifyContent: 'space-between', fontSize: '12px', color: TEXT_SECONDARY }}>
                                <span>{d.label}</span>
                                <span style={{ fontWeight: '600' }}>{d.teams} teams ({((d.teams / constructionData.totalTeams) * 100).toFixed(1)}%)</span>
                              </div>
                            ))}
                          </div>
                        </div>
                      </div>
                    </div>

                    {/* Picks by Round */}
                    <div style={{ background: BG_SECONDARY, borderRadius: '8px', padding: '24px', border: `1px solid ${BORDER_COLOR}`, marginTop: '20px' }}>
                      <h3 style={{ fontSize: '16px', fontWeight: '700', marginBottom: '16px' }}>Picks by Round</h3>
                      <p style={{ color: TEXT_SECONDARY, fontSize: '13px', marginBottom: '16px' }}>Position distribution across all rounds</p>
                      
                      <div>
                        {constructionData.picksByRound.map((round, idx) => (
                          <div key={idx} style={{ marginBottom: '8px' }}>
                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '4px' }}>
                              <span style={{ fontSize: '12px', fontWeight: '700', color: TEXT_PRIMARY }}>Round {round.round}</span>
                              <div style={{ display: 'flex', gap: '12px', fontSize: '11px', fontWeight: '600' }}>
                                <span style={{ color: POSITION_COLORS.QB }}>QB: {round.QB}%</span>
                                <span style={{ color: POSITION_COLORS.RB }}>RB: {round.RB}%</span>
                                <span style={{ color: POSITION_COLORS.WR }}>WR: {round.WR}%</span>
                                <span style={{ color: POSITION_COLORS.TE }}>TE: {round.TE}%</span>
                              </div>
                            </div>
                            <div style={{ display: 'flex', width: '100%', height: '20px', borderRadius: '4px', overflow: 'hidden', border: `1px solid ${BORDER_COLOR}` }}>
                              {parseFloat(round.QB) > 0 && (
                                <div 
                                  style={{ 
                                    width: `${round.QB}%`, 
                                    background: POSITION_COLORS.QB
                                  }}
                                  title={`QB: ${round.QB}% (${round.counts.QB} picks)`}
                                />
                              )}
                              {parseFloat(round.RB) > 0 && (
                                <div 
                                  style={{ 
                                    width: `${round.RB}%`, 
                                    background: POSITION_COLORS.RB
                                  }}
                                  title={`RB: ${round.RB}% (${round.counts.RB} picks)`}
                                />
                              )}
                              {parseFloat(round.WR) > 0 && (
                                <div 
                                  style={{ 
                                    width: `${round.WR}%`, 
                                    background: POSITION_COLORS.WR
                                  }}
                                  title={`WR: ${round.WR}% (${round.counts.WR} picks)`}
                                />
                              )}
                              {parseFloat(round.TE) > 0 && (
                                <div 
                                  style={{ 
                                    width: `${round.TE}%`, 
                                    background: POSITION_COLORS.TE
                                  }}
                                  title={`TE: ${round.TE}% (${round.counts.TE} picks)`}
                                />
                              )}
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  </div>
                )}
              </>
            )}

            {/* Player Detail Modal */}
            {selectedPlayerDetail && (
              <div
                style={{
                  position: 'fixed',
                  top: 0,
                  left: 0,
                  right: 0,
                  bottom: 0,
                  background: 'rgba(0, 0, 0, 0.6)',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  zIndex: 1000,
                  padding: '20px',
                  backdropFilter: 'blur(4px)'
                }}
                onClick={() => setSelectedPlayerDetail(null)}
              >
                <div
                  style={{
                    background: BG_SECONDARY,
                    borderRadius: '12px',
                    maxWidth: '600px',
                    width: '100%',
                    maxHeight: '90vh',
                    overflowY: 'auto',
                    boxShadow: '0 20px 60px rgba(0, 0, 0, 0.3)',
                    border: `2px solid ${ACCENT}`
                  }}
                  onClick={(e) => e.stopPropagation()}
                >
                  <div style={{
                    padding: '28px',
                    borderBottom: `2px solid ${BORDER_COLOR}`,
                    background: BG_TERTIARY
                  }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start', marginBottom: '16px' }}>
                      <div>
                        <h2 style={{ fontSize: '28px', fontWeight: '700', color: TEXT_PRIMARY, marginBottom: '8px' }}>
                          {selectedPlayerDetail.name}
                        </h2>
                        <div style={{ display: 'flex', gap: '12px', alignItems: 'center' }}>
                          <span style={{
                            background: POSITION_COLORS[selectedPlayerDetail.position] || '#6b7280',
                            color: '#fff',
                            padding: '6px 14px',
                            borderRadius: '6px',
                            fontSize: '14px',
                            fontWeight: '700'
                          }}>
                            {selectedPlayerDetail.position}
                          </span>
                          <span style={{ color: TEXT_SECONDARY, fontSize: '18px', fontWeight: '600' }}>
                            {selectedPlayerDetail.team}
                          </span>
                        </div>
                      </div>
                      <button
                        onClick={() => setSelectedPlayerDetail(null)}
                        style={{
                          background: 'none',
                          border: 'none',
                          fontSize: '32px',
                          color: TEXT_SECONDARY,
                          cursor: 'pointer',
                          padding: '0',
                          lineHeight: '1',
                          fontWeight: '300'
                        }}
                      >
                        Ã—
                      </button>
                    </div>
                  </div>

                  <div style={{ padding: '28px' }}>
                    <div style={{
                      display: 'grid',
                      gridTemplateColumns: entryFeeFilter === 'ALL' && selectedPlayerDetail.totalEntryFee > 0 
                        ? 'repeat(auto-fit, minmax(130px, 1fr))' 
                        : 'repeat(auto-fit, minmax(140px, 1fr))',
                      gap: '16px',
                      marginBottom: '28px'
                    }}>
                      <div style={{
                        background: BG_TERTIARY,
                        padding: '18px',
                        borderRadius: '8px',
                        border: `1px solid ${BORDER_COLOR}`
                      }}>
                        <div style={{
                          color: TEXT_SECONDARY,
                          fontSize: '11px',
                          fontWeight: '700',
                          textTransform: 'uppercase',
                          letterSpacing: '0.5px',
                          marginBottom: '8px'
                        }}>
                          Exposure
                        </div>
                        <div style={{ fontSize: '28px', fontWeight: '700', color: ACCENT }}>
                          {selectedPlayerDetail.exposure}%
                        </div>
                      </div>

                      <div style={{
                        background: BG_TERTIARY,
                        padding: '18px',
                        borderRadius: '8px',
                        border: `1px solid ${BORDER_COLOR}`
                      }}>
                        <div style={{
                          color: TEXT_SECONDARY,
                          fontSize: '11px',
                          fontWeight: '700',
                          textTransform: 'uppercase',
                          letterSpacing: '0.5px',
                          marginBottom: '8px'
                        }}>
                          Times Drafted
                        </div>
                        <div style={{ fontSize: '28px', fontWeight: '700', color: TEXT_PRIMARY }}>
                          {selectedPlayerDetail.count}
                        </div>
                      </div>

                      <div style={{
                        background: BG_TERTIARY,
                        padding: '18px',
                        borderRadius: '8px',
                        border: `1px solid ${BORDER_COLOR}`
                      }}>
                        <div style={{
                          color: TEXT_SECONDARY,
                          fontSize: '11px',
                          fontWeight: '700',
                          textTransform: 'uppercase',
                          letterSpacing: '0.5px',
                          marginBottom: '8px'
                        }}>
                          Avg Pick
                        </div>
                        <div style={{ fontSize: '28px', fontWeight: '700', color: TEXT_PRIMARY }}>
                          {selectedPlayerDetail.avgPick}
                        </div>
                      </div>

                      {entryFeeFilter === 'ALL' && selectedPlayerDetail.totalEntryFee > 0 && (
                        <div style={{
                          background: BG_TERTIARY,
                          padding: '18px',
                          borderRadius: '8px',
                          border: `2px solid ${ACCENT}`
                        }}>
                          <div style={{
                            color: TEXT_SECONDARY,
                            fontSize: '11px',
                            fontWeight: '700',
                            textTransform: 'uppercase',
                            letterSpacing: '0.5px',
                            marginBottom: '8px'
                          }}>
                            Total Entry Fees
                          </div>
                          <div style={{ fontSize: '28px', fontWeight: '700', color: ACCENT }}>
                            ${selectedPlayerDetail.totalEntryFee.toFixed(0)}
                          </div>
                        </div>
                      )}
                    </div>

                    <div style={{ height: '2px', background: BORDER_COLOR, marginBottom: '28px' }} />

                    <h3 style={{
                      fontSize: '14px',
                      fontWeight: '700',
                      color: TEXT_PRIMARY,
                      marginBottom: '16px',
                      textTransform: 'uppercase',
                      letterSpacing: '0.5px'
                    }}>
                      Draft Details
                    </h3>

                    <div style={{ display: 'flex', flexDirection: 'column', gap: '14px' }}>
                      <div style={{
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'center',
                        padding: '12px 16px',
                        background: BG_TERTIARY,
                        borderRadius: '6px',
                        border: `1px solid ${BORDER_COLOR}`
                      }}>
                        <span style={{ color: TEXT_SECONDARY, fontWeight: '600', fontSize: '14px' }}>
                          Earliest Pick
                        </span>
                        <span style={{ color: TEXT_PRIMARY, fontWeight: '700', fontSize: '16px' }}>
                          #{selectedPlayerDetail.earliestPick}
                        </span>
                      </div>

                      <div style={{
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'center',
                        padding: '12px 16px',
                        background: BG_TERTIARY,
                        borderRadius: '6px',
                        border: `1px solid ${BORDER_COLOR}`
                      }}>
                        <span style={{ color: TEXT_SECONDARY, fontWeight: '600', fontSize: '14px' }}>
                          Latest Pick
                        </span>
                        <span style={{ color: TEXT_PRIMARY, fontWeight: '700', fontSize: '16px' }}>
                          #{selectedPlayerDetail.latestPick}
                        </span>
                      </div>

                      <div style={{
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'center',
                        padding: '12px 16px',
                        background: BG_TERTIARY,
                        borderRadius: '6px',
                        border: `1px solid ${BORDER_COLOR}`
                      }}>
                        <span style={{ color: TEXT_SECONDARY, fontWeight: '600', fontSize: '14px' }}>
                          Pick Range
                        </span>
                        <span style={{ color: TEXT_PRIMARY, fontWeight: '700', fontSize: '16px' }}>
                          {selectedPlayerDetail.pickRange} picks
                        </span>
                      </div>

                      {selectedPlayerDetail.adp && (
                        <div style={{
                          display: 'flex',
                          justifyContent: 'space-between',
                          alignItems: 'center',
                          padding: '12px 16px',
                          background: BG_TERTIARY,
                          borderRadius: '6px',
                          border: `1px solid ${BORDER_COLOR}`
                        }}>
                          <span style={{ color: TEXT_SECONDARY, fontWeight: '600', fontSize: '14px' }}>
                            Player ADP
                          </span>
                          <span style={{ color: TEXT_PRIMARY, fontWeight: '700', fontSize: '16px' }}>
                            {selectedPlayerDetail.adp}
                          </span>
                        </div>
                      )}
                    </div>

                    <div style={{ marginTop: '28px' }}>
                      <h3 style={{
                        fontSize: '14px',
                        fontWeight: '700',
                        color: TEXT_PRIMARY,
                        marginBottom: '12px',
                        textTransform: 'uppercase',
                        letterSpacing: '0.5px'
                      }}>
                        Pick Distribution
                      </h3>
                      <div style={{
                        display: 'flex',
                        flexWrap: 'wrap',
                        gap: '6px'
                      }}>
                        {selectedPlayerDetail.picks.sort((a, b) => a - b).map((pick, idx) => (
                          <span
                            key={idx}
                            style={{
                              background: POSITION_COLORS[selectedPlayerDetail.position],
                              color: '#fff',
                              padding: '6px 12px',
                              borderRadius: '6px',
                              fontSize: '13px',
                              fontWeight: '700'
                            }}
                          >
                            #{pick}
                          </span>
                        ))}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            )}
            
            {/* FADES TAB */}
            {activeTab === 'fades' && (() => {
              // Check if we have ranks data
              if (!ranksData || ranksData.length === 0) {
                return (
                  <div style={{
                    background: BG_SECONDARY,
                    border: `2px solid ${BORDER_COLOR}`,
                    borderRadius: '12px',
                    padding: '48px',
                    textAlign: 'center'
                  }}>
                    <div style={{ fontSize: '48px', marginBottom: '16px', fontWeight: '700' }}>âš </div>
                    <div style={{ fontSize: '18px', fontWeight: '700', color: TEXT_PRIMARY, marginBottom: '8px' }}>
                      No Rankings Data
                    </div>
                    <div style={{ fontSize: '14px', color: TEXT_SECONDARY, marginBottom: '16px' }}>
                      Click "Sync from ADP" to load your player rankings for fades analysis
                    </div>
                    <button
                      onClick={syncFromADP}
                      style={{
                        padding: '12px 24px',
                        background: ACCENT,
                        border: 'none',
                        borderRadius: '6px',
                        color: '#fff',
                        fontWeight: '600',
                        cursor: 'pointer'
                      }}
                    >
                      Sync from ADP
                    </button>
                  </div>
                );
              }
              
              // Get top 200 players from ranksData (these are YOUR top 200)
              const top200FromRanks = ranksData.slice(0, 200);
              
              // Match with exposure data to get exposure %
              const top200WithExposure = top200FromRanks.map(rankedPlayer => {
                const exposurePlayer = exposureData.find(p => 
                  p.name === rankedPlayer.name && p.position === rankedPlayer.position
                );
                return {
                  ...rankedPlayer,
                  exposure: exposurePlayer ? exposurePlayer.exposure : 0,
                  count: exposurePlayer ? exposurePlayer.count : 0,
                  avgPick: exposurePlayer ? exposurePlayer.avgPick : null
                };
              });
              
              // Total Fades: Top 200 players under 4% exposure
              const fadedPlayers = top200WithExposure.filter(p => p.exposure < 4);
              
              // High-ranked fades: Top 50 players under 4% exposure
              const top50WithExposure = top200WithExposure.slice(0, 50);
              const highRankedFades = top50WithExposure.filter(p => p.exposure < 4);
              
              // Position-specific fades (top 20 at each position under 4%)
              const positionFades = ['QB', 'RB', 'WR', 'TE'].map(pos => {
                // Get players of this position from ranksData in rank order
                const posPlayersFromRanks = ranksData.filter(p => p.position === pos);
                
                // Take top 20 at this position
                const top20AtPosition = posPlayersFromRanks.slice(0, 20);
                
                // Match with exposure data
                const top20WithExposure = top20AtPosition.map(rankedPlayer => {
                  const exposurePlayer = exposureData.find(p => 
                    p.name === rankedPlayer.name && p.position === rankedPlayer.position
                  );
                  return {
                    ...rankedPlayer,
                    exposure: exposurePlayer ? exposurePlayer.exposure : 0,
                    count: exposurePlayer ? exposurePlayer.count : 0,
                    avgPick: exposurePlayer ? exposurePlayer.avgPick : null
                  };
                });
                
                // Filter for under 4% exposure and sort by exposure (lowest first)
                const fades = top20WithExposure
                  .filter(p => p.exposure < 4)
                  .sort((a, b) => a.exposure - b.exposure);
                
                return { position: pos, fades: fades };
              }).filter(p => p.fades.length > 0);
              
              // ADP value fades (players being drafted way later than ADP)
              const valueFades = fadedPlayers
                .filter(p => p.adp && p.adp !== '-')
                .map(p => ({
                  ...p,
                  diff: p.avgPick - parseFloat(p.adp)
                }))
                .filter(p => p.diff > 10)
                .sort((a, b) => b.diff - a.diff)
                .slice(0, 10);
              
              return (
                <div>
                  {/* Summary Stats */}
                  <div style={{
                    display: 'grid',
                    gridTemplateColumns: 'repeat(auto-fit, minmax(240px, 1fr))',
                    gap: '16px',
                    marginBottom: '32px'
                  }}>
                    <div style={{
                      background: BG_SECONDARY,
                      border: `2px solid ${BORDER_COLOR}`,
                      borderRadius: '12px',
                      padding: '20px'
                    }}>
                      <div style={{ fontSize: '13px', color: TEXT_SECONDARY, marginBottom: '8px', fontWeight: '600', textTransform: 'uppercase', letterSpacing: '0.5px' }}>
                        Total Fades
                      </div>
                      <div style={{ fontSize: '32px', fontWeight: '700', color: '#ef4444' }}>
                        {fadedPlayers.length}
                      </div>
                      <div style={{ fontSize: '12px', color: TEXT_SECONDARY, marginTop: '4px' }}>
                        Top 200 players under 4%
                      </div>
                    </div>
                    
                    <div style={{
                      background: BG_SECONDARY,
                      border: `2px solid ${BORDER_COLOR}`,
                      borderRadius: '12px',
                      padding: '20px'
                    }}>
                      <div style={{ fontSize: '13px', color: TEXT_SECONDARY, marginBottom: '8px', fontWeight: '600', textTransform: 'uppercase', letterSpacing: '0.5px' }}>
                        High-Rank Fades
                      </div>
                      <div style={{ fontSize: '32px', fontWeight: '700', color: '#f59e0b' }}>
                        {highRankedFades.length}
                      </div>
                      <div style={{ fontSize: '12px', color: TEXT_SECONDARY, marginTop: '4px' }}>
                        Top 50 players under 4%
                      </div>
                    </div>
                  </div>

                  {/* High-Ranked Fades Display */}
                  {highRankedFades.length > 0 && (
                    <div style={{
                      background: BG_SECONDARY,
                      border: `2px solid ${BORDER_COLOR}`,
                      borderRadius: '12px',
                      padding: '24px',
                      marginBottom: '24px'
                    }}>
                      <h3 style={{
                        fontSize: '18px',
                        fontWeight: '700',
                        color: TEXT_PRIMARY,
                        marginBottom: '16px'
                      }}>
                        High-Ranked Players You're Fading (Ranked 1-50, under 4%)
                      </h3>
                      <div style={{
                        display: 'grid',
                        gridTemplateColumns: 'repeat(auto-fill, minmax(280px, 1fr))',
                        gap: '12px'
                      }}>
                        {highRankedFades.map((player, idx) => (
                          <div
                            key={idx}
                            style={{
                              background: BG_PRIMARY,
                              border: `2px solid ${BORDER_COLOR}`,
                              borderRadius: '8px',
                              padding: '16px'
                            }}
                          >
                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start', marginBottom: '8px' }}>
                              <div>
                                <div style={{ fontSize: '16px', fontWeight: '700', color: TEXT_PRIMARY }}>
                                  {player.name}
                                </div>
                                <div style={{ display: 'flex', gap: '6px', alignItems: 'center', marginTop: '4px' }}>
                                  <span style={{
                                    background: POSITION_COLORS[player.position],
                                    color: '#fff',
                                    padding: '3px 8px',
                                    borderRadius: '4px',
                                    fontSize: '11px',
                                    fontWeight: '700'
                                  }}>
                                    {player.position}
                                  </span>
                                  <span style={{ fontSize: '13px', color: TEXT_SECONDARY, fontWeight: '600' }}>
                                    {player.team}
                                  </span>
                                </div>
                              </div>
                              <div style={{ textAlign: 'right' }}>
                                <div style={{ fontSize: '24px', fontWeight: '700', color: '#ef4444' }}>
                                  {player.exposure}%
                                </div>
                                <div style={{ fontSize: '11px', color: TEXT_SECONDARY }}>
                                  Rank {player.rank}
                                </div>
                              </div>
                            </div>
                            {player.adp && player.adp !== '-' && (
                              <div style={{
                                marginTop: '8px',
                                paddingTop: '8px',
                                borderTop: `1px solid ${BORDER_COLOR}`,
                                fontSize: '12px',
                                color: TEXT_SECONDARY
                              }}>
                                ADP: {player.adp} â€¢ Avg Pick: {player.avgPick || 'N/A'}
                              </div>
                            )}
                          </div>
                        ))}
                      </div>
                    </div>
                  )}

                  {/* Position-Specific Fades */}
                  {positionFades.length > 0 && (
                    <div style={{
                      background: BG_SECONDARY,
                      border: `2px solid ${BORDER_COLOR}`,
                      borderRadius: '12px',
                      padding: '24px',
                      marginBottom: '24px'
                    }}>
                      <h3 style={{
                        fontSize: '18px',
                        fontWeight: '700',
                        color: TEXT_PRIMARY,
                        marginBottom: '16px'
                      }}>
                        Top-Tier Position Fades (Top 20 at position, under 4%)
                      </h3>
                      <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>
                        {positionFades.map(({ position, fades }) => (
                          <div key={position}>
                            <h4 style={{
                              fontSize: '14px',
                              fontWeight: '700',
                              color: POSITION_COLORS[position],
                              marginBottom: '8px',
                              textTransform: 'uppercase',
                              letterSpacing: '0.5px'
                            }}>
                              {position} Fades ({fades.length})
                            </h4>
                            <div style={{
                              display: 'grid',
                              gridTemplateColumns: 'repeat(auto-fill, minmax(200px, 1fr))',
                              gap: '8px'
                            }}>
                              {fades.map((player, idx) => (
                                <div
                                  key={idx}
                                  style={{
                                    background: BG_PRIMARY,
                                    border: `2px solid ${POSITION_COLORS[position]}40`,
                                    borderRadius: '6px',
                                    padding: '12px',
                                    display: 'flex',
                                    justifyContent: 'space-between',
                                    alignItems: 'center'
                                  }}
                                >
                                  <div>
                                    <div style={{ fontSize: '14px', fontWeight: '700', color: TEXT_PRIMARY }}>
                                      {player.name}
                                    </div>
                                    <div style={{ fontSize: '11px', color: TEXT_SECONDARY }}>
                                      {player.team} â€¢ Rank {player.rank}
                                    </div>
                                  </div>
                                  <div style={{ fontSize: '18px', fontWeight: '700', color: '#ef4444' }}>
                                    {player.exposure}%
                                  </div>
                                </div>
                              ))}
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}

                  {/* Value Fades */}

                  {fadedPlayers.length === 0 && (
                    <div style={{
                      background: BG_SECONDARY,
                      border: `2px solid ${BORDER_COLOR}`,
                      borderRadius: '12px',
                      padding: '48px',
                      textAlign: 'center'
                    }}>
                      <div style={{ fontSize: '48px', marginBottom: '16px', fontWeight: '700' }}>âœ“</div>
                      <div style={{ fontSize: '18px', fontWeight: '700', color: TEXT_PRIMARY, marginBottom: '8px' }}>
                        No Significant Fades
                      </div>
                      <div style={{ fontSize: '14px', color: TEXT_SECONDARY }}>
                        All players have at least 8% exposure
                      </div>
                    </div>
                  )}
                </div>
              );
            })()}

            {/* ============================================================ */}
            {/* TEAMS TAB                                                     */}
            {/* ============================================================ */}
            {activeTab === 'teams' && (() => {
              // If no ranks data, show sync prompt (same as fades)
              if (!ranksData || ranksData.length === 0) {
                return (
                  <div style={{
                    background: BG_SECONDARY,
                    border: `2px solid ${BORDER_COLOR}`,
                    borderRadius: '12px',
                    padding: '48px',
                    textAlign: 'center'
                  }}>
                    <div style={{ fontSize: '48px', marginBottom: '16px', fontWeight: '700' }}>âš </div>
                    <div style={{ fontSize: '18px', fontWeight: '700', color: TEXT_PRIMARY, marginBottom: '8px' }}>
                      No Rankings Data
                    </div>
                    <div style={{ fontSize: '14px', color: TEXT_SECONDARY, marginBottom: '16px' }}>
                      Click "Sync from ADP" to load ADP data for team value scoring
                    </div>
                    <button
                      onClick={syncFromADP}
                      style={{
                        padding: '12px 24px',
                        background: ACCENT,
                        border: 'none',
                        borderRadius: '6px',
                        color: '#fff',
                        fontWeight: '600',
                        cursor: 'pointer'
                      }}
                    >
                      Sync from ADP
                    </button>
                  </div>
                );
              }

              // Build team value data from filteredDrafts
              const teamsData = filteredDrafts.map((draft, draftIdx) => {
                const team = draft.myTeam || [];

                // Derive a date label from the draft name or index
                const draftLabel = draft.name || `Draft ${draftIdx + 1}`;

                // Format draftDate from "2026-01-26 04:01:29 UTC" â†’ "1/26/26"
                let formattedDate = null;
                if (draft.draftDate) {
                  try {
                    const d = new Date(draft.draftDate.replace(' UTC', '+00:00'));
                    formattedDate = `${d.getMonth() + 1}/${d.getDate()}/${String(d.getFullYear()).slice(-2)}`;
                  } catch (e) {}
                }

                let totalDiff = 0;
                let matchedCount = 0;

                const players = team.map((player, idx) => {
                  const overallPick = player.pick || (idx + 1);

                  // Look up ADP from ranksData
                  let adp = player.adp || null;
                  if (!adp) {
                    const ranked = ranksData.find(r =>
                      r.name && player.name &&
                      r.name.toLowerCase() === player.name.toLowerCase() &&
                      r.position === player.position
                    );
                    if (ranked && ranked.adp) {
                      adp = ranked.adp;
                    }
                  }

                  let diff = null;
                  if (adp !== null && adp !== undefined) {
                    diff = overallPick - parseFloat(adp);
                    totalDiff += diff;
                    matchedCount++;
                  }

                  return {
                    name: player.name,
                    position: player.position,
                    team: player.team,
                    pick: overallPick,
                    adp: adp,
                    diff: diff
                  };
                });

                // Sort players by pick number
                players.sort((a, b) => a.pick - b.pick);

                return {
                  label: draftLabel,
                  entryFee: draft.entryFee,
                  draftDate: formattedDate,
                  totalDiff: totalDiff,
                  matchedCount: matchedCount,
                  totalPlayers: team.length,
                  players: players
                };
              });

              // Sort by totalDiff
              teamsData.sort((a, b) => {
                return teamsSortDir === 'asc' ? b.totalDiff - a.totalDiff : a.totalDiff - b.totalDiff;
              });

              const teamsTotalPages = Math.ceil(teamsData.length / TEAMS_PAGE_SIZE);
              const teamsPageData = teamsData.slice((teamsPage - 1) * TEAMS_PAGE_SIZE, teamsPage * TEAMS_PAGE_SIZE);

              return (
                <div>
                  {/* Header row */}
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px' }}>
                    <div>
                      <h3 style={{ fontSize: '16px', fontWeight: '700', color: TEXT_PRIMARY, marginBottom: '4px' }}>Teams by ADP Value</h3>
                      <p style={{ fontSize: '13px', color: TEXT_SECONDARY }}>
                        Positive = value picks. Negative = reached. Click a team to expand.
                      </p>
                    </div>
                    <button
                      onClick={() => { setTeamsSortDir(teamsSortDir === 'asc' ? 'desc' : 'asc'); setTeamsPage(1); setExpandedDraft(null); }}
                      style={{
                        padding: '8px 16px',
                        background: BG_TERTIARY,
                        border: `1px solid ${BORDER_COLOR}`,
                        borderRadius: '6px',
                        color: TEXT_PRIMARY,
                        fontWeight: '600',
                        fontSize: '13px',
                        cursor: 'pointer'
                      }}
                    >
                      {teamsSortDir === 'asc' ? 'â†‘ Best Value First' : 'â†“ Worst Value First'}
                    </button>
                  </div>

                  {/* Teams list */}
                  <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                    {teamsPageData.map((teamEntry, pageIdx) => {
                      const idx = (teamsPage - 1) * TEAMS_PAGE_SIZE + pageIdx;
                      const isExpanded = expandedDraft === idx;
                      const diffColor = teamEntry.totalDiff > 0 ? '#22c55e' : teamEntry.totalDiff < 0 ? '#ef4444' : TEXT_SECONDARY;
                      const diffBg = teamEntry.totalDiff > 0 ? 'rgba(34,197,94,0.1)' : teamEntry.totalDiff < 0 ? 'rgba(239,68,68,0.1)' : 'transparent';
                      const coveragePct = teamEntry.totalPlayers > 0 ? Math.round((teamEntry.matchedCount / teamEntry.totalPlayers) * 100) : 0;

                      return (
                        <div key={idx} style={{
                          background: BG_SECONDARY,
                          border: `1px solid ${isExpanded ? ACCENT : BORDER_COLOR}`,
                          borderRadius: '10px',
                          overflow: 'hidden',
                          transition: 'border-color 0.2s'
                        }}>
                          {/* Collapsed row - clickable header */}
                          <div
                            onClick={() => setExpandedDraft(isExpanded ? null : idx)}
                            style={{
                              display: 'flex',
                              alignItems: 'center',
                              padding: '14px 18px',
                              cursor: 'pointer',
                              gap: '12px'
                            }}
                          >
                            {/* Expand chevron */}
                            <span style={{ fontSize: '14px', color: TEXT_SECONDARY, width: '16px', textAlign: 'center', transition: 'transform 0.2s', transform: isExpanded ? 'rotate(90deg)' : 'rotate(0deg)', display: 'inline-block' }}>â–¶</span>

                            {/* Draft label */}
                            <div style={{ flex: 1 }}>
                              <span style={{ fontSize: '15px', fontWeight: '700', color: TEXT_PRIMARY }}>{teamEntry.label}</span>
                              {teamEntry.entryFee && (
                                <span style={{ fontSize: '12px', color: TEXT_SECONDARY, marginLeft: '10px' }}>${typeof teamEntry.entryFee === 'number' ? teamEntry.entryFee.toFixed(2) : teamEntry.entryFee} entry</span>
                              )}
                              {teamEntry.draftDate && (
                                <span style={{ fontSize: '12px', color: TEXT_SECONDARY, marginLeft: '10px' }}>Drafted {teamEntry.draftDate}</span>
                              )}
                            </div>

                            {/* Coverage badge */}
                            <div style={{ fontSize: '11px', color: TEXT_SECONDARY, textAlign: 'right', minWidth: '55px' }}>
                              {teamEntry.matchedCount}/{teamEntry.totalPlayers} ADP
                            </div>

                            {/* Total Diff badge */}
                            <div style={{
                              background: diffBg,
                              border: `1px solid ${diffColor}`,
                              borderRadius: '6px',
                              padding: '5px 14px',
                              minWidth: '72px',
                              textAlign: 'center'
                            }}>
                              <span style={{ fontSize: '16px', fontWeight: '700', color: diffColor }}>
                                {teamEntry.totalDiff > 0 ? '+' : ''}{teamEntry.totalDiff.toFixed(1)}
                              </span>
                            </div>
                          </div>

                          {/* Expanded player list */}
                          {isExpanded && (
                            <div style={{ borderTop: `1px solid ${BORDER_COLOR}` }}>
                              {/* Column headers */}
                              <div style={{
                                display: 'grid',
                                gridTemplateColumns: '2fr 70px 70px 70px 70px',
                                padding: '8px 18px',
                                background: BG_TERTIARY,
                                fontSize: '11px',
                                fontWeight: '700',
                                textTransform: 'uppercase',
                                color: TEXT_SECONDARY
                              }}>
                                <span>Player</span>
                                <span style={{ textAlign: 'right' }}>Pick</span>
                                <span style={{ textAlign: 'right' }}>ADP</span>
                                <span style={{ textAlign: 'right' }}>Diff</span>
                                <span style={{ textAlign: 'right' }}>Value</span>
                              </div>

                              {/* Player rows */}
                              {teamEntry.players.map((player, pIdx) => {
                                const pDiffColor = player.diff !== null ? (player.diff > 0 ? '#22c55e' : player.diff < 0 ? '#ef4444' : TEXT_SECONDARY) : TEXT_SECONDARY;
                                const isNoAdp = player.adp === null || player.adp === undefined;

                                return (
                                  <div key={pIdx} style={{
                                    display: 'grid',
                                    gridTemplateColumns: '2fr 70px 70px 70px 70px',
                                    padding: '9px 18px',
                                    borderBottom: `1px solid ${BORDER_COLOR}`,
                                    alignItems: 'center',
                                    background: isNoAdp ? (isDarkTheme ? 'rgba(100,100,100,0.08)' : 'rgba(200,200,200,0.15)') : 'transparent'
                                  }}>
                                    {/* Name + position badge */}
                                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                      <span style={{
                                        background: POSITION_COLORS[player.position] || '#6b7280',
                                        color: '#fff',
                                        fontSize: '10px',
                                        fontWeight: '700',
                                        padding: '2px 6px',
                                        borderRadius: '4px',
                                        minWidth: '28px',
                                        textAlign: 'center'
                                      }}>{player.position}</span>
                                      <span style={{ fontSize: '14px', fontWeight: '600', color: TEXT_PRIMARY }}>{player.name}</span>
                                      {player.team && <span style={{ fontSize: '11px', color: TEXT_SECONDARY }}>{player.team}</span>}
                                    </div>

                                    {/* Pick */}
                                    <span style={{ textAlign: 'right', fontSize: '14px', fontWeight: '600', color: TEXT_PRIMARY }}>{player.pick}</span>

                                    {/* ADP */}
                                    <span style={{ textAlign: 'right', fontSize: '14px', color: isNoAdp ? TEXT_SECONDARY : TEXT_PRIMARY, fontStyle: isNoAdp ? 'italic' : 'normal' }}>
                                      {isNoAdp ? 'â€”' : parseFloat(player.adp).toFixed(1)}
                                    </span>

                                    {/* Diff number */}
                                    <span style={{ textAlign: 'right', fontSize: '14px', fontWeight: '600', color: pDiffColor }}>
                                      {player.diff !== null ? (player.diff > 0 ? '+' : '') + player.diff.toFixed(1) : 'â€”'}
                                    </span>

                                    {/* Value label */}
                                    <span style={{ textAlign: 'right', fontSize: '11px', fontWeight: '700', color: pDiffColor }}>
                                      {player.diff === null ? 'â€”' : player.diff > 2 ? 'VALUE' : player.diff < -2 ? 'REACH' : 'â€”'}
                                    </span>
                                  </div>
                                );
                              })}

                              {/* Footer totals */}
                              <div style={{
                                display: 'grid',
                                gridTemplateColumns: '2fr 70px 70px 70px 70px',
                                padding: '10px 18px',
                                background: BG_TERTIARY,
                                borderTop: `2px solid ${BORDER_COLOR}`
                              }}>
                                <span style={{ fontSize: '13px', fontWeight: '700', color: TEXT_PRIMARY }}>
                                  Total ({teamEntry.matchedCount} matched)
                                </span>
                                <span></span>
                                <span></span>
                                <span style={{ textAlign: 'right', fontSize: '15px', fontWeight: '700', color: diffColor }}>
                                  {teamEntry.totalDiff > 0 ? '+' : ''}{teamEntry.totalDiff.toFixed(1)}
                                </span>
                                <span></span>
                              </div>
                            </div>
                          )}
                        </div>
                      );
                    })}
                  </div>

                  {/* Pagination */}
                  {teamsTotalPages > 1 && (
                    <div style={{ display: 'flex', justifyContent: 'center', alignItems: 'center', gap: '6px', marginTop: '20px' }}>
                      {/* Prev */}
                      <button
                        onClick={() => { setTeamsPage(p => Math.max(1, p - 1)); setExpandedDraft(null); }}
                        disabled={teamsPage === 1}
                        style={{
                          padding: '6px 12px',
                          background: teamsPage === 1 ? BG_TERTIARY : BG_SECONDARY,
                          border: `1px solid ${BORDER_COLOR}`,
                          borderRadius: '6px',
                          color: teamsPage === 1 ? TEXT_SECONDARY : TEXT_PRIMARY,
                          fontWeight: '600',
                          fontSize: '13px',
                          cursor: teamsPage === 1 ? 'default' : 'pointer',
                          opacity: teamsPage === 1 ? 0.5 : 1
                        }}
                      >â† Prev</button>

                      {/* Page numbers */}
                      {Array.from({ length: teamsTotalPages }, (_, i) => i + 1).map(page => (
                        <button
                          key={page}
                          onClick={() => { setTeamsPage(page); setExpandedDraft(null); }}
                          style={{
                            padding: '6px 11px',
                            background: teamsPage === page ? ACCENT : BG_SECONDARY,
                            border: `1px solid ${teamsPage === page ? ACCENT : BORDER_COLOR}`,
                            borderRadius: '6px',
                            color: teamsPage === page ? '#fff' : TEXT_PRIMARY,
                            fontWeight: '600',
                            fontSize: '13px',
                            cursor: 'pointer',
                            minWidth: '32px'
                          }}
                        >{page}</button>
                      ))}

                      {/* Next */}
                      <button
                        onClick={() => { setTeamsPage(p => Math.min(teamsTotalPages, p + 1)); setExpandedDraft(null); }}
                        disabled={teamsPage === teamsTotalPages}
                        style={{
                          padding: '6px 12px',
                          background: teamsPage === teamsTotalPages ? BG_TERTIARY : BG_SECONDARY,
                          border: `1px solid ${BORDER_COLOR}`,
                          borderRadius: '6px',
                          color: teamsPage === teamsTotalPages ? TEXT_SECONDARY : TEXT_PRIMARY,
                          fontWeight: '600',
                          fontSize: '13px',
                          cursor: teamsPage === teamsTotalPages ? 'default' : 'pointer',
                          opacity: teamsPage === teamsTotalPages ? 0.5 : 1
                        }}
                      >Next â†’</button>
                    </div>
                  )}

                  {/* Results count */}
                  <div style={{ textAlign: 'center', fontSize: '12px', color: TEXT_SECONDARY, marginTop: '10px' }}>
                    Showing {((teamsPage - 1) * TEAMS_PAGE_SIZE) + 1}â€“{Math.min(teamsPage * TEAMS_PAGE_SIZE, teamsData.length)} of {teamsData.length} teams
                  </div>
                </div>
              );
            })()}

            {/* ABOUT TAB */}
            {activeTab === 'about' && (
              <div style={{
                background: BG_SECONDARY,
                borderRadius: '12px',
                padding: '48px',
                maxWidth: '800px',
                margin: '0 auto'
              }}>
                {/* Centered Logo + Title */}
                <div style={{ textAlign: 'center', marginBottom: '32px' }}>
                  {isDarkTheme ? (
                    <svg width="180" height="50" viewBox="0 0 280 80" fill="none" xmlns="http://www.w3.org/2000/svg" style={{ margin: '0 auto 16px' }}>
                      <rect x="15" y="32" width="4" height="16" rx="2" fill="url(#gradDarkAbout)" />
                      <defs>
                        <linearGradient id="gradDarkAbout" x1="17" y1="32" x2="17" y2="48" gradientUnits="userSpaceOnUse">
                          <stop offset="0%" stopColor="#93c5fd" />
                          <stop offset="100%" stopColor="#3b82f6" />
                        </linearGradient>
                      </defs>
                      <text x="28" y="38" fontFamily="Inter, -apple-system, BlinkMacSystemFont, sans-serif" fontSize="22" fontWeight="800" fill="#f9fafb" letterSpacing="-0.5">OPTIMAL</text>
                      <text x="28" y="56" fontFamily="Inter, -apple-system, BlinkMacSystemFont, sans-serif" fontSize="18" fontWeight="600" fill="#93c5fd" letterSpacing="0.5">FANTASY</text>
                    </svg>
                  ) : (
                    <svg width="180" height="50" viewBox="0 0 280 80" fill="none" xmlns="http://www.w3.org/2000/svg" style={{ margin: '0 auto 16px' }}>
                      <rect x="15" y="32" width="4" height="16" rx="2" fill="url(#gradLightAbout)" />
                      <defs>
                        <linearGradient id="gradLightAbout" x1="17" y1="32" x2="17" y2="48" gradientUnits="userSpaceOnUse">
                          <stop offset="0%" stopColor="#3b82f6" />
                          <stop offset="100%" stopColor="#2563eb" />
                        </linearGradient>
                      </defs>
                      <text x="28" y="38" fontFamily="Inter, -apple-system, BlinkMacSystemFont, sans-serif" fontSize="22" fontWeight="800" fill="#0f172a" letterSpacing="-0.5">OPTIMAL</text>
                      <text x="28" y="56" fontFamily="Inter, -apple-system, BlinkMacSystemFont, sans-serif" fontSize="18" fontWeight="600" fill="#3b82f6" letterSpacing="0.5">FANTASY</text>
                    </svg>
                  )}
                  
                  <h2 style={{ 
                    fontSize: '24px', 
                    fontWeight: '700', 
                    color: TEXT_PRIMARY, 
                    marginBottom: '8px'
                  }}>
                    Best Ball Portfolio Tracker
                  </h2>
                  <p style={{ 
                    fontSize: '14px', 
                    color: TEXT_SECONDARY,
                    fontWeight: '600',
                    letterSpacing: '0.5px'
                  }}>
                    Analyze your Underdog Fantasy drafts with precision
                  </p>
                </div>

                {/* Disclaimer Section */}
                <div style={{ marginBottom: '32px' }}>
                  <h3 style={{ 
                    fontSize: '16px', 
                    fontWeight: '700', 
                    color: TEXT_PRIMARY, 
                    marginBottom: '12px',
                    textTransform: 'uppercase',
                    letterSpacing: '0.5px'
                  }}>
                    Disclaimer
                  </h3>
                  <p style={{ 
                    fontSize: '14px', 
                    color: TEXT_SECONDARY, 
                    lineHeight: '1.6'
                  }}>
                    This tool is not affiliated with Underdog Fantasy. For entertainment purposes only.
                  </p>
                </div>

                {/* Privacy Section */}
                <div style={{ marginBottom: '32px' }}>
                  <h3 style={{ 
                    fontSize: '16px', 
                    fontWeight: '700', 
                    color: TEXT_PRIMARY, 
                    marginBottom: '12px',
                    textTransform: 'uppercase',
                    letterSpacing: '0.5px'
                  }}>
                    Your Privacy
                  </h3>
                  <p style={{ 
                    fontSize: '14px', 
                    color: TEXT_SECONDARY, 
                    lineHeight: '1.6'
                  }}>
                    All data is stored locally in your browser. We don't collect or store your information.
                  </p>
                </div>

                {/* Contact Section */}
                <div style={{ marginBottom: '32px' }}>
                  <h3 style={{ 
                    fontSize: '16px', 
                    fontWeight: '700', 
                    color: TEXT_PRIMARY, 
                    marginBottom: '12px',
                    textTransform: 'uppercase',
                    letterSpacing: '0.5px'
                  }}>
                    Contact
                  </h3>
                  <p style={{ 
                    fontSize: '14px', 
                    color: TEXT_SECONDARY, 
                    lineHeight: '1.6',
                    marginBottom: '8px'
                  }}>
                    Questions or feedback?
                  </p>
                  <p style={{ 
                    fontSize: '14px', 
                    color: TEXT_PRIMARY, 
                    fontWeight: '600'
                  }}>
                    Email: <a href="mailto:optimalfantasyhelp@gmail.com" style={{ color: ACCENT, textDecoration: 'none' }}>optimalfantasyhelp@gmail.com</a>
                  </p>
                </div>

                {/* Version Info */}
                <div style={{
                  paddingTop: '24px',
                  borderTop: `1px solid ${BORDER_COLOR}`,
                  textAlign: 'center'
                }}>
                  <p style={{ 
                    fontSize: '12px', 
                    color: TEXT_SECONDARY 
                  }}>
                    Version 1.0 â€¢ Last Updated: February 2026
                  </p>
                </div>
              </div>
            )}
          </div>

          {/* How to Use Modal */}
          {showHowToUse && (
            <div style={{
              position: 'fixed',
              top: 0,
              left: 0,
              right: 0,
              bottom: 0,
              background: 'rgba(0, 0, 0, 0.7)',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              zIndex: 1000,
              padding: '20px'
            }}
            onClick={() => setShowHowToUse(false)}
            >
              <div style={{
                background: BG_SECONDARY,
                borderRadius: '12px',
                padding: '32px',
                maxWidth: '700px',
                width: '100%',
                maxHeight: '90vh',
                overflow: 'auto',
                boxShadow: SHADOW_LG,
                border: `1px solid ${BORDER_COLOR}`
              }}
              onClick={(e) => e.stopPropagation()}
              >
                {/* Header */}
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '24px' }}>
                  <h2 style={{ fontSize: '24px', fontWeight: '700', color: TEXT_PRIMARY, margin: 0 }}>
                    How to Use This Tool
                  </h2>
                  <button
                    onClick={() => setShowHowToUse(false)}
                    style={{
                      background: 'none',
                      border: 'none',
                      fontSize: '28px',
                      cursor: 'pointer',
                      color: TEXT_SECONDARY,
                      padding: '0',
                      lineHeight: '1'
                    }}
                  >
                    Ã—
                  </button>
                </div>

                {/* Quick Start */}
                <div style={{ marginBottom: '32px' }}>
                  <h3 style={{ fontSize: '18px', fontWeight: '700', color: TEXT_PRIMARY, marginBottom: '16px' }}>
                    Quick Start
                  </h3>
                  <ol style={{ margin: 0, paddingLeft: '24px', color: TEXT_SECONDARY, lineHeight: '1.8' }}>
                    <li style={{ marginBottom: '12px' }}>
                      <strong style={{ color: TEXT_PRIMARY }}>Click "Clear All"</strong> (if you have old data)
                    </li>
                    <li style={{ marginBottom: '12px' }}>
                      <strong style={{ color: TEXT_PRIMARY }}>Import Underdog CSV</strong> draft data (see below for how)
                    </li>
                    <li style={{ marginBottom: '12px' }}>
                      <strong style={{ color: TEXT_PRIMARY }}>Click "Sync from ADP"</strong> to load updated ADP data
                    </li>
                    <li>
                      <strong style={{ color: TEXT_PRIMARY }}>Explore!</strong> Check your exposure, correlations, and team construction
                    </li>
                  </ol>
                </div>

                {/* How to Download CSV */}
                <div style={{ marginBottom: '32px', background: BG_TERTIARY, padding: '20px', borderRadius: '8px', border: `1px solid ${BORDER_COLOR}` }}>
                  <h3 style={{ fontSize: '18px', fontWeight: '700', color: TEXT_PRIMARY, marginBottom: '16px' }}>
                    How to Download Underdog CSV
                  </h3>
                  <ol style={{ margin: 0, paddingLeft: '24px', color: TEXT_SECONDARY, lineHeight: '1.8' }}>
                    <li style={{ marginBottom: '12px' }}>
                      In <strong style={{ color: TEXT_PRIMARY }}>Underdog Fantasy</strong>, go to <strong style={{ color: TEXT_PRIMARY }}>Completed</strong>
                    </li>
                    <li style={{ marginBottom: '12px' }}>
                      Find your <strong style={{ color: TEXT_PRIMARY }}>NFL Best Ball</strong> drafts
                    </li>
                    <li style={{ marginBottom: '12px' }}>
                      Click <strong style={{ color: TEXT_PRIMARY }}>"Email Exposure CSV"</strong>
                    </li>
                    <li>
                      Check your email, click the link, and the CSV will download to your downloads folder
                    </li>
                  </ol>
                </div>

                {/* What Each Tab Does */}
                <div>
                  <h3 style={{ fontSize: '18px', fontWeight: '700', color: TEXT_PRIMARY, marginBottom: '16px' }}>
                    What Each Tab Does
                  </h3>
                  <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                    <div style={{ padding: '12px', background: BG_TERTIARY, borderRadius: '6px', border: `1px solid ${BORDER_COLOR}` }}>
                      <strong style={{ color: TEXT_PRIMARY }}>Overview:</strong>
                      <span style={{ color: TEXT_SECONDARY, marginLeft: '8px' }}>See all your player exposures</span>
                    </div>
                    <div style={{ padding: '12px', background: BG_TERTIARY, borderRadius: '6px', border: `1px solid ${BORDER_COLOR}` }}>
                      <strong style={{ color: TEXT_PRIMARY }}>Correlations:</strong>
                      <span style={{ color: TEXT_SECONDARY, marginLeft: '8px' }}>Find which players you draft together most often</span>
                    </div>
                    <div style={{ padding: '12px', background: BG_TERTIARY, borderRadius: '6px', border: `1px solid ${BORDER_COLOR}` }}>
                      <strong style={{ color: TEXT_PRIMARY }}>Fades:</strong>
                      <span style={{ color: TEXT_SECONDARY, marginLeft: '8px' }}>See which highly-ranked players you're avoiding</span>
                    </div>
                    <div style={{ padding: '12px', background: BG_TERTIARY, borderRadius: '6px', border: `1px solid ${BORDER_COLOR}` }}>
                      <strong style={{ color: TEXT_PRIMARY }}>Construction:</strong>
                      <span style={{ color: TEXT_SECONDARY, marginLeft: '8px' }}>Analyze your draft strategies (Hero RB, Zero RB, etc.)</span>
                    </div>
                    <div style={{ padding: '12px', background: BG_TERTIARY, borderRadius: '6px', border: `1px solid ${BORDER_COLOR}` }}>
                      <strong style={{ color: TEXT_PRIMARY }}>Value:</strong>
                      <span style={{ color: TEXT_SECONDARY, marginLeft: '8px' }}>See where you're getting value vs. reaching on players</span>
                    </div>
                    <div style={{ padding: '12px', background: BG_TERTIARY, borderRadius: '6px', border: `1px solid ${BORDER_COLOR}` }}>
                      <strong style={{ color: TEXT_PRIMARY }}>Teams:</strong>
                      <span style={{ color: TEXT_SECONDARY, marginLeft: '8px' }}>Review individual draft results and team quality</span>
                    </div>
                  </div>
                </div>

                {/* Close Button */}
                <div style={{ marginTop: '32px', textAlign: 'center' }}>
                  <button
                    onClick={() => setShowHowToUse(false)}
                    style={{
                      padding: '12px 32px',
                      background: ACCENT,
                      color: '#fff',
                      border: 'none',
                      borderRadius: '8px',
                      fontSize: '16px',
                      fontWeight: '700',
                      cursor: 'pointer',
                      transition: 'all 0.2s ease',
                      boxShadow: SHADOW_SM
                    }}
                    onMouseEnter={(e) => {
                      e.currentTarget.style.transform = 'translateY(-2px)';
                      e.currentTarget.style.boxShadow = SHADOW_MD;
                    }}
                    onMouseLeave={(e) => {
                      e.currentTarget.style.transform = 'translateY(0)';
                      e.currentTarget.style.boxShadow = SHADOW_SM;
                    }}
                  >
                    Got It!
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* Portfolio Report Modal */}
          {showPortfolioReport && portfolioReportData && (
            <div style={{
              position: 'fixed',
              top: 0,
              left: 0,
              right: 0,
              bottom: 0,
              background: 'rgba(0, 0, 0, 0.95)',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              zIndex: 1000,
              padding: '20px',
              backdropFilter: 'blur(30px)'
            }}
            onClick={() => setShowPortfolioReport(false)}
            >
              {/* 9:16 Mobile Card - Instagram Story Size */}
              <div style={{
                background: '#000000',
                borderRadius: '24px',
                width: '375px',
                height: '667px',
                boxShadow: '0 40px 100px rgba(0, 0, 0, 0.9), 0 0 80px rgba(59, 130, 246, 0.2)',
                border: '1px solid rgba(255, 255, 255, 0.1)',
                position: 'relative',
                display: 'flex',
                flexDirection: 'column',
                overflow: 'hidden'
              }}
              onClick={(e) => e.stopPropagation()}
              >
                {/* Scrollable Content */}
                <div style={{
                  flex: '1 1 auto',
                  overflowY: 'auto',
                  overflowX: 'hidden'
                }}>
                  <div id="portfolio-report-card" style={{
                    background: '#000000',
                    color: '#ffffff',
                    fontFamily: 'Inter, system-ui, sans-serif'
                  }}>
                  
                  {/* COMPACT HEADER - ULTRA Bold Blue with Depth */}
                  <div style={{
                    background: `
                      linear-gradient(180deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0) 30%, rgba(0, 0, 0, 0.15) 100%),
                      linear-gradient(135deg, #2563eb 0%, #1d4ed8 40%, #1e40af 70%, #1e3a8a 100%)
                    `,
                    padding: '20px 24px 12px 24px',
                    position: 'relative',
                    boxShadow: `
                      0 8px 40px rgba(30, 58, 138, 0.7),
                      0 4px 20px rgba(0, 0, 0, 0.5),
                      inset 0 2px 0 rgba(255, 255, 255, 0.15),
                      inset 0 -3px 10px rgba(0, 0, 0, 0.3)
                    `,
                    borderBottom: '3px solid rgba(30, 58, 138, 0.6)',
                    borderTop: '1px solid rgba(255, 255, 255, 0.1)'
                  }}>
                    <div style={{
                      position: 'absolute',
                      top: '12px',
                      right: '12px',
                      background: 'rgba(0, 0, 0, 0.5)',
                      backdropFilter: 'blur(10px)',
                      padding: '4px 10px',
                      borderRadius: '16px',
                      fontSize: '9px',
                      fontWeight: '900',
                      letterSpacing: '0.6px',
                      boxShadow: '0 2px 8px rgba(0, 0, 0, 0.3)'
                    }}>
                      2026
                    </div>

                    {/* Title */}
                    <div style={{ 
                      fontSize: '36px', 
                      fontWeight: '900', 
                      lineHeight: '1', 
                      textShadow: '0 3px 20px rgba(0, 0, 0, 0.6), 0 1px 3px rgba(0, 0, 0, 0.8)',
                      textAlign: 'center',
                      fontFamily: 'Bebas Neue, Impact, sans-serif',
                      marginBottom: '6px'
                    }}>
                      OPTIMAL REPORT
                    </div>

                    {/* Optimal Fantasy Logo - PERFECTLY centered between L and R */}
                    <div style={{ display: 'flex', justifyContent: 'center', paddingLeft: '35px' }}>
                      <svg width="130" height="38" viewBox="0 0 280 80" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="15" y="32" width="4" height="16" rx="2" fill="url(#gradRecapped)" />
                        <defs>
                          <linearGradient id="gradRecapped" x1="17" y1="32" x2="17" y2="48" gradientUnits="userSpaceOnUse">
                            <stop offset="0%" stopColor="#ffffff" stopOpacity="0.95" />
                            <stop offset="100%" stopColor="#dbeafe" stopOpacity="0.85" />
                          </linearGradient>
                        </defs>
                        <text x="28" y="38" fontFamily="Inter, -apple-system, BlinkMacSystemFont, sans-serif" fontSize="22" fontWeight="800" fill="#ffffff" letterSpacing="-0.5">OPTIMAL</text>
                        <text x="28" y="56" fontFamily="Inter, -apple-system, BlinkMacSystemFont, sans-serif" fontSize="18" fontWeight="600" fill="#dbeafe" letterSpacing="0.5">FANTASY</text>
                      </svg>
                    </div>
                  </div>

                  {/* BADGES SECTION */}
                    <div style={{ 
                      padding: '20px 24px', 
                      background: '#0a0a0a',
                      borderTop: '1px solid rgba(255, 255, 255, 0.08)',
                      textAlign: 'center'
                    }}>
                      {/* Main Badge - ALWAYS RENDERED for html2canvas */}
                      {displayedBadge && (
                        <div style={{ marginBottom: portfolioReportData.miniBadges.length > 0 ? '16px' : '0' }}>
                          <div id="main-badge-box" style={{
                            display: 'inline-block',
                            background: displayedBadge.rare 
                              ? 'linear-gradient(135deg, #fbbf24 0%, #f59e0b 50%, #d97706 100%)'
                              : '#3b82f6',
                            padding: '14px 22px',
                            borderRadius: '12px',
                            boxShadow: displayedBadge.rare
                              ? '0 4px 20px rgba(251, 191, 36, 0.6), 0 0 40px rgba(251, 191, 36, 0.3)'
                              : '0 4px 20px rgba(59, 130, 246, 0.5)',
                            maxWidth: '340px',
                            border: displayedBadge.rare ? '2px solid rgba(255, 255, 255, 0.3)' : 'none'
                          }}>
                            {/* Title */}
                            <div id="badge-title" style={{ fontSize: '22px', fontWeight: '900', letterSpacing: '1px', marginBottom: displayedBadge.rare ? '6px' : '8px', color: '#ffffff', fontFamily: 'Inter, Arial, sans-serif' }}>
                              {displayedBadge.title}
                            </div>
                            
                            {/* RARE tag */}
                            {displayedBadge.rare && (
                              <div style={{ 
                                fontSize: '8px', 
                                fontWeight: '900', 
                                letterSpacing: '1.5px',
                                textTransform: 'uppercase',
                                color: 'rgba(255, 255, 255, 0.6)',
                                marginBottom: '8px'
                              }}>
                                (RARE)
                              </div>
                            )}
                            
                            {/* Stat (smaller, centered) */}
                            <div id="badge-stat" style={{ 
                              fontSize: '10px', 
                              opacity: 0.75, 
                              fontWeight: '700', 
                              textTransform: 'uppercase', 
                              letterSpacing: '0.5px',
                              marginBottom: '10px',
                              color: '#ffffff'
                            }}>
                              {displayedBadge.stat}
                            </div>
                            
                            {/* Tagline (bigger, bolder) */}
                            <div id="badge-tagline" style={{ 
                              fontSize: '13px', 
                              opacity: 0.95, 
                              fontWeight: '800', 
                              lineHeight: '1.4',
                              fontStyle: 'italic',
                              color: '#ffffff'
                            }}>
                              "{displayedBadge.tagline}"
                            </div>
                          </div>
                        </div>
                      )}
                      
                      {/* Mini Badges - CLICKABLE */}
                      {portfolioReportData.miniBadges.length > 0 && (
                        <div style={{ display: 'flex', gap: '6px', flexWrap: 'wrap', justifyContent: 'center' }}>
                          {portfolioReportData.miniBadges.map((badge, idx) => {
                            const isActive = (activeBadge && activeBadge.id === badge.id) || 
                                           (!activeBadge && portfolioReportData.mainBadge && badge.id === portfolioReportData.mainBadge.id);
                            return (
                              <div
                                key={idx}
                                onClick={() => setActiveBadge(activeBadge?.id === badge.id ? null : badge)}
                                style={{
                                  background: isActive 
                                    ? (badge.rare ? 'linear-gradient(135deg, #fbbf24 0%, #f59e0b 50%, #d97706 100%)' : 'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)')
                                    : (badge.rare ? 'rgba(251, 191, 36, 0.2)' : 'rgba(59, 130, 246, 0.2)'),
                                  border: isActive 
                                    ? (badge.rare ? '1px solid #fbbf24' : '1px solid #3b82f6')
                                    : (badge.rare ? '1px solid rgba(251, 191, 36, 0.4)' : '1px solid rgba(59, 130, 246, 0.4)'),
                                  padding: '6px 12px',
                                  borderRadius: '16px',
                                  fontSize: '10px',
                                  fontWeight: '700',
                                  color: isActive ? '#fff' : (badge.rare ? '#fbbf24' : '#ffffff'),
                                  textTransform: 'uppercase',
                                  letterSpacing: '0.3px',
                                  cursor: 'pointer',
                                  transition: 'all 0.2s',
                                  boxShadow: isActive 
                                    ? (badge.rare ? '0 2px 10px rgba(251, 191, 36, 0.5)' : '0 2px 10px rgba(59, 130, 246, 0.4)')
                                    : 'none'
                                }}
                                onMouseEnter={(e) => {
                                  if (!isActive) {
                                    e.currentTarget.style.background = badge.rare ? 'rgba(251, 191, 36, 0.35)' : 'rgba(59, 130, 246, 0.35)';
                                    e.currentTarget.style.transform = 'translateY(-2px)';
                                  }
                                }}
                                onMouseLeave={(e) => {
                                  if (!isActive) {
                                    e.currentTarget.style.background = badge.rare ? 'rgba(251, 191, 36, 0.2)' : 'rgba(59, 130, 246, 0.2)';
                                    e.currentTarget.style.transform = 'translateY(0)';
                                  }
                                }}
                              >
                                {badge.title}
                              </div>
                            );
                          })}
                        </div>
                      )}
                    </div>

                  {/* TOURNAMENT SECTION - Compressed */}
                  <div style={{ padding: '16px 24px', background: '#0a0a0a', textAlign: 'center' }}>
                    <div style={{ fontSize: '8px', fontWeight: '800', letterSpacing: '1.5px', textTransform: 'uppercase', opacity: 0.5, marginBottom: '8px' }}>
                      TOP {portfolioReportData.totalTournaments > 1 ? 'TOURNAMENTS' : 'TOURNAMENT'}
                    </div>
                    <div style={{ fontSize: '15px', fontWeight: '900', lineHeight: '1.3', color: '#fff' }}>
                      {portfolioReportData.topTournaments.join(' + ')}
                    </div>
                  </div>

                  {/* GO-TO BUILD + STATS - Side by Side */}
                  <div style={{ 
                    padding: '16px 24px', 
                    background: '#0a0a0a', 
                    borderTop: '1px solid rgba(255, 255, 255, 0.05)',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'space-between',
                    gap: '16px'
                  }}>
                    {/* Left: Teams */}
                    <div style={{ flex: '0 0 auto', textAlign: 'center' }}>
                      <div style={{ 
                        fontSize: '32px', 
                        fontWeight: '900', 
                        lineHeight: '1',
                        color: '#3b82f6',
                        textShadow: '0 0 20px rgba(59, 130, 246, 0.5)'
                      }}>
                        {portfolioReportData.totalTeams}
                      </div>
                      <div style={{ fontSize: '9px', fontWeight: '700', opacity: 0.6, marginTop: '4px', letterSpacing: '0.5px' }}>
                        TEAMS
                      </div>
                    </div>

                    {/* Center: Build */}
                    <div style={{ flex: '1 1 auto', textAlign: 'center' }}>
                      <div style={{ fontSize: '8px', fontWeight: '800', letterSpacing: '1.5px', textTransform: 'uppercase', opacity: 0.5, marginBottom: '6px' }}>
                        GO-TO BUILD
                      </div>
                      <div style={{ 
                        fontSize: '24px', 
                        fontWeight: '900', 
                        color: '#10b981',
                        letterSpacing: '1.2px',
                        textShadow: '0 0 30px rgba(16, 185, 129, 0.4)',
                        lineHeight: '1'
                      }}>
                        {portfolioReportData.build.split(' ')[0]}
                      </div>
                      <div style={{ fontSize: '9px', opacity: 0.6, marginTop: '4px', fontWeight: '600' }}>
                        {portfolioReportData.build.split(' ').slice(1).join(' ')}
                      </div>
                    </div>

                    {/* Right: Tournaments */}
                    <div style={{ flex: '0 0 auto', textAlign: 'center' }}>
                      <div style={{ 
                        fontSize: '32px', 
                        fontWeight: '900', 
                        lineHeight: '1',
                        color: '#3b82f6',
                        textShadow: '0 0 20px rgba(59, 130, 246, 0.5)'
                      }}>
                        {portfolioReportData.totalTournaments}
                      </div>
                      <div style={{ fontSize: '9px', fontWeight: '700', opacity: 0.6, marginTop: '4px', letterSpacing: '0.5px', textTransform: 'uppercase' }}>
                        {portfolioReportData.totalTournaments === 1 ? 'Tourney' : 'Tourneys'}
                      </div>
                    </div>
                  </div>

                  {/* MY GUYS - Green Section with Dots - COMPRESSED */}
                  <div style={{ 
                    padding: '18px 24px', 
                    background: '#047857',
                    backgroundImage: 'radial-gradient(circle, rgba(0, 0, 0, 0.2) 2px, transparent 2px)',
                    backgroundSize: '16px 16px',
                    boxShadow: 'inset 0 2px 20px rgba(0, 0, 0, 0.3)'
                  }}>
                    <div style={{ 
                      fontSize: '28px', 
                      fontWeight: '900', 
                      letterSpacing: '2px', 
                      textTransform: 'uppercase', 
                      marginBottom: '14px',
                      textAlign: 'center',
                      textShadow: '0 2px 8px rgba(0, 0, 0, 0.3)',
                      fontFamily: 'Bebas Neue, Impact, sans-serif'
                    }}>
                      MY GUYS
                    </div>
                    <div style={{ display: 'grid', gap: '10px' }}>
                      {['QB', 'RB', 'WR', 'TE'].map(pos => {
                        const topThree = exposureData
                          .filter(p => p.position === pos)
                          .sort((a, b) => parseFloat(b.exposure) - parseFloat(a.exposure))
                          .slice(0, 3);
                        
                        return topThree.length > 0 && (
                          <div key={pos}>
                            <div style={{
                              fontSize: '8px',
                              fontWeight: '900',
                              letterSpacing: '1.2px',
                              marginBottom: '6px',
                              opacity: 0.7
                            }}>
                              {pos}
                            </div>
                            <div style={{ display: 'flex', gap: '6px', flexWrap: 'wrap' }}>
                              {topThree.map((player, idx) => (
                                <div key={idx} style={{
                                  background: 'rgba(0, 0, 0, 0.35)',
                                  borderRadius: '8px',
                                  padding: '8px 10px',
                                  border: '1px solid rgba(255, 255, 255, 0.15)',
                                  flex: '1 1 auto',
                                  minWidth: '0'
                                }}>
                                  <div style={{
                                    fontSize: '16px',
                                    fontWeight: '900',
                                    marginBottom: '2px',
                                    lineHeight: '1.1'
                                  }}>
                                    {player.name}
                                  </div>
                                  <div style={{
                                    fontSize: '9px',
                                    fontWeight: '700',
                                    color: '#fbbf24',
                                    opacity: 0.95
                                  }}>
                                    {player.team} â€¢ {player.exposure}%
                                  </div>
                                </div>
                              ))}
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>

                  {/* TOP STACKS - Red Diagonal Stripes - COMPRESSED */}
                  {portfolioReportData.topStacks.length > 0 && (
                    <div style={{
                      padding: '18px 24px',
                      background: 'linear-gradient(135deg, #ef4444 0%, #dc2626 25%, #b91c1c 25%, #b91c1c 50%, #dc2626 50%, #dc2626 75%, #b91c1c 75%, #b91c1c 100%)',
                      backgroundSize: '40px 40px',
                      boxShadow: 'inset 0 4px 30px rgba(0, 0, 0, 0.5), 0 0 80px rgba(239, 68, 68, 0.4)',
                      position: 'relative'
                    }}>
                      <div style={{
                        position: 'absolute',
                        top: 0,
                        left: 0,
                        right: 0,
                        bottom: 0,
                        background: 'radial-gradient(circle at 30% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 50%)',
                        pointerEvents: 'none'
                      }}></div>
                      <div style={{ 
                        fontSize: '28px', 
                        fontWeight: '900', 
                        letterSpacing: '2px', 
                        textTransform: 'uppercase', 
                        marginBottom: '14px',
                        textAlign: 'center',
                        textShadow: '0 2px 8px rgba(0, 0, 0, 0.3)',
                      fontFamily: 'Bebas Neue, Impact, sans-serif',
                        position: 'relative',
                        zIndex: 1
                      }}>
                        TOP STACKS
                      </div>
                      {portfolioReportData.topStacks.slice(0, 3).map((stack, idx) => {
                        const pct = ((stack.count / portfolioReportData.totalTeams) * 100).toFixed(0);
                        return (
                          <div key={idx} style={{
                            marginBottom: idx < 2 ? '10px' : '0',
                            background: 'rgba(0, 0, 0, 0.25)',
                            padding: '12px 14px',
                            borderRadius: '10px',
                            border: '1px solid rgba(255, 255, 255, 0.1)'
                          }}>
                            <div style={{ fontSize: '13px', fontWeight: '900', marginBottom: '4px', letterSpacing: '0.3px' }}>
                              {stack.qbTeam} Stack ({pct}%)
                            </div>
                            <div style={{ fontSize: '12px', fontWeight: '700', opacity: 0.95, lineHeight: '1.4' }}>
                              {stack.qbName} â†’ {stack.recName}
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  )}

                  {/* FADED - Purple Horizontal Stripes - COMPRESSED */}
                  {portfolioReportData.fades.length > 0 && (
                    <div style={{
                      padding: '18px 24px',
                      background: 'linear-gradient(0deg, #7c3aed 50%, #6d28d9 50%)',
                      backgroundSize: '100% 8px',
                      boxShadow: 'inset 0 2px 20px rgba(0, 0, 0, 0.3), 0 0 60px rgba(124, 58, 237, 0.3)'
                    }}>
                      <div style={{ 
                        fontSize: '28px', 
                        fontWeight: '900', 
                        letterSpacing: '2px', 
                        textTransform: 'uppercase', 
                        marginBottom: '12px',
                        textAlign: 'center',
                        textShadow: '0 2px 8px rgba(0, 0, 0, 0.3)',
                      fontFamily: 'Bebas Neue, Impact, sans-serif'
                      }}>
                        FADED
                      </div>
                      {portfolioReportData.fades.map((fade, idx) => (
                        <div key={idx} style={{
                          fontSize: '15px',
                          fontWeight: '800',
                          marginBottom: idx < 2 ? '8px' : '0',
                          opacity: 0.95,
                          lineHeight: '1.3'
                        }}>
                          {fade.name} {fade.position} Â· {fade.team} Â· {fade.exposure}%
                        </div>
                      ))}
                    </div>
                  )}
                  
                  </div>
                </div>

                {/* Action Buttons - NOW TRULY STICKY (outside scroll area) */}
                <div style={{ 
                  padding: '14px 20px', 
                  background: '#000', 
                  display: 'flex', 
                  gap: '10px', 
                  justifyContent: 'center',
                  borderTop: '1px solid rgba(255, 255, 255, 0.1)',
                  flexShrink: 0,
                  borderRadius: '0 0 24px 24px'
                }}>
                  <button
                    onClick={() => {
                      setShowPortfolioReport(false);
                      setActiveBadge(null);
                    }}
                    style={{
                      padding: '10px 18px',
                      background: '#1a1a1a',
                      color: '#ffffff',
                      border: '1px solid #2a2a2a',
                      borderRadius: '8px',
                      fontSize: '12px',
                      fontWeight: '700',
                      cursor: 'pointer',
                      transition: 'all 0.2s'
                    }}
                    onMouseEnter={(e) => e.currentTarget.style.background = '#2a2a2a'}
                    onMouseLeave={(e) => e.currentTarget.style.background = '#1a1a1a'}
                  >
                    Close
                  </button>
                  <button
                    onClick={async () => {
                      const reportCard = document.getElementById('portfolio-report-card');
                      if (!reportCard) return;
                      
                      try {
                        // Reset to show main badge for screenshot
                        const wasActive = activeBadge;
                        setActiveBadge(null);
                        
                        // Wait for React render AND browser paint
                        await new Promise(resolve => setTimeout(resolve, 300));
                        await new Promise(resolve => requestAnimationFrame(() => requestAnimationFrame(resolve)));
                        
                        // FIX html2canvas issues - remove problematic CSS
                        const badgeBox = document.getElementById('main-badge-box');
                        const badgeTitle = document.getElementById('badge-title');
                        const badgeStat = document.getElementById('badge-stat');
                        const badgeTagline = document.getElementById('badge-tagline');
                        
                        // Store original values
                        const originalStyles = {
                          boxDisplay: badgeBox?.style.display,
                          boxShadow: badgeBox?.style.boxShadow,
                          statOpacity: badgeStat?.style.opacity,
                          taglineOpacity: badgeTagline?.style.opacity
                        };
                        
                        // Remove problematic properties
                        if (badgeBox) {
                          badgeBox.style.display = 'block';  // inline-block â†’ block
                          badgeBox.style.boxShadow = 'none';  // Remove box-shadow
                        }
                        if (badgeStat) badgeStat.style.opacity = '1';  // Remove opacity
                        if (badgeTagline) badgeTagline.style.opacity = '1';  // Remove opacity
                        
                        // Give browser time to apply changes
                        await new Promise(resolve => requestAnimationFrame(resolve));
                        
                        if (window.html2canvas) {
                          const canvas = await html2canvas(reportCard, {
                            backgroundColor: '#000000',
                            scale: 2,
                            logging: false,
                            width: 375,
                            windowWidth: 375
                          });
                          
                          // RESTORE original CSS immediately
                          if (badgeBox && originalStyles.boxDisplay) badgeBox.style.display = originalStyles.boxDisplay;
                          if (badgeBox && originalStyles.boxShadow) badgeBox.style.boxShadow = originalStyles.boxShadow;
                          if (badgeStat && originalStyles.statOpacity) badgeStat.style.opacity = originalStyles.statOpacity;
                          if (badgeTagline && originalStyles.taglineOpacity) badgeTagline.style.opacity = originalStyles.taglineOpacity;
                          
                          canvas.toBlob((blob) => {
                            const url = URL.createObjectURL(blob);
                            const a = document.createElement('a');
                            a.href = url;
                            a.download = `recapped-${new Date().getTime()}.png`;
                            a.click();
                            URL.revokeObjectURL(url);
                            
                            // Restore active badge if there was one
                            if (wasActive) setActiveBadge(wasActive);
                          });
                        } else {
                          alert('Screenshot feature not available. Please take a manual screenshot.');
                        }
                      } catch (error) {
                        console.error('Error generating image:', error);
                        alert('Error generating image. Please take a manual screenshot instead.');
                      }
                    }}
                    style={{
                      padding: '10px 22px',
                      background: 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)',
                      color: '#fff',
                      border: 'none',
                      borderRadius: '8px',
                      fontSize: '12px',
                      fontWeight: '800',
                      cursor: 'pointer',
                      boxShadow: '0 4px 12px rgba(59, 130, 246, 0.4)',
                      transition: 'all 0.2s'
                    }}
                    onMouseEnter={(e) => {
                      e.currentTarget.style.transform = 'translateY(-2px)';
                      e.currentTarget.style.boxShadow = '0 6px 18px rgba(59, 130, 246, 0.6)';
                    }}
                    onMouseLeave={(e) => {
                      e.currentTarget.style.transform = 'translateY(0)';
                      e.currentTarget.style.boxShadow = '0 4px 12px rgba(59, 130, 246, 0.4)';
                    }}
                  >
                    Download Image
                  </button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    ReactDOM.render(<FantasyExposureTracker />, document.getElementById('root'));
  </script>
  
</body>
</html>
